{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\n/**\n * Sistema de gesti√≥n de versiones para documentos\n * Maneja captura, almacenamiento y restauraci√≥n de versiones\n */\nexport class VersionManager {\n  constructor(documentId = 'default', options = {}) {\n    this.documentId = documentId;\n    this.maxVersions = options.maxVersions || 10;\n    this.autoSaveInterval = options.autoSaveInterval || 30000; // 30 segundos\n    this.versions = [];\n    this.currentVersionIndex = 0;\n    this.history = [];\n    this.isInitialized = false;\n\n    // Estad√≠sticas\n    this.stats = {\n      totalVersions: 0,\n      totalRestores: 0,\n      lastAction: null\n    };\n  }\n\n  /**\n   * Inicializa el gestor de versiones\n   */\n  initialize() {\n    if (this.isInitialized) return true;\n    try {\n      this.loadFromStorage();\n      this.isInitialized = true;\n      console.log(`‚úÖ VersionManager inicializado para documento: ${this.documentId}`);\n      return true;\n    } catch (error) {\n      console.error('‚ùå Error inicializando VersionManager:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Captura una nueva versi√≥n del documento\n   * @param {Object} data - Datos del documento a versionar\n   * @param {string} description - Descripci√≥n de los cambios\n   * @param {string} type - Tipo de versi√≥n (manual, auto, restore, etc.)\n   * @returns {string} ID de la versi√≥n creada\n   */\n  captureVersion(data, description = 'Cambios sin descripci√≥n', type = 'manual') {\n    try {\n      // Validar datos\n      if (!data || typeof data !== 'object') {\n        throw new Error('Datos inv√°lidos para la versi√≥n');\n      }\n      const versionData = this.createVersionSnapshot(data, description, type);\n\n      // Agregar a la lista de versiones (la m√°s reciente primero)\n      this.versions.unshift(versionData);\n\n      // Mantener solo el n√∫mero m√°ximo de versiones\n      this.trimVersions();\n\n      // Actualizar estad√≠sticas\n      this.stats.totalVersions++;\n      this.stats.lastAction = {\n        type: 'capture',\n        versionId: versionData.id,\n        timestamp: new Date().toISOString()\n      };\n\n      // Actualizar √≠ndice de versi√≥n actual\n      this.currentVersionIndex = 0;\n\n      // Registrar en historial\n      this.addToHistory('version_saved', versionData.id, description);\n\n      // Guardar en almacenamiento persistente\n      this.saveToStorage();\n      console.log(`üìù Versi√≥n guardada [${type}]: ${description}`);\n      return versionData.id;\n    } catch (error) {\n      console.error('‚ùå Error capturando versi√≥n:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Crea un snapshot del estado actual\n   */\n  createVersionSnapshot(data, description, type) {\n    // Crear una copia profunda de los datos\n    const clonedData = this.deepClone(data);\n\n    // Generar estad√≠sticas del snapshot\n    const stats = this.calculateSnapshotStats(clonedData);\n    return {\n      id: this.generateVersionId(),\n      timestamp: new Date().toISOString(),\n      description: description,\n      type: type,\n      data: clonedData,\n      stats: stats,\n      preview: this.generateVersionPreview(clonedData, stats)\n    };\n  }\n\n  /**\n   * Genera un ID √∫nico para la versi√≥n\n   */\n  generateVersionId() {\n    const timestamp = Date.now();\n    const random = Math.random().toString(36).substr(2, 9);\n    return `v${timestamp}_${random}`;\n  }\n\n  /**\n   * Genera una vista previa de la versi√≥n\n   */\n  generateVersionPreview(data, stats) {\n    // Extraer t√≠tulo del documento\n    const title = data.headerConfig?.policyName || data.headerConfig?.manualName || 'Documento sin t√≠tulo';\n\n    // Generar snippet del contenido\n    let snippet = '';\n    if (data.sections && data.sections.length > 0) {\n      const firstSection = data.sections[0];\n      if (firstSection.text) {\n        snippet = firstSection.text.substring(0, 150);\n        if (firstSection.text.length > 150) snippet += '...';\n      }\n    }\n    return {\n      title: title,\n      snippet: snippet || 'Sin contenido',\n      words: stats.wordCount,\n      completion: stats.completionPercentage,\n      sections: stats.sectionCount,\n      procedureSteps: stats.procedureSteps || 0,\n      lastModified: new Date().toLocaleString()\n    };\n  }\n\n  /**\n   * Calcula estad√≠sticas del snapshot\n   */\n  calculateSnapshotStats(data) {\n    let wordCount = 0;\n    let sectionCount = 0;\n    let filledSections = 0;\n    let procedureSteps = 0;\n\n    // Contar palabras y secciones de secciones principales\n    if (data.sections && Array.isArray(data.sections)) {\n      data.sections.forEach(section => {\n        sectionCount++;\n        if (section.text && section.text.trim().length > 0) {\n          wordCount += section.text.split(/\\s+/).filter(w => w.length > 0).length;\n          if (section.text.trim().length > 10) filledSections++;\n        }\n      });\n    }\n\n    // Contar palabras y secciones de secciones restantes\n    if (data.remainingSections && Array.isArray(data.remainingSections)) {\n      data.remainingSections.forEach(section => {\n        sectionCount++;\n        if (section.text && section.text.trim().length > 0) {\n          wordCount += section.text.split(/\\s+/).filter(w => w.length > 0).length;\n          if (section.text.trim().length > 10) filledSections++;\n        }\n      });\n    }\n\n    // Contar palabras del procedimiento\n    if (data.procedimiento && data.procedimiento.text) {\n      wordCount += data.procedimiento.text.split(/\\s+/).filter(w => w.length > 0).length;\n      if (data.procedimiento.text.trim().length > 10) filledSections++;\n    }\n\n    // Contar pasos del procedimiento\n    if (data.procedimiento && data.procedimiento.table && Array.isArray(data.procedimiento.table)) {\n      procedureSteps = data.procedimiento.table.length;\n    }\n\n    // Calcular porcentaje de completado\n    const completionPercentage = sectionCount > 0 ? Math.round(filledSections / sectionCount * 100) : 0;\n    return {\n      wordCount,\n      sectionCount,\n      filledSections,\n      completionPercentage,\n      procedureSteps,\n      timestamp: new Date().toISOString()\n    };\n  }\n\n  /**\n   * Obtiene una versi√≥n por su ID\n   */\n  getVersion(versionId) {\n    return this.versions.find(v => v.id === versionId);\n  }\n\n  /**\n   * Obtiene la versi√≥n actual\n   */\n  getCurrentVersion() {\n    return this.versions[this.currentVersionIndex];\n  }\n\n  /**\n   * Restaura una versi√≥n espec√≠fica\n   */\n  restoreVersion(versionId) {\n    const versionIndex = this.versions.findIndex(v => v.id === versionId);\n    if (versionIndex === -1) {\n      throw new Error(`Versi√≥n no encontrada: ${versionId}`);\n    }\n    const version = this.versions[versionIndex];\n\n    // Actualizar √≠ndice actual\n    this.currentVersionIndex = versionIndex;\n\n    // Registrar en historial\n    this.addToHistory('version_restored', versionId, `Restaurada: ${version.description}`);\n\n    // Actualizar estad√≠sticas\n    this.stats.totalRestores++;\n    this.stats.lastAction = {\n      type: 'restore',\n      versionId: versionId,\n      timestamp: new Date().toISOString()\n    };\n\n    // Guardar cambios\n    this.saveToStorage();\n    console.log(`üîÑ Versi√≥n restaurada: ${version.description}`);\n    return version.data;\n  }\n\n  /**\n   * Elimina una versi√≥n\n   */\n  deleteVersion(versionId) {\n    const versionIndex = this.versions.findIndex(v => v.id === versionId);\n    if (versionIndex === -1) {\n      throw new Error(`Versi√≥n no encontrada: ${versionId}`);\n    }\n\n    // No permitir eliminar todas las versiones\n    if (this.versions.length <= 1) {\n      throw new Error('No se puede eliminar la √∫nica versi√≥n disponible');\n    }\n    const version = this.versions[versionIndex];\n\n    // Eliminar la versi√≥n\n    this.versions.splice(versionIndex, 1);\n\n    // Ajustar √≠ndice actual si es necesario\n    if (versionIndex < this.currentVersionIndex) {\n      this.currentVersionIndex--;\n    } else if (versionIndex === this.currentVersionIndex) {\n      // Si eliminamos la versi√≥n actual, establecer la primera como actual\n      this.currentVersionIndex = 0;\n    }\n\n    // Registrar en historial\n    this.addToHistory('version_deleted', versionId, `Eliminada: ${version.description}`);\n\n    // Guardar cambios\n    this.saveToStorage();\n    console.log(`üóëÔ∏è Versi√≥n eliminada: ${version.description}`);\n    return true;\n  }\n\n  /**\n   * Compara dos versiones\n   */\n  compareVersions(versionId1, versionId2) {\n    const v1 = this.getVersion(versionId1);\n    const v2 = this.getVersion(versionId2);\n    if (!v1 || !v2) {\n      throw new Error('Una o ambas versiones no existen');\n    }\n    const changes = {\n      summary: {\n        timeBetween: this.getTimeDifference(v1.timestamp, v2.timestamp),\n        wordCountChange: v2.stats.wordCount - v1.stats.wordCount,\n        completionChange: v2.stats.completionPercentage - v1.stats.completionPercentage\n      },\n      headerChanges: this.compareObjects(v1.data.headerConfig, v2.data.headerConfig),\n      sectionChanges: this.compareSections(v1.data.sections, v2.data.sections),\n      preview1: v1.preview,\n      preview2: v2.preview,\n      metadata: {\n        version1: {\n          id: v1.id,\n          description: v1.description,\n          timestamp: v1.timestamp\n        },\n        version2: {\n          id: v2.id,\n          description: v2.description,\n          timestamp: v2.timestamp\n        }\n      }\n    };\n    return changes;\n  }\n\n  /**\n   * Compara objetos simples\n   */\n  compareObjects(obj1, obj2) {\n    const changes = [];\n    const allKeys = new Set([...Object.keys(obj1 || {}), ...Object.keys(obj2 || {})]);\n    allKeys.forEach(key => {\n      const val1 = obj1 ? obj1[key] : undefined;\n      const val2 = obj2 ? obj2[key] : undefined;\n      if (val1 !== val2) {\n        changes.push({\n          field: key,\n          oldValue: val1,\n          newValue: val2,\n          type: val1 === undefined ? 'added' : val2 === undefined ? 'removed' : 'modified'\n        });\n      }\n    });\n    return changes;\n  }\n\n  /**\n   * Compara secciones de contenido\n   */\n  compareSections(sections1, sections2) {\n    const changes = [];\n    const maxLength = Math.max(sections1?.length || 0, sections2?.length || 0);\n    for (let i = 0; i < maxLength; i++) {\n      const section1 = sections1?.[i];\n      const section2 = sections2?.[i];\n      if (!section1 && section2) {\n        changes.push({\n          section: i,\n          title: section2.title,\n          type: 'added',\n          content: section2.text?.substring(0, 100) || ''\n        });\n      } else if (section1 && !section2) {\n        changes.push({\n          section: i,\n          title: section1.title,\n          type: 'removed',\n          content: section1.text?.substring(0, 100) || ''\n        });\n      } else if (section1 && section2 && section1.text !== section2.text) {\n        changes.push({\n          section: i,\n          title: section1.title || section2.title,\n          type: 'modified',\n          oldContent: section1.text?.substring(0, 100) || '',\n          newContent: section2.text?.substring(0, 100) || '',\n          wordChange: (section2.text?.split(/\\s+/).length || 0) - (section1.text?.split(/\\s+/).length || 0)\n        });\n      }\n    }\n    return changes;\n  }\n\n  /**\n   * Calcula diferencia de tiempo entre dos fechas\n   */\n  getTimeDifference(date1, date2) {\n    const d1 = new Date(date1);\n    const d2 = new Date(date2);\n    const diffMs = Math.abs(d2 - d1);\n    const minutes = Math.floor(diffMs / 60000);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    if (days > 0) return `${days} d√≠as`;\n    if (hours > 0) return `${hours} horas`;\n    return `${minutes} minutos`;\n  }\n\n  /**\n   * Limita el n√∫mero de versiones guardadas\n   */\n  trimVersions() {\n    if (this.versions.length > this.maxVersions) {\n      const removed = this.versions.splice(this.maxVersions);\n      console.log(`‚úÇÔ∏è ${removed.length} versiones antiguas eliminadas (m√°ximo: ${this.maxVersions})`);\n    }\n  }\n\n  /**\n   * Agrega una entrada al historial\n   */\n  addToHistory(action, versionId, description) {\n    this.history.unshift({\n      id: `h${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,\n      action: action,\n      versionId: versionId,\n      description: description,\n      timestamp: new Date().toISOString(),\n      user: 'system' // Podr√≠a extenderse para soportar usuarios\n    });\n\n    // Limitar historial a 100 entradas\n    if (this.history.length > 100) {\n      this.history.pop();\n    }\n  }\n\n  /**\n   * Guarda las versiones en localStorage\n   */\n  saveToStorage() {\n    try {\n      const storageData = {\n        versions: this.versions,\n        history: this.history,\n        currentIndex: this.currentVersionIndex,\n        stats: this.stats,\n        metadata: {\n          documentId: this.documentId,\n          lastUpdated: new Date().toISOString(),\n          totalVersions: this.versions.length\n        }\n      };\n      localStorage.setItem(`vm_${this.documentId}`, JSON.stringify(storageData));\n      return true;\n    } catch (error) {\n      console.error('‚ùå Error guardando en storage:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Carga las versiones desde localStorage\n   */\n  loadFromStorage() {\n    try {\n      const saved = localStorage.getItem(`vm_${this.documentId}`);\n      if (saved) {\n        const data = JSON.parse(saved);\n        this.versions = data.versions || [];\n        this.history = data.history || [];\n        this.currentVersionIndex = data.currentIndex || 0;\n        this.stats = data.stats || {\n          totalVersions: this.versions.length,\n          totalRestores: 0,\n          lastAction: null\n        };\n        console.log(`üìÇ ${this.versions.length} versiones cargadas del storage`);\n        return true;\n      }\n      console.log('üìÇ No hay versiones guardadas previamente');\n      return false;\n    } catch (error) {\n      console.error('‚ùå Error cargando del storage:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Limpia todas las versiones (uso cuidadoso)\n   */\n  clearAll() {\n    if (confirm('¬øEst√°s seguro de eliminar TODAS las versiones? Esta acci√≥n no se puede deshacer.')) {\n      this.versions = [];\n      this.history = [];\n      this.currentVersionIndex = 0;\n      this.stats = {\n        totalVersions: 0,\n        totalRestores: 0,\n        lastAction: null\n      };\n      localStorage.removeItem(`vm_${this.documentId}`);\n      console.log('üßπ Todas las versiones eliminadas');\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Exporta todas las versiones como archivo JSON\n   */\n  exportToJSON() {\n    const exportData = {\n      documentId: this.documentId,\n      versions: this.versions,\n      history: this.history,\n      stats: this.stats,\n      metadata: {\n        exportedAt: new Date().toISOString(),\n        totalVersions: this.versions.length,\n        versionManagerVersion: '1.0.0'\n      }\n    };\n    const blob = new Blob([JSON.stringify(exportData, null, 2)], {\n      type: 'application/json'\n    });\n    return blob;\n  }\n\n  /**\n   * Importa versiones desde un archivo JSON\n   */\n  importFromJSON(jsonData) {\n    try {\n      const data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;\n      if (!data.versions || !Array.isArray(data.versions)) {\n        throw new Error('Formato de importaci√≥n inv√°lido');\n      }\n\n      // Confirmar antes de sobrescribir\n      if (this.versions.length > 0) {\n        if (!confirm(`Importar ${data.versions.length} versiones. ¬øSobrescribir las ${this.versions.length} actuales?`)) {\n          return false;\n        }\n      }\n      this.versions = data.versions;\n      this.history = data.history || [];\n      this.currentVersionIndex = 0;\n      this.stats = data.stats || {\n        totalVersions: this.versions.length,\n        totalRestores: 0,\n        lastAction: null\n      };\n      this.saveToStorage();\n      console.log(`üì• ${this.versions.length} versiones importadas`);\n      return true;\n    } catch (error) {\n      console.error('‚ùå Error importando versiones:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Obtiene estad√≠sticas del sistema de versiones\n   */\n  getStats() {\n    return {\n      ...this.stats,\n      currentVersions: this.versions.length,\n      oldestVersion: this.versions.length > 0 ? this.versions[this.versions.length - 1].timestamp : null,\n      newestVersion: this.versions.length > 0 ? this.versions[0].timestamp : null,\n      historyEntries: this.history.length\n    };\n  }\n\n  /**\n   * Busca versiones por texto\n   */\n  searchVersions(query) {\n    if (!query || query.trim() === '') return this.versions;\n    const searchTerm = query.toLowerCase().trim();\n    return this.versions.filter(version => {\n      // Buscar en descripci√≥n\n      if (version.description.toLowerCase().includes(searchTerm)) return true;\n\n      // Buscar en t√≠tulo del preview\n      if (version.preview.title.toLowerCase().includes(searchTerm)) return true;\n\n      // Buscar en snippet\n      if (version.preview.snippet.toLowerCase().includes(searchTerm)) return true;\n\n      // Buscar en datos del encabezado\n      const headerStr = JSON.stringify(version.data.headerConfig || {}).toLowerCase();\n      if (headerStr.includes(searchTerm)) return true;\n      return false;\n    });\n  }\n\n  /**\n   * Obtiene las versiones en un rango de fechas\n   */\n  getVersionsByDateRange(startDate, endDate) {\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    return this.versions.filter(version => {\n      const versionDate = new Date(version.timestamp);\n      return versionDate >= start && versionDate <= end;\n    });\n  }\n\n  /**\n   * Utilidad: Clonado profundo\n   */\n  deepClone(obj) {\n    if (obj === null || typeof obj !== 'object') return obj;\n    if (obj instanceof Date) return new Date(obj.getTime());\n    if (Array.isArray(obj)) {\n      const arrCopy = [];\n      for (let i = 0; i < obj.length; i++) {\n        arrCopy[i] = this.deepClone(obj[i]);\n      }\n      return arrCopy;\n    }\n    const objCopy = {};\n    for (const key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        objCopy[key] = this.deepClone(obj[key]);\n      }\n    }\n    return objCopy;\n  }\n}\n\n/**\n * Instancia singleton global del VersionManager\n */\nlet globalVersionManager = null;\n\n/**\n * Obtiene o crea una instancia global del VersionManager\n */\nexport function getVersionManager(documentId = 'global', options = {}) {\n  if (!globalVersionManager || globalVersionManager.documentId !== documentId) {\n    globalVersionManager = new VersionManager(documentId, options);\n    globalVersionManager.initialize();\n  }\n  return globalVersionManager;\n}\n\n/**\n * Utilidades adicionales para manejo de versiones\n */\nexport const VersionUtils = {\n  /**\n   * Formatea una fecha para mostrar\n   */\n  formatDate(timestamp, format = 'full') {\n    const date = new Date(timestamp);\n    switch (format) {\n      case 'short':\n        return date.toLocaleDateString('es-ES');\n      case 'time':\n        return date.toLocaleTimeString('es-ES', {\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n      case 'full':\n      default:\n        return date.toLocaleString('es-ES', {\n          day: '2-digit',\n          month: '2-digit',\n          year: 'numeric',\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n    }\n  },\n  /**\n   * Calcula tama√±o aproximado de datos\n   */\n  calculateSize(data) {\n    const jsonString = JSON.stringify(data);\n    const bytes = new Blob([jsonString]).size;\n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(2)} KB`;\n    return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;\n  },\n  /**\n   * Valida si los datos pueden ser versionados\n   */\n  isValidVersionData(data) {\n    return data && typeof data === 'object' && !Array.isArray(data) && Object.keys(data).length > 0;\n  }\n};","map":{"version":3,"names":["VersionManager","constructor","documentId","options","maxVersions","autoSaveInterval","versions","currentVersionIndex","history","isInitialized","stats","totalVersions","totalRestores","lastAction","initialize","loadFromStorage","console","log","error","captureVersion","data","description","type","Error","versionData","createVersionSnapshot","unshift","trimVersions","versionId","id","timestamp","Date","toISOString","addToHistory","saveToStorage","clonedData","deepClone","calculateSnapshotStats","generateVersionId","preview","generateVersionPreview","now","random","Math","toString","substr","title","headerConfig","policyName","manualName","snippet","sections","length","firstSection","text","substring","words","wordCount","completion","completionPercentage","sectionCount","procedureSteps","lastModified","toLocaleString","filledSections","Array","isArray","forEach","section","trim","split","filter","w","remainingSections","procedimiento","table","round","getVersion","find","v","getCurrentVersion","restoreVersion","versionIndex","findIndex","version","deleteVersion","splice","compareVersions","versionId1","versionId2","v1","v2","changes","summary","timeBetween","getTimeDifference","wordCountChange","completionChange","headerChanges","compareObjects","sectionChanges","compareSections","preview1","preview2","metadata","version1","version2","obj1","obj2","allKeys","Set","Object","keys","key","val1","undefined","val2","push","field","oldValue","newValue","sections1","sections2","maxLength","max","i","section1","section2","content","oldContent","newContent","wordChange","date1","date2","d1","d2","diffMs","abs","minutes","floor","hours","days","removed","action","user","pop","storageData","currentIndex","lastUpdated","localStorage","setItem","JSON","stringify","saved","getItem","parse","clearAll","confirm","removeItem","exportToJSON","exportData","exportedAt","versionManagerVersion","blob","Blob","importFromJSON","jsonData","getStats","currentVersions","oldestVersion","newestVersion","historyEntries","searchVersions","query","searchTerm","toLowerCase","includes","headerStr","getVersionsByDateRange","startDate","endDate","start","end","versionDate","obj","getTime","arrCopy","objCopy","prototype","hasOwnProperty","call","globalVersionManager","getVersionManager","VersionUtils","formatDate","format","date","toLocaleDateString","toLocaleTimeString","hour","minute","day","month","year","calculateSize","jsonString","bytes","size","toFixed","isValidVersionData"],"sources":["/home/jorge/Escritorio/Jorge-PC/procesos/procesos/src/utils/VersionManager.js"],"sourcesContent":["/**\n * Sistema de gesti√≥n de versiones para documentos\n * Maneja captura, almacenamiento y restauraci√≥n de versiones\n */\nexport class VersionManager {\n  constructor(documentId = 'default', options = {}) {\n    this.documentId = documentId;\n    this.maxVersions = options.maxVersions || 10;\n    this.autoSaveInterval = options.autoSaveInterval || 30000; // 30 segundos\n    this.versions = [];\n    this.currentVersionIndex = 0;\n    this.history = [];\n    this.isInitialized = false;\n    \n    // Estad√≠sticas\n    this.stats = {\n      totalVersions: 0,\n      totalRestores: 0,\n      lastAction: null\n    };\n  }\n\n  /**\n   * Inicializa el gestor de versiones\n   */\n  initialize() {\n    if (this.isInitialized) return true;\n    \n    try {\n      this.loadFromStorage();\n      this.isInitialized = true;\n      console.log(`‚úÖ VersionManager inicializado para documento: ${this.documentId}`);\n      return true;\n    } catch (error) {\n      console.error('‚ùå Error inicializando VersionManager:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Captura una nueva versi√≥n del documento\n   * @param {Object} data - Datos del documento a versionar\n   * @param {string} description - Descripci√≥n de los cambios\n   * @param {string} type - Tipo de versi√≥n (manual, auto, restore, etc.)\n   * @returns {string} ID de la versi√≥n creada\n   */\n  captureVersion(data, description = 'Cambios sin descripci√≥n', type = 'manual') {\n    try {\n      // Validar datos\n      if (!data || typeof data !== 'object') {\n        throw new Error('Datos inv√°lidos para la versi√≥n');\n      }\n\n      const versionData = this.createVersionSnapshot(data, description, type);\n      \n      // Agregar a la lista de versiones (la m√°s reciente primero)\n      this.versions.unshift(versionData);\n      \n      // Mantener solo el n√∫mero m√°ximo de versiones\n      this.trimVersions();\n      \n      // Actualizar estad√≠sticas\n      this.stats.totalVersions++;\n      this.stats.lastAction = {\n        type: 'capture',\n        versionId: versionData.id,\n        timestamp: new Date().toISOString()\n      };\n      \n      // Actualizar √≠ndice de versi√≥n actual\n      this.currentVersionIndex = 0;\n      \n      // Registrar en historial\n      this.addToHistory('version_saved', versionData.id, description);\n      \n      // Guardar en almacenamiento persistente\n      this.saveToStorage();\n      \n      console.log(`üìù Versi√≥n guardada [${type}]: ${description}`);\n      return versionData.id;\n      \n    } catch (error) {\n      console.error('‚ùå Error capturando versi√≥n:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Crea un snapshot del estado actual\n   */\n  createVersionSnapshot(data, description, type) {\n    // Crear una copia profunda de los datos\n    const clonedData = this.deepClone(data);\n    \n    // Generar estad√≠sticas del snapshot\n    const stats = this.calculateSnapshotStats(clonedData);\n    \n    return {\n      id: this.generateVersionId(),\n      timestamp: new Date().toISOString(),\n      description: description,\n      type: type,\n      data: clonedData,\n      stats: stats,\n      preview: this.generateVersionPreview(clonedData, stats)\n    };\n  }\n\n  /**\n   * Genera un ID √∫nico para la versi√≥n\n   */\n  generateVersionId() {\n    const timestamp = Date.now();\n    const random = Math.random().toString(36).substr(2, 9);\n    return `v${timestamp}_${random}`;\n  }\n\n  /**\n   * Genera una vista previa de la versi√≥n\n   */\n  generateVersionPreview(data, stats) {\n    // Extraer t√≠tulo del documento\n    const title = data.headerConfig?.policyName || \n                  data.headerConfig?.manualName || \n                  'Documento sin t√≠tulo';\n    \n    // Generar snippet del contenido\n    let snippet = '';\n    if (data.sections && data.sections.length > 0) {\n      const firstSection = data.sections[0];\n      if (firstSection.text) {\n        snippet = firstSection.text.substring(0, 150);\n        if (firstSection.text.length > 150) snippet += '...';\n      }\n    }\n    \n    return {\n      title: title,\n      snippet: snippet || 'Sin contenido',\n      words: stats.wordCount,\n      completion: stats.completionPercentage,\n      sections: stats.sectionCount,\n      procedureSteps: stats.procedureSteps || 0,\n      lastModified: new Date().toLocaleString()\n    };\n  }\n\n  /**\n   * Calcula estad√≠sticas del snapshot\n   */\n  calculateSnapshotStats(data) {\n    let wordCount = 0;\n    let sectionCount = 0;\n    let filledSections = 0;\n    let procedureSteps = 0;\n    \n    // Contar palabras y secciones de secciones principales\n    if (data.sections && Array.isArray(data.sections)) {\n      data.sections.forEach(section => {\n        sectionCount++;\n        if (section.text && section.text.trim().length > 0) {\n          wordCount += section.text.split(/\\s+/).filter(w => w.length > 0).length;\n          if (section.text.trim().length > 10) filledSections++;\n        }\n      });\n    }\n    \n    // Contar palabras y secciones de secciones restantes\n    if (data.remainingSections && Array.isArray(data.remainingSections)) {\n      data.remainingSections.forEach(section => {\n        sectionCount++;\n        if (section.text && section.text.trim().length > 0) {\n          wordCount += section.text.split(/\\s+/).filter(w => w.length > 0).length;\n          if (section.text.trim().length > 10) filledSections++;\n        }\n      });\n    }\n    \n    // Contar palabras del procedimiento\n    if (data.procedimiento && data.procedimiento.text) {\n      wordCount += data.procedimiento.text.split(/\\s+/).filter(w => w.length > 0).length;\n      if (data.procedimiento.text.trim().length > 10) filledSections++;\n    }\n    \n    // Contar pasos del procedimiento\n    if (data.procedimiento && data.procedimiento.table && Array.isArray(data.procedimiento.table)) {\n      procedureSteps = data.procedimiento.table.length;\n    }\n    \n    // Calcular porcentaje de completado\n    const completionPercentage = sectionCount > 0 \n      ? Math.round((filledSections / sectionCount) * 100)\n      : 0;\n    \n    return {\n      wordCount,\n      sectionCount,\n      filledSections,\n      completionPercentage,\n      procedureSteps,\n      timestamp: new Date().toISOString()\n    };\n  }\n\n  /**\n   * Obtiene una versi√≥n por su ID\n   */\n  getVersion(versionId) {\n    return this.versions.find(v => v.id === versionId);\n  }\n\n  /**\n   * Obtiene la versi√≥n actual\n   */\n  getCurrentVersion() {\n    return this.versions[this.currentVersionIndex];\n  }\n\n  /**\n   * Restaura una versi√≥n espec√≠fica\n   */\n  restoreVersion(versionId) {\n    const versionIndex = this.versions.findIndex(v => v.id === versionId);\n    \n    if (versionIndex === -1) {\n      throw new Error(`Versi√≥n no encontrada: ${versionId}`);\n    }\n    \n    const version = this.versions[versionIndex];\n    \n    // Actualizar √≠ndice actual\n    this.currentVersionIndex = versionIndex;\n    \n    // Registrar en historial\n    this.addToHistory('version_restored', versionId, `Restaurada: ${version.description}`);\n    \n    // Actualizar estad√≠sticas\n    this.stats.totalRestores++;\n    this.stats.lastAction = {\n      type: 'restore',\n      versionId: versionId,\n      timestamp: new Date().toISOString()\n    };\n    \n    // Guardar cambios\n    this.saveToStorage();\n    \n    console.log(`üîÑ Versi√≥n restaurada: ${version.description}`);\n    return version.data;\n  }\n\n  /**\n   * Elimina una versi√≥n\n   */\n  deleteVersion(versionId) {\n    const versionIndex = this.versions.findIndex(v => v.id === versionId);\n    \n    if (versionIndex === -1) {\n      throw new Error(`Versi√≥n no encontrada: ${versionId}`);\n    }\n    \n    // No permitir eliminar todas las versiones\n    if (this.versions.length <= 1) {\n      throw new Error('No se puede eliminar la √∫nica versi√≥n disponible');\n    }\n    \n    const version = this.versions[versionIndex];\n    \n    // Eliminar la versi√≥n\n    this.versions.splice(versionIndex, 1);\n    \n    // Ajustar √≠ndice actual si es necesario\n    if (versionIndex < this.currentVersionIndex) {\n      this.currentVersionIndex--;\n    } else if (versionIndex === this.currentVersionIndex) {\n      // Si eliminamos la versi√≥n actual, establecer la primera como actual\n      this.currentVersionIndex = 0;\n    }\n    \n    // Registrar en historial\n    this.addToHistory('version_deleted', versionId, `Eliminada: ${version.description}`);\n    \n    // Guardar cambios\n    this.saveToStorage();\n    \n    console.log(`üóëÔ∏è Versi√≥n eliminada: ${version.description}`);\n    return true;\n  }\n\n  /**\n   * Compara dos versiones\n   */\n  compareVersions(versionId1, versionId2) {\n    const v1 = this.getVersion(versionId1);\n    const v2 = this.getVersion(versionId2);\n    \n    if (!v1 || !v2) {\n      throw new Error('Una o ambas versiones no existen');\n    }\n    \n    const changes = {\n      summary: {\n        timeBetween: this.getTimeDifference(v1.timestamp, v2.timestamp),\n        wordCountChange: v2.stats.wordCount - v1.stats.wordCount,\n        completionChange: v2.stats.completionPercentage - v1.stats.completionPercentage\n      },\n      headerChanges: this.compareObjects(v1.data.headerConfig, v2.data.headerConfig),\n      sectionChanges: this.compareSections(v1.data.sections, v2.data.sections),\n      preview1: v1.preview,\n      preview2: v2.preview,\n      metadata: {\n        version1: { id: v1.id, description: v1.description, timestamp: v1.timestamp },\n        version2: { id: v2.id, description: v2.description, timestamp: v2.timestamp }\n      }\n    };\n    \n    return changes;\n  }\n\n  /**\n   * Compara objetos simples\n   */\n  compareObjects(obj1, obj2) {\n    const changes = [];\n    const allKeys = new Set([...Object.keys(obj1 || {}), ...Object.keys(obj2 || {})]);\n    \n    allKeys.forEach(key => {\n      const val1 = obj1 ? obj1[key] : undefined;\n      const val2 = obj2 ? obj2[key] : undefined;\n      \n      if (val1 !== val2) {\n        changes.push({\n          field: key,\n          oldValue: val1,\n          newValue: val2,\n          type: val1 === undefined ? 'added' : val2 === undefined ? 'removed' : 'modified'\n        });\n      }\n    });\n    \n    return changes;\n  }\n\n  /**\n   * Compara secciones de contenido\n   */\n  compareSections(sections1, sections2) {\n    const changes = [];\n    const maxLength = Math.max(sections1?.length || 0, sections2?.length || 0);\n    \n    for (let i = 0; i < maxLength; i++) {\n      const section1 = sections1?.[i];\n      const section2 = sections2?.[i];\n      \n      if (!section1 && section2) {\n        changes.push({\n          section: i,\n          title: section2.title,\n          type: 'added',\n          content: section2.text?.substring(0, 100) || ''\n        });\n      } else if (section1 && !section2) {\n        changes.push({\n          section: i,\n          title: section1.title,\n          type: 'removed',\n          content: section1.text?.substring(0, 100) || ''\n        });\n      } else if (section1 && section2 && section1.text !== section2.text) {\n        changes.push({\n          section: i,\n          title: section1.title || section2.title,\n          type: 'modified',\n          oldContent: section1.text?.substring(0, 100) || '',\n          newContent: section2.text?.substring(0, 100) || '',\n          wordChange: (section2.text?.split(/\\s+/).length || 0) - (section1.text?.split(/\\s+/).length || 0)\n        });\n      }\n    }\n    \n    return changes;\n  }\n\n  /**\n   * Calcula diferencia de tiempo entre dos fechas\n   */\n  getTimeDifference(date1, date2) {\n    const d1 = new Date(date1);\n    const d2 = new Date(date2);\n    const diffMs = Math.abs(d2 - d1);\n    \n    const minutes = Math.floor(diffMs / 60000);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    \n    if (days > 0) return `${days} d√≠as`;\n    if (hours > 0) return `${hours} horas`;\n    return `${minutes} minutos`;\n  }\n\n  /**\n   * Limita el n√∫mero de versiones guardadas\n   */\n  trimVersions() {\n    if (this.versions.length > this.maxVersions) {\n      const removed = this.versions.splice(this.maxVersions);\n      console.log(`‚úÇÔ∏è ${removed.length} versiones antiguas eliminadas (m√°ximo: ${this.maxVersions})`);\n    }\n  }\n\n  /**\n   * Agrega una entrada al historial\n   */\n  addToHistory(action, versionId, description) {\n    this.history.unshift({\n      id: `h${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,\n      action: action,\n      versionId: versionId,\n      description: description,\n      timestamp: new Date().toISOString(),\n      user: 'system' // Podr√≠a extenderse para soportar usuarios\n    });\n    \n    // Limitar historial a 100 entradas\n    if (this.history.length > 100) {\n      this.history.pop();\n    }\n  }\n\n  /**\n   * Guarda las versiones en localStorage\n   */\n  saveToStorage() {\n    try {\n      const storageData = {\n        versions: this.versions,\n        history: this.history,\n        currentIndex: this.currentVersionIndex,\n        stats: this.stats,\n        metadata: {\n          documentId: this.documentId,\n          lastUpdated: new Date().toISOString(),\n          totalVersions: this.versions.length\n        }\n      };\n      \n      localStorage.setItem(`vm_${this.documentId}`, JSON.stringify(storageData));\n      return true;\n    } catch (error) {\n      console.error('‚ùå Error guardando en storage:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Carga las versiones desde localStorage\n   */\n  loadFromStorage() {\n    try {\n      const saved = localStorage.getItem(`vm_${this.documentId}`);\n      if (saved) {\n        const data = JSON.parse(saved);\n        \n        this.versions = data.versions || [];\n        this.history = data.history || [];\n        this.currentVersionIndex = data.currentIndex || 0;\n        this.stats = data.stats || {\n          totalVersions: this.versions.length,\n          totalRestores: 0,\n          lastAction: null\n        };\n        \n        console.log(`üìÇ ${this.versions.length} versiones cargadas del storage`);\n        return true;\n      }\n      \n      console.log('üìÇ No hay versiones guardadas previamente');\n      return false;\n      \n    } catch (error) {\n      console.error('‚ùå Error cargando del storage:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Limpia todas las versiones (uso cuidadoso)\n   */\n  clearAll() {\n    if (confirm('¬øEst√°s seguro de eliminar TODAS las versiones? Esta acci√≥n no se puede deshacer.')) {\n      this.versions = [];\n      this.history = [];\n      this.currentVersionIndex = 0;\n      this.stats = {\n        totalVersions: 0,\n        totalRestores: 0,\n        lastAction: null\n      };\n      \n      localStorage.removeItem(`vm_${this.documentId}`);\n      console.log('üßπ Todas las versiones eliminadas');\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Exporta todas las versiones como archivo JSON\n   */\n  exportToJSON() {\n    const exportData = {\n      documentId: this.documentId,\n      versions: this.versions,\n      history: this.history,\n      stats: this.stats,\n      metadata: {\n        exportedAt: new Date().toISOString(),\n        totalVersions: this.versions.length,\n        versionManagerVersion: '1.0.0'\n      }\n    };\n    \n    const blob = new Blob([JSON.stringify(exportData, null, 2)], {\n      type: 'application/json'\n    });\n    \n    return blob;\n  }\n\n  /**\n   * Importa versiones desde un archivo JSON\n   */\n  importFromJSON(jsonData) {\n    try {\n      const data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;\n      \n      if (!data.versions || !Array.isArray(data.versions)) {\n        throw new Error('Formato de importaci√≥n inv√°lido');\n      }\n      \n      // Confirmar antes de sobrescribir\n      if (this.versions.length > 0) {\n        if (!confirm(`Importar ${data.versions.length} versiones. ¬øSobrescribir las ${this.versions.length} actuales?`)) {\n          return false;\n        }\n      }\n      \n      this.versions = data.versions;\n      this.history = data.history || [];\n      this.currentVersionIndex = 0;\n      this.stats = data.stats || {\n        totalVersions: this.versions.length,\n        totalRestores: 0,\n        lastAction: null\n      };\n      \n      this.saveToStorage();\n      console.log(`üì• ${this.versions.length} versiones importadas`);\n      return true;\n      \n    } catch (error) {\n      console.error('‚ùå Error importando versiones:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Obtiene estad√≠sticas del sistema de versiones\n   */\n  getStats() {\n    return {\n      ...this.stats,\n      currentVersions: this.versions.length,\n      oldestVersion: this.versions.length > 0 ? this.versions[this.versions.length - 1].timestamp : null,\n      newestVersion: this.versions.length > 0 ? this.versions[0].timestamp : null,\n      historyEntries: this.history.length\n    };\n  }\n\n  /**\n   * Busca versiones por texto\n   */\n  searchVersions(query) {\n    if (!query || query.trim() === '') return this.versions;\n    \n    const searchTerm = query.toLowerCase().trim();\n    \n    return this.versions.filter(version => {\n      // Buscar en descripci√≥n\n      if (version.description.toLowerCase().includes(searchTerm)) return true;\n      \n      // Buscar en t√≠tulo del preview\n      if (version.preview.title.toLowerCase().includes(searchTerm)) return true;\n      \n      // Buscar en snippet\n      if (version.preview.snippet.toLowerCase().includes(searchTerm)) return true;\n      \n      // Buscar en datos del encabezado\n      const headerStr = JSON.stringify(version.data.headerConfig || {}).toLowerCase();\n      if (headerStr.includes(searchTerm)) return true;\n      \n      return false;\n    });\n  }\n\n  /**\n   * Obtiene las versiones en un rango de fechas\n   */\n  getVersionsByDateRange(startDate, endDate) {\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    \n    return this.versions.filter(version => {\n      const versionDate = new Date(version.timestamp);\n      return versionDate >= start && versionDate <= end;\n    });\n  }\n\n  /**\n   * Utilidad: Clonado profundo\n   */\n  deepClone(obj) {\n    if (obj === null || typeof obj !== 'object') return obj;\n    if (obj instanceof Date) return new Date(obj.getTime());\n    \n    if (Array.isArray(obj)) {\n      const arrCopy = [];\n      for (let i = 0; i < obj.length; i++) {\n        arrCopy[i] = this.deepClone(obj[i]);\n      }\n      return arrCopy;\n    }\n    \n    const objCopy = {};\n    for (const key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        objCopy[key] = this.deepClone(obj[key]);\n      }\n    }\n    return objCopy;\n  }\n}\n\n/**\n * Instancia singleton global del VersionManager\n */\nlet globalVersionManager = null;\n\n/**\n * Obtiene o crea una instancia global del VersionManager\n */\nexport function getVersionManager(documentId = 'global', options = {}) {\n  if (!globalVersionManager || globalVersionManager.documentId !== documentId) {\n    globalVersionManager = new VersionManager(documentId, options);\n    globalVersionManager.initialize();\n  }\n  return globalVersionManager;\n}\n\n/**\n * Utilidades adicionales para manejo de versiones\n */\nexport const VersionUtils = {\n  /**\n   * Formatea una fecha para mostrar\n   */\n  formatDate(timestamp, format = 'full') {\n    const date = new Date(timestamp);\n    \n    switch (format) {\n      case 'short':\n        return date.toLocaleDateString('es-ES');\n      case 'time':\n        return date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });\n      case 'full':\n      default:\n        return date.toLocaleString('es-ES', {\n          day: '2-digit',\n          month: '2-digit',\n          year: 'numeric',\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n    }\n  },\n\n  /**\n   * Calcula tama√±o aproximado de datos\n   */\n  calculateSize(data) {\n    const jsonString = JSON.stringify(data);\n    const bytes = new Blob([jsonString]).size;\n    \n    if (bytes < 1024) return `${bytes} B`;\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(2)} KB`;\n    return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;\n  },\n\n  /**\n   * Valida si los datos pueden ser versionados\n   */\n  isValidVersionData(data) {\n    return data && \n           typeof data === 'object' && \n           !Array.isArray(data) &&\n           Object.keys(data).length > 0;\n  }\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}