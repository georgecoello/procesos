{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\n// src/services/aiService.js\n// Versi√≥n mejorada con debugging y soporte para m√∫ltiples entornos\n\nconsole.log('=== AI Service Initializing ===');\n\n// Funci√≥n mejorada para leer variables de entorno\nconst getEnv = keyVariants => {\n  try {\n    // 1. Primero intentar con import.meta.env (Vite - producci√≥n/desarrollo)\n    if (typeof import.meta !== 'undefined' && import.meta.env) {\n      console.log('Checking import.meta.env...');\n      for (const k of keyVariants) {\n        const value = import.meta.env[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in import.meta.env`);\n          return value;\n        }\n      }\n    }\n\n    // 2. Intentar con process.env (Node.js/Vue CLI)\n    if (typeof process !== 'undefined' && process.env) {\n      console.log('Checking process.env...');\n      for (const k of keyVariants) {\n        const value = process.env[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in process.env`);\n          return value;\n        }\n      }\n    }\n\n    // 3. Intentar con window.__env (configuraci√≥n manual para Vercel)\n    if (typeof window !== 'undefined' && window.__env) {\n      console.log('Checking window.__env...');\n      for (const k of keyVariants) {\n        const value = window.__env[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in window.__env`);\n          return value;\n        }\n      }\n    }\n\n    // 4. Intentar con window._env_ (otra convenci√≥n com√∫n)\n    if (typeof window !== 'undefined' && window._env_) {\n      console.log('Checking window._env_...');\n      for (const k of keyVariants) {\n        const value = window._env_[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in window._env_`);\n          return value;\n        }\n      }\n    }\n\n    // 5. Buscar en el objeto window directamente (para Vercel)\n    if (typeof window !== 'undefined') {\n      console.log('Checking window object...');\n      for (const k of keyVariants) {\n        // Vercel a veces inyecta variables con prefijo NEXT_PUBLIC_ o similar\n        const value = window[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in window object`);\n          return value;\n        }\n      }\n    }\n    console.log(`‚úó No env found for keys: ${keyVariants.join(', ')}`);\n    return '';\n  } catch (error) {\n    console.error('Error reading environment:', error);\n    return '';\n  }\n};\n\n// Obtener configuraci√≥n con debugging detallado\nconsole.log('=== Loading AI Configuration ===');\nconst AI_PROVIDER = (getEnv(['VITE_AI_PROVIDER', 'AI_PROVIDER']) || 'groq').toLowerCase().trim();\nconst GROQ_KEY = getEnv(['VITE_GROQ_API_KEY', 'GROQ_API_KEY', 'VITE_OPENAI_API_KEY', 'OPENAI_API_KEY']).trim();\nconst GROQ_URL = getEnv(['VITE_GROQ_API_URL', 'GROQ_API_URL']) || 'https://api.groq.com/openai/v1/chat/completions';\nconst GROQ_MODEL = getEnv(['VITE_GROQ_MODEL', 'GROQ_MODEL']) || 'mixtral-8x7b-32768';\n\n// Configuraci√≥n para OpenAI (opcional)\nconst OPENAI_KEY = getEnv(['VITE_OPENAI_API_KEY', 'OPENAI_API_KEY']).trim();\nconst OPENAI_URL = getEnv(['VITE_OPENAI_API_URL', 'OPENAI_API_URL']) || 'https://api.openai.com/v1/chat/completions';\nconst OPENAI_MODEL = getEnv(['VITE_OPENAI_MODEL', 'OPENAI_MODEL']) || 'gpt-3.5-turbo';\n\n// Log de configuraci√≥n\nconsole.log('=== AI Configuration Summary ===');\nconsole.log('Provider:', AI_PROVIDER);\nconsole.log('Groq Key present:', GROQ_KEY ? `Yes (${GROQ_KEY.substring(0, 10)}...)` : 'No');\nconsole.log('Groq URL:', GROQ_URL);\nconsole.log('Groq Model:', GROQ_MODEL);\nconsole.log('OpenAI Key present:', OPENAI_KEY ? `Yes (${OPENAI_KEY.substring(0, 10)}...)` : 'No');\nconsole.log('OpenAI URL:', OPENAI_URL);\nconsole.log('OpenAI Model:', OPENAI_MODEL);\nconsole.log('================================');\nexport class AIService {\n  constructor() {\n    console.log('=== Creating AIService Instance ===');\n    this.provider = AI_PROVIDER;\n    this.groqKey = GROQ_KEY;\n    this.groqUrl = GROQ_URL;\n    this.groqModel = GROQ_MODEL;\n    this.openaiKey = OPENAI_KEY;\n    this.openaiUrl = OPENAI_URL;\n    this.openaiModel = OPENAI_MODEL;\n\n    // Verificar disponibilidad\n    this.isAvailable = this.checkAvailability();\n\n    // M√©todos de ayuda para debugging\n    this.showConfig();\n    console.log('=== AIService Ready ===');\n    console.log(`Status: ${this.isAvailable ? '‚úÖ Available' : '‚ùå Not Available'}`);\n    console.log(`Provider: ${this.provider}`);\n    console.log('========================');\n  }\n  checkAvailability() {\n    console.log('=== Checking AI Service Availability ===');\n    if (this.provider === 'groq') {\n      if (this.groqKey && this.groqKey.length > 20) {\n        // Las claves de Groq son largas\n        console.log('‚úÖ Groq service is available');\n        return true;\n      } else {\n        console.warn('‚ùå Groq service NOT available - Invalid or missing API key');\n        console.warn('Key length:', this.groqKey?.length || 0);\n        console.warn('Expected: API key starting with gsk_ and at least 30 characters');\n        return false;\n      }\n    }\n    if (this.provider === 'openai') {\n      if (this.openaiKey && this.openaiKey.length > 20) {\n        console.log('‚úÖ OpenAI service is available');\n        return true;\n      } else {\n        console.warn('‚ùå OpenAI service NOT available - Invalid or missing API key');\n        return false;\n      }\n    }\n    console.warn(`‚ùå Unknown provider: ${this.provider}`);\n    console.warn('Available providers: groq, openai');\n    return false;\n  }\n  showConfig() {\n    console.group('üîß AIService Configuration Details');\n    console.log('Provider:', this.provider);\n    console.log('isAvailable:', this.isAvailable);\n    if (this.provider === 'groq') {\n      console.log('Groq Key:', this.groqKey ? `${this.groqKey.substring(0, 10)}...` : 'Not set');\n      console.log('Groq URL:', this.groqUrl);\n      console.log('Groq Model:', this.groqModel);\n    }\n    if (this.provider === 'openai') {\n      console.log('OpenAI Key:', this.openaiKey ? `${this.openaiKey.substring(0, 10)}...` : 'Not set');\n      console.log('OpenAI URL:', this.openaiUrl);\n      console.log('OpenAI Model:', this.openaiModel);\n    }\n    console.groupEnd();\n  }\n\n  // M√©todo principal para enviar prompts\n  async sendPrompt(prompt, options = {}) {\n    if (!this.isAvailable) {\n      console.error('‚ùå Cannot send prompt: AI service not available');\n      throw new Error('Proveedor de IA no configurado. Por favor, configura las variables de entorno.');\n    }\n    console.log('üì§ Sending prompt to AI...');\n    console.log('Prompt length:', prompt.length);\n    console.log('Options:', options);\n    console.log('Provider:', this.provider);\n    try {\n      let result;\n      if (this.provider === 'groq') {\n        result = await this.sendToGroq(prompt, options);\n      } else if (this.provider === 'openai') {\n        result = await this.sendToOpenAI(prompt, options);\n      } else {\n        throw new Error(`Proveedor no soportado: ${this.provider}`);\n      }\n      console.log('‚úÖ Prompt sent successfully');\n      console.log('Response length:', result?.length || 0);\n      return result;\n    } catch (error) {\n      console.error('‚ùå Error sending prompt:', error);\n      throw error;\n    }\n  }\n\n  // Enviar a Groq\n  async sendToGroq(prompt, options = {}) {\n    console.log('üîÑ Sending to Groq API...');\n    const messages = [{\n      role: 'system',\n      content: options.systemPrompt || 'Eres un asistente √∫til especializado en redacci√≥n de documentos empresariales.'\n    }, {\n      role: 'user',\n      content: prompt\n    }];\n    const body = {\n      messages,\n      model: options.model || this.groqModel,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000,\n      stream: false\n    };\n    console.log('Request body:', {\n      model: body.model,\n      temperature: body.temperature,\n      max_tokens: body.max_tokens,\n      messages_count: messages.length\n    });\n    try {\n      const response = await fetch(this.groqUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.groqKey}`,\n          'User-Agent': 'ProcedimientosApp/1.0'\n        },\n        body: JSON.stringify(body)\n      });\n      console.log('Response status:', response.status);\n      console.log('Response status text:', response.statusText);\n      if (!response.ok) {\n        let errorText = 'Unknown error';\n        try {\n          errorText = await response.text();\n          console.error('Groq API error response:', errorText);\n        } catch (e) {\n          console.error('Could not read error response:', e);\n        }\n        throw new Error(`Error Groq API (${response.status}): ${errorText}`);\n      }\n      const data = await response.json();\n      console.log('Groq response received:', {\n        hasChoices: !!data.choices,\n        choicesLength: data.choices?.length || 0\n      });\n\n      // Extraer contenido de diferentes formatos de respuesta\n      const content = data.choices?.[0]?.message?.content || data.content || data.result || data.output || data.choices?.[0]?.text || JSON.stringify(data);\n      if (!content) {\n        console.warn('No content in response:', data);\n        throw new Error('La IA no devolvi√≥ contenido');\n      }\n      return content;\n    } catch (error) {\n      console.error('Groq API call failed:', error);\n\n      // Mensaje de error amigable\n      if (error.message.includes('401') || error.message.includes('Unauthorized')) {\n        throw new Error('API key inv√°lida. Por favor, verifica tu clave de Groq.');\n      } else if (error.message.includes('429')) {\n        throw new Error('L√≠mite de tasa excedido. Por favor, espera un momento.');\n      } else if (error.message.includes('fetch')) {\n        throw new Error('Error de conexi√≥n. Verifica tu internet.');\n      }\n      throw error;\n    }\n  }\n\n  // Enviar a OpenAI\n  async sendToOpenAI(prompt, options = {}) {\n    console.log('üîÑ Sending to OpenAI API...');\n    const messages = [{\n      role: 'system',\n      content: options.systemPrompt || 'Eres un asistente √∫til especializado en redacci√≥n de documentos empresariales.'\n    }, {\n      role: 'user',\n      content: prompt\n    }];\n    const body = {\n      model: options.model || this.openaiModel,\n      messages,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000\n    };\n    try {\n      const response = await fetch(this.openaiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.openaiKey}`\n        },\n        body: JSON.stringify(body)\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        console.error('OpenAI API error:', errorData);\n        throw new Error(`Error OpenAI API (${response.status}): ${errorData.error?.message || 'Error desconocido'}`);\n      }\n      const data = await response.json();\n      return data.choices?.[0]?.message?.content || data.choices?.[0]?.text || JSON.stringify(data);\n    } catch (error) {\n      console.error('OpenAI API call failed:', error);\n      throw error;\n    }\n  }\n\n  // Analizar procedimiento espec√≠fico\n  async analyzeProcedimiento(texto) {\n    if (!this.isAvailable) {\n      throw new Error('API key no configurada. Configura las variables de entorno correspondientes.');\n    }\n    console.log('üîç Analyzing procedure with AI...');\n    console.log('Text length:', texto.length);\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad espec√≠fica a realizar\n4. Detecta decisiones (preguntas s√≠/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n    const content = await this.sendPrompt(prompt, {\n      temperature: 0.3,\n      max_tokens: 3000,\n      systemPrompt: 'Eres un analista de procesos empresariales. Extrae informaci√≥n estructurada de descripciones de procedimientos y devuelve solo JSON v√°lido.'\n    });\n    console.log('‚úÖ Procedure analysis completed');\n    console.log('Response length:', content.length);\n\n    // Intentar extraer JSON desde una respuesta que puede incluir markdown\n    let jsonText = '';\n\n    // Primero intentar con markdown code blocks\n    const jsonMatch = (content || '').match(/```(?:json)?\\n([\\s\\S]*?)\\n```/) || (content || '').match(/```([\\s\\S]*?)```/);\n    if (jsonMatch && jsonMatch[1]) {\n      jsonText = jsonMatch[1];\n      console.log('Found JSON in code block');\n    } else {\n      // Intentar encontrar JSON directamente\n      const jsonStart = (content || '').indexOf('{');\n      const jsonEnd = (content || '').lastIndexOf('}');\n      if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {\n        jsonText = (content || '').substring(jsonStart, jsonEnd + 1);\n        console.log('Found JSON in response body');\n      } else {\n        // Si no hay JSON v√°lido, crear estructura b√°sica\n        console.warn('No valid JSON found in response');\n        console.warn('Response content:', content.substring(0, 200) + '...');\n        return {\n          pasos: []\n        };\n      }\n    }\n    try {\n      const result = JSON.parse(jsonText);\n      console.log('‚úÖ JSON parsed successfully');\n      console.log('Steps found:', result.pasos?.length || 0);\n      return result;\n    } catch (error) {\n      console.error('‚ùå Error parsing JSON:', error);\n      console.error('JSON text:', jsonText.substring(0, 200) + '...');\n      throw new Error('No se pudo parsear la respuesta JSON de la IA');\n    }\n  }\n\n  // Generar sugerencia para una secci√≥n espec√≠fica\n  async generarSugerencia(seccion, contenidoActual = '') {\n    if (!this.isAvailable) {\n      console.warn('AI service not available for suggestion');\n      return null;\n    }\n    console.log(`üí° Generating suggestion for: ${seccion}`);\n    const prompts = {\n      objetivo: `Genera un objetivo profesional para un procedimiento administrativo. \nEl objetivo debe ser: Espec√≠fico, Medible, Alcanzable, Relevante y con Tiempo definido (SMART).\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      alcance: `Define el alcance apropiado para un procedimiento empresarial. \nIncluye: √Åreas/departamentos cubiertos, exclusiones claras, l√≠mites geogr√°ficos o funcionales.\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      responsabilidades: `Lista los roles y responsabilidades t√≠picas para un procedimiento empresarial. \nFormato: 1. [Rol]: [Responsabilidad espec√≠fica]\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      normativa: `Menciona las normativas, pol√≠ticas internas y regulaciones externas relevantes. \nIncluye: Leyes aplicables, pol√≠ticas de la empresa, est√°ndares de calidad.\nContexto actual: ${contenidoActual || 'Ninguno'}`\n    };\n    const promptBase = prompts[seccion] || `Completa esta secci√≥n de un documento de procedimientos empresariales.\nContexto actual: ${contenidoActual || 'Ninguno'}`;\n    try {\n      const content = await this.sendPrompt(promptBase, {\n        temperature: 0.5,\n        max_tokens: 800\n      });\n      console.log('‚úÖ Suggestion generated successfully');\n      return content;\n    } catch (error) {\n      console.error('‚ùå Error generating suggestion:', error);\n      return null;\n    }\n  }\n\n  // Mejorar texto de procedimiento\n  async mejorarTextoProcedimiento(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text');\n      return texto;\n    }\n    console.log('‚ú® Improving procedure text...');\n    console.log('Original text length:', texto.length);\n    try {\n      const prompt = `Eres un editor experto en procedimientos empresariales. Mejora el texto siguiendo estas reglas:\n1. Claridad: Cada oraci√≥n describe un solo paso\n2. Estructura: Usa lenguaje directo (sujeto + verbo + objeto)\n3. Responsables: Identifica claramente qui√©n hace cada acci√≥n\n4. Formato: Incluye decisiones (¬ø...?) y alternativas (Si/No)\n5. Concisi√≥n: Elimina redundancias pero mant√©n precisi√≥n\n6. Formalidad: Usa tono profesional apropiado para documentos empresariales\n\nMejora este texto de procedimiento para hacerlo m√°s claro y estructurado:\n\n${texto}`;\n      const content = await this.sendPrompt(prompt, {\n        temperature: 0.4,\n        max_tokens: 2000\n      });\n      console.log('‚úÖ Text improved successfully');\n      console.log('Improved text length:', content.length);\n      return content || texto;\n    } catch (error) {\n      console.error('‚ùå Error improving text:', error);\n      return texto;\n    }\n  }\n\n  // Sugerir mejoras en tiempo real\n  async sugerirMejorasRapidas(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text');\n      return [];\n    }\n    console.log('üí≠ Generating quick improvements...');\n    try {\n      const prompt = `Analiza el siguiente texto de un procedimiento empresarial y sugiere 2-3 mejoras r√°pidas y espec√≠ficas.\nEnf√≥cate en: claridad, estructura, formalidad y completitud.\n\nTexto a mejorar: \"${texto}\"\n\nResponde en formato JSON estricto:\n{\n  \"mejoras\": [\n    \"Sugerencia 1 espec√≠fica\",\n    \"Sugerencia 2 espec√≠fica\",\n    \"Sugerencia 3 espec√≠fica\"\n  ]\n}`;\n      const content = await this.sendPrompt(prompt, {\n        temperature: 0.3,\n        max_tokens: 500,\n        systemPrompt: 'Eres un editor de documentos empresariales. Analiza textos y sugiere mejoras espec√≠ficas. Devuelve solo JSON v√°lido.'\n      });\n      console.log('Quick improvements response:', content);\n\n      // Extraer JSON de la respuesta\n      const jsonMatch = (content || '').match(/{[\\s\\S]*}/);\n      if (jsonMatch) {\n        try {\n          const parsed = JSON.parse(jsonMatch[0]);\n          console.log('‚úÖ Quick improvements generated:', parsed.mejoras?.length || 0);\n          return parsed.mejoras || [];\n        } catch (e) {\n          console.warn('Could not parse JSON from improvements response');\n        }\n      }\n\n      // Fallback: parsear como array simple\n      const lines = (content || '').split('\\n').filter(line => line.trim());\n      const improvements = lines.slice(0, 3);\n      console.log('Using fallback improvements:', improvements.length);\n      return improvements;\n    } catch (error) {\n      console.error('‚ùå Error generating quick improvements:', error);\n      return [];\n    }\n  }\n\n  // Generar contenido completo para una secci√≥n\n  async generarContenidoSeccion(seccion, contexto = '') {\n    if (!this.isAvailable) {\n      console.warn('AI service not available for content generation');\n      return '';\n    }\n    console.log(`üìù Generating content for: ${seccion}`);\n    const prompts = {\n      'Objetivo o Prop√≥sito': `Genera un objetivo SMART completo para un procedimiento empresarial.\nDebe incluir:\n1. Prop√≥sito claro\n2. Resultados esperados\n3. M√©tricas de √©xito\n4. Plazos\nContexto: ${contexto}`,\n      'Alcance': `Genera una descripci√≥n completa del alcance para un procedimiento empresarial.\nDebe incluir:\n1. √Åreas y departamentos incluidos\n2. Exclusiones espec√≠ficas\n3. L√≠mites geogr√°ficos y funcionales\n4. Condiciones de aplicaci√≥n\nContexto: ${contexto}`,\n      'Responsabilidades': `Genera una lista completa de responsabilidades para un procedimiento empresarial.\nFormato:\n- [Rol]: [Responsabilidad detallada]\nIncluye al menos 5 roles diferentes.\nContexto: ${contexto}`,\n      'Normativa': `Genera una secci√≥n completa de normativa para un procedimiento empresarial.\nIncluye:\n1. Leyes aplicables\n2. Pol√≠ticas internas\n3. Est√°ndares de calidad\n4. Requisitos regulatorios\n5. Referencias documentales\nContexto: ${contexto}`\n    };\n    const prompt = prompts[seccion] || `Genera contenido profesional para la secci√≥n \"${seccion}\" de un documento de procedimientos empresariales.\nContexto: ${contexto}`;\n    try {\n      const content = await this.sendPrompt(prompt, {\n        temperature: 0.5,\n        max_tokens: 1000\n      });\n      console.log('‚úÖ Content generated successfully');\n      console.log('Generated content length:', content.length);\n      return content;\n    } catch (error) {\n      console.error(`‚ùå Error generating content for ${seccion}:`, error);\n      return '';\n    }\n  }\n\n  // Traducir texto\n  async traducirTexto(texto, idiomaDestino = 'ingl√©s') {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text for translation');\n      return texto;\n    }\n    console.log(`üåç Translating text to ${idiomaDestino}...`);\n    console.log('Text length:', texto.length);\n    try {\n      const prompt = `Traduce el siguiente texto al ${idiomaDestino}. Mant√©n el tono formal y profesional del texto original.\n      \nTexto a traducir: \"${texto}\"`;\n      const translated = await this.sendPrompt(prompt, {\n        temperature: 0.2,\n        max_tokens: 1500\n      });\n      console.log('‚úÖ Text translated successfully');\n      console.log('Translated length:', translated.length);\n      return translated;\n    } catch (error) {\n      console.error('‚ùå Error translating text:', error);\n      return texto;\n    }\n  }\n\n  // Resumir texto\n  async resumirTexto(texto, maxPalabras = 200) {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text for summary');\n      return texto;\n    }\n    console.log(`üìã Summarizing text (max ${maxPalabras} words)...`);\n    console.log('Original text length:', texto.length);\n    try {\n      const prompt = `Resume el siguiente texto en aproximadamente ${maxPalabras} palabras. Mant√©n los puntos clave y el tono profesional.\n      \nTexto a resumir: \"${texto}\"`;\n      const summary = await this.sendPrompt(prompt, {\n        temperature: 0.3,\n        max_tokens: 500\n      });\n      console.log('‚úÖ Text summarized successfully');\n      console.log('Summary length:', summary.length);\n      return summary;\n    } catch (error) {\n      console.error('‚ùå Error summarizing text:', error);\n      return texto;\n    }\n  }\n}\n\n// Instancia exportada\nexport const aiService = new AIService();\n\n// Funci√≥n de utilidad para formatear texto HTML\nexport const formatHTMLFromText = text => {\n  if (!text) return '';\n\n  // Reemplazar saltos de l√≠nea con <br> y p√°rrafos\n  const lines = text.split('\\n').filter(line => line.trim());\n  const paragraphs = lines.map(line => `<p>${line.trim()}</p>`);\n  return paragraphs.join('');\n};\n\n// Funci√≥n para extraer texto limpio de HTML\nexport const extractTextFromHTML = html => {\n  if (typeof document === 'undefined') {\n    // Fallback para SSR\n    return html.replace(/<[^>]*>/g, '').replace(/\\s+/g, ' ').trim();\n  }\n  const div = document.createElement('div');\n  div.innerHTML = html;\n  return div.textContent || div.innerText || '';\n};\n\n// Exponer el servicio para debugging\nif (typeof window !== 'undefined') {\n  window.__aiService = aiService;\n  console.log('AIService exposed globally as window.__aiService');\n}","map":{"version":3,"names":["console","log","getEnv","keyVariants","import","meta","env","k","value","process","window","__env","_env_","join","error","AI_PROVIDER","toLowerCase","trim","GROQ_KEY","GROQ_URL","GROQ_MODEL","OPENAI_KEY","OPENAI_URL","OPENAI_MODEL","substring","AIService","constructor","provider","groqKey","groqUrl","groqModel","openaiKey","openaiUrl","openaiModel","isAvailable","checkAvailability","showConfig","length","warn","group","groupEnd","sendPrompt","prompt","options","Error","result","sendToGroq","sendToOpenAI","messages","role","content","systemPrompt","body","model","temperature","max_tokens","stream","messages_count","response","fetch","method","headers","JSON","stringify","status","statusText","ok","errorText","text","e","data","json","hasChoices","choices","choicesLength","message","output","includes","errorData","catch","analyzeProcedimiento","texto","jsonText","jsonMatch","match","jsonStart","indexOf","jsonEnd","lastIndexOf","pasos","parse","generarSugerencia","seccion","contenidoActual","prompts","objetivo","alcance","responsabilidades","normativa","promptBase","mejorarTextoProcedimiento","sugerirMejorasRapidas","parsed","mejoras","lines","split","filter","line","improvements","slice","generarContenidoSeccion","contexto","traducirTexto","idiomaDestino","translated","resumirTexto","maxPalabras","summary","aiService","formatHTMLFromText","paragraphs","map","extractTextFromHTML","html","document","replace","div","createElement","innerHTML","textContent","innerText","__aiService"],"sources":["/home/jorge/Escritorio/Jorge-PC/procesos/procesos/src/services/aiService.js"],"sourcesContent":["// src/services/aiService.js\n// Versi√≥n mejorada con debugging y soporte para m√∫ltiples entornos\n\nconsole.log('=== AI Service Initializing ===');\n\n// Funci√≥n mejorada para leer variables de entorno\nconst getEnv = (keyVariants) => {\n  try {\n    // 1. Primero intentar con import.meta.env (Vite - producci√≥n/desarrollo)\n    if (typeof import.meta !== 'undefined' && import.meta.env) {\n      console.log('Checking import.meta.env...');\n      for (const k of keyVariants) {\n        const value = import.meta.env[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in import.meta.env`);\n          return value;\n        }\n      }\n    }\n    \n    // 2. Intentar con process.env (Node.js/Vue CLI)\n    if (typeof process !== 'undefined' && process.env) {\n      console.log('Checking process.env...');\n      for (const k of keyVariants) {\n        const value = process.env[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in process.env`);\n          return value;\n        }\n      }\n    }\n    \n    // 3. Intentar con window.__env (configuraci√≥n manual para Vercel)\n    if (typeof window !== 'undefined' && window.__env) {\n      console.log('Checking window.__env...');\n      for (const k of keyVariants) {\n        const value = window.__env[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in window.__env`);\n          return value;\n        }\n      }\n    }\n    \n    // 4. Intentar con window._env_ (otra convenci√≥n com√∫n)\n    if (typeof window !== 'undefined' && window._env_) {\n      console.log('Checking window._env_...');\n      for (const k of keyVariants) {\n        const value = window._env_[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in window._env_`);\n          return value;\n        }\n      }\n    }\n    \n    // 5. Buscar en el objeto window directamente (para Vercel)\n    if (typeof window !== 'undefined') {\n      console.log('Checking window object...');\n      for (const k of keyVariants) {\n        // Vercel a veces inyecta variables con prefijo NEXT_PUBLIC_ o similar\n        const value = window[k];\n        if (value && value !== '') {\n          console.log(`‚úì Found ${k} in window object`);\n          return value;\n        }\n      }\n    }\n    \n    console.log(`‚úó No env found for keys: ${keyVariants.join(', ')}`);\n    return '';\n    \n  } catch (error) {\n    console.error('Error reading environment:', error);\n    return '';\n  }\n};\n\n// Obtener configuraci√≥n con debugging detallado\nconsole.log('=== Loading AI Configuration ===');\n\nconst AI_PROVIDER = (getEnv(['VITE_AI_PROVIDER', 'AI_PROVIDER']) || 'groq').toLowerCase().trim();\nconst GROQ_KEY = getEnv(['VITE_GROQ_API_KEY', 'GROQ_API_KEY', 'VITE_OPENAI_API_KEY', 'OPENAI_API_KEY']).trim();\nconst GROQ_URL = getEnv(['VITE_GROQ_API_URL', 'GROQ_API_URL']) || 'https://api.groq.com/openai/v1/chat/completions';\nconst GROQ_MODEL = getEnv(['VITE_GROQ_MODEL', 'GROQ_MODEL']) || 'mixtral-8x7b-32768';\n\n// Configuraci√≥n para OpenAI (opcional)\nconst OPENAI_KEY = getEnv(['VITE_OPENAI_API_KEY', 'OPENAI_API_KEY']).trim();\nconst OPENAI_URL = getEnv(['VITE_OPENAI_API_URL', 'OPENAI_API_URL']) || 'https://api.openai.com/v1/chat/completions';\nconst OPENAI_MODEL = getEnv(['VITE_OPENAI_MODEL', 'OPENAI_MODEL']) || 'gpt-3.5-turbo';\n\n// Log de configuraci√≥n\nconsole.log('=== AI Configuration Summary ===');\nconsole.log('Provider:', AI_PROVIDER);\nconsole.log('Groq Key present:', GROQ_KEY ? `Yes (${GROQ_KEY.substring(0, 10)}...)` : 'No');\nconsole.log('Groq URL:', GROQ_URL);\nconsole.log('Groq Model:', GROQ_MODEL);\nconsole.log('OpenAI Key present:', OPENAI_KEY ? `Yes (${OPENAI_KEY.substring(0, 10)}...)` : 'No');\nconsole.log('OpenAI URL:', OPENAI_URL);\nconsole.log('OpenAI Model:', OPENAI_MODEL);\nconsole.log('================================');\n\nexport class AIService {\n  constructor() {\n    console.log('=== Creating AIService Instance ===');\n    \n    this.provider = AI_PROVIDER;\n    this.groqKey = GROQ_KEY;\n    this.groqUrl = GROQ_URL;\n    this.groqModel = GROQ_MODEL;\n    this.openaiKey = OPENAI_KEY;\n    this.openaiUrl = OPENAI_URL;\n    this.openaiModel = OPENAI_MODEL;\n    \n    // Verificar disponibilidad\n    this.isAvailable = this.checkAvailability();\n    \n    // M√©todos de ayuda para debugging\n    this.showConfig();\n    \n    console.log('=== AIService Ready ===');\n    console.log(`Status: ${this.isAvailable ? '‚úÖ Available' : '‚ùå Not Available'}`);\n    console.log(`Provider: ${this.provider}`);\n    console.log('========================');\n  }\n\n  checkAvailability() {\n    console.log('=== Checking AI Service Availability ===');\n    \n    if (this.provider === 'groq') {\n      if (this.groqKey && this.groqKey.length > 20) { // Las claves de Groq son largas\n        console.log('‚úÖ Groq service is available');\n        return true;\n      } else {\n        console.warn('‚ùå Groq service NOT available - Invalid or missing API key');\n        console.warn('Key length:', this.groqKey?.length || 0);\n        console.warn('Expected: API key starting with gsk_ and at least 30 characters');\n        return false;\n      }\n    }\n    \n    if (this.provider === 'openai') {\n      if (this.openaiKey && this.openaiKey.length > 20) {\n        console.log('‚úÖ OpenAI service is available');\n        return true;\n      } else {\n        console.warn('‚ùå OpenAI service NOT available - Invalid or missing API key');\n        return false;\n      }\n    }\n    \n    console.warn(`‚ùå Unknown provider: ${this.provider}`);\n    console.warn('Available providers: groq, openai');\n    return false;\n  }\n\n  showConfig() {\n    console.group('üîß AIService Configuration Details');\n    console.log('Provider:', this.provider);\n    console.log('isAvailable:', this.isAvailable);\n    \n    if (this.provider === 'groq') {\n      console.log('Groq Key:', this.groqKey ? `${this.groqKey.substring(0, 10)}...` : 'Not set');\n      console.log('Groq URL:', this.groqUrl);\n      console.log('Groq Model:', this.groqModel);\n    }\n    \n    if (this.provider === 'openai') {\n      console.log('OpenAI Key:', this.openaiKey ? `${this.openaiKey.substring(0, 10)}...` : 'Not set');\n      console.log('OpenAI URL:', this.openaiUrl);\n      console.log('OpenAI Model:', this.openaiModel);\n    }\n    \n    console.groupEnd();\n  }\n\n  // M√©todo principal para enviar prompts\n  async sendPrompt(prompt, options = {}) {\n    if (!this.isAvailable) {\n      console.error('‚ùå Cannot send prompt: AI service not available');\n      throw new Error('Proveedor de IA no configurado. Por favor, configura las variables de entorno.');\n    }\n\n    console.log('üì§ Sending prompt to AI...');\n    console.log('Prompt length:', prompt.length);\n    console.log('Options:', options);\n    console.log('Provider:', this.provider);\n\n    try {\n      let result;\n      \n      if (this.provider === 'groq') {\n        result = await this.sendToGroq(prompt, options);\n      } else if (this.provider === 'openai') {\n        result = await this.sendToOpenAI(prompt, options);\n      } else {\n        throw new Error(`Proveedor no soportado: ${this.provider}`);\n      }\n      \n      console.log('‚úÖ Prompt sent successfully');\n      console.log('Response length:', result?.length || 0);\n      \n      return result;\n      \n    } catch (error) {\n      console.error('‚ùå Error sending prompt:', error);\n      throw error;\n    }\n  }\n\n  // Enviar a Groq\n  async sendToGroq(prompt, options = {}) {\n    console.log('üîÑ Sending to Groq API...');\n    \n    const messages = [\n      { \n        role: 'system', \n        content: options.systemPrompt || 'Eres un asistente √∫til especializado en redacci√≥n de documentos empresariales.'\n      },\n      { role: 'user', content: prompt }\n    ];\n\n    const body = {\n      messages,\n      model: options.model || this.groqModel,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000,\n      stream: false\n    };\n\n    console.log('Request body:', {\n      model: body.model,\n      temperature: body.temperature,\n      max_tokens: body.max_tokens,\n      messages_count: messages.length\n    });\n\n    try {\n      const response = await fetch(this.groqUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.groqKey}`,\n          'User-Agent': 'ProcedimientosApp/1.0'\n        },\n        body: JSON.stringify(body)\n      });\n\n      console.log('Response status:', response.status);\n      console.log('Response status text:', response.statusText);\n\n      if (!response.ok) {\n        let errorText = 'Unknown error';\n        try {\n          errorText = await response.text();\n          console.error('Groq API error response:', errorText);\n        } catch (e) {\n          console.error('Could not read error response:', e);\n        }\n        \n        throw new Error(`Error Groq API (${response.status}): ${errorText}`);\n      }\n\n      const data = await response.json();\n      console.log('Groq response received:', {\n        hasChoices: !!data.choices,\n        choicesLength: data.choices?.length || 0\n      });\n\n      // Extraer contenido de diferentes formatos de respuesta\n      const content = data.choices?.[0]?.message?.content || \n                     data.content || \n                     data.result || \n                     data.output || \n                     (data.choices?.[0]?.text) ||\n                     JSON.stringify(data);\n      \n      if (!content) {\n        console.warn('No content in response:', data);\n        throw new Error('La IA no devolvi√≥ contenido');\n      }\n      \n      return content;\n      \n    } catch (error) {\n      console.error('Groq API call failed:', error);\n      \n      // Mensaje de error amigable\n      if (error.message.includes('401') || error.message.includes('Unauthorized')) {\n        throw new Error('API key inv√°lida. Por favor, verifica tu clave de Groq.');\n      } else if (error.message.includes('429')) {\n        throw new Error('L√≠mite de tasa excedido. Por favor, espera un momento.');\n      } else if (error.message.includes('fetch')) {\n        throw new Error('Error de conexi√≥n. Verifica tu internet.');\n      }\n      \n      throw error;\n    }\n  }\n\n  // Enviar a OpenAI\n  async sendToOpenAI(prompt, options = {}) {\n    console.log('üîÑ Sending to OpenAI API...');\n    \n    const messages = [\n      { \n        role: 'system', \n        content: options.systemPrompt || 'Eres un asistente √∫til especializado en redacci√≥n de documentos empresariales.'\n      },\n      { role: 'user', content: prompt }\n    ];\n\n    const body = {\n      model: options.model || this.openaiModel,\n      messages,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000\n    };\n\n    try {\n      const response = await fetch(this.openaiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.openaiKey}`\n        },\n        body: JSON.stringify(body)\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        console.error('OpenAI API error:', errorData);\n        throw new Error(`Error OpenAI API (${response.status}): ${errorData.error?.message || 'Error desconocido'}`);\n      }\n\n      const data = await response.json();\n      return data.choices?.[0]?.message?.content || data.choices?.[0]?.text || JSON.stringify(data);\n      \n    } catch (error) {\n      console.error('OpenAI API call failed:', error);\n      throw error;\n    }\n  }\n\n  // Analizar procedimiento espec√≠fico\n  async analyzeProcedimiento(texto) {\n    if (!this.isAvailable) {\n      throw new Error('API key no configurada. Configura las variables de entorno correspondientes.');\n    }\n\n    console.log('üîç Analyzing procedure with AI...');\n    console.log('Text length:', texto.length);\n\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad espec√≠fica a realizar\n4. Detecta decisiones (preguntas s√≠/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n\n    const content = await this.sendPrompt(prompt, { \n      temperature: 0.3, \n      max_tokens: 3000,\n      systemPrompt: 'Eres un analista de procesos empresariales. Extrae informaci√≥n estructurada de descripciones de procedimientos y devuelve solo JSON v√°lido.'\n    });\n\n    console.log('‚úÖ Procedure analysis completed');\n    console.log('Response length:', content.length);\n\n    // Intentar extraer JSON desde una respuesta que puede incluir markdown\n    let jsonText = '';\n    \n    // Primero intentar con markdown code blocks\n    const jsonMatch = (content || '').match(/```(?:json)?\\n([\\s\\S]*?)\\n```/) || \n                     (content || '').match(/```([\\s\\S]*?)```/);\n    \n    if (jsonMatch && jsonMatch[1]) {\n      jsonText = jsonMatch[1];\n      console.log('Found JSON in code block');\n    } else {\n      // Intentar encontrar JSON directamente\n      const jsonStart = (content || '').indexOf('{');\n      const jsonEnd = (content || '').lastIndexOf('}');\n      if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {\n        jsonText = (content || '').substring(jsonStart, jsonEnd + 1);\n        console.log('Found JSON in response body');\n      } else {\n        // Si no hay JSON v√°lido, crear estructura b√°sica\n        console.warn('No valid JSON found in response');\n        console.warn('Response content:', content.substring(0, 200) + '...');\n        return { pasos: [] };\n      }\n    }\n\n    try {\n      const result = JSON.parse(jsonText);\n      console.log('‚úÖ JSON parsed successfully');\n      console.log('Steps found:', result.pasos?.length || 0);\n      return result;\n    } catch (error) {\n      console.error('‚ùå Error parsing JSON:', error);\n      console.error('JSON text:', jsonText.substring(0, 200) + '...');\n      throw new Error('No se pudo parsear la respuesta JSON de la IA');\n    }\n  }\n\n  // Generar sugerencia para una secci√≥n espec√≠fica\n  async generarSugerencia(seccion, contenidoActual = '') {\n    if (!this.isAvailable) {\n      console.warn('AI service not available for suggestion');\n      return null;\n    }\n\n    console.log(`üí° Generating suggestion for: ${seccion}`);\n\n    const prompts = {\n      objetivo: `Genera un objetivo profesional para un procedimiento administrativo. \nEl objetivo debe ser: Espec√≠fico, Medible, Alcanzable, Relevante y con Tiempo definido (SMART).\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      \n      alcance: `Define el alcance apropiado para un procedimiento empresarial. \nIncluye: √Åreas/departamentos cubiertos, exclusiones claras, l√≠mites geogr√°ficos o funcionales.\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      \n      responsabilidades: `Lista los roles y responsabilidades t√≠picas para un procedimiento empresarial. \nFormato: 1. [Rol]: [Responsabilidad espec√≠fica]\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      \n      normativa: `Menciona las normativas, pol√≠ticas internas y regulaciones externas relevantes. \nIncluye: Leyes aplicables, pol√≠ticas de la empresa, est√°ndares de calidad.\nContexto actual: ${contenidoActual || 'Ninguno'}`\n    };\n\n    const promptBase = prompts[seccion] || `Completa esta secci√≥n de un documento de procedimientos empresariales.\nContexto actual: ${contenidoActual || 'Ninguno'}`;\n\n    try {\n      const content = await this.sendPrompt(promptBase, { \n        temperature: 0.5, \n        max_tokens: 800 \n      });\n      \n      console.log('‚úÖ Suggestion generated successfully');\n      return content;\n      \n    } catch (error) {\n      console.error('‚ùå Error generating suggestion:', error);\n      return null;\n    }\n  }\n\n  // Mejorar texto de procedimiento\n  async mejorarTextoProcedimiento(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text');\n      return texto;\n    }\n\n    console.log('‚ú® Improving procedure text...');\n    console.log('Original text length:', texto.length);\n\n    try {\n      const prompt = `Eres un editor experto en procedimientos empresariales. Mejora el texto siguiendo estas reglas:\n1. Claridad: Cada oraci√≥n describe un solo paso\n2. Estructura: Usa lenguaje directo (sujeto + verbo + objeto)\n3. Responsables: Identifica claramente qui√©n hace cada acci√≥n\n4. Formato: Incluye decisiones (¬ø...?) y alternativas (Si/No)\n5. Concisi√≥n: Elimina redundancias pero mant√©n precisi√≥n\n6. Formalidad: Usa tono profesional apropiado para documentos empresariales\n\nMejora este texto de procedimiento para hacerlo m√°s claro y estructurado:\n\n${texto}`;\n\n      const content = await this.sendPrompt(prompt, { \n        temperature: 0.4, \n        max_tokens: 2000 \n      });\n      \n      console.log('‚úÖ Text improved successfully');\n      console.log('Improved text length:', content.length);\n      \n      return content || texto;\n      \n    } catch (error) {\n      console.error('‚ùå Error improving text:', error);\n      return texto;\n    }\n  }\n\n  // Sugerir mejoras en tiempo real\n  async sugerirMejorasRapidas(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text');\n      return [];\n    }\n\n    console.log('üí≠ Generating quick improvements...');\n\n    try {\n      const prompt = `Analiza el siguiente texto de un procedimiento empresarial y sugiere 2-3 mejoras r√°pidas y espec√≠ficas.\nEnf√≥cate en: claridad, estructura, formalidad y completitud.\n\nTexto a mejorar: \"${texto}\"\n\nResponde en formato JSON estricto:\n{\n  \"mejoras\": [\n    \"Sugerencia 1 espec√≠fica\",\n    \"Sugerencia 2 espec√≠fica\",\n    \"Sugerencia 3 espec√≠fica\"\n  ]\n}`;\n\n      const content = await this.sendPrompt(prompt, { \n        temperature: 0.3, \n        max_tokens: 500,\n        systemPrompt: 'Eres un editor de documentos empresariales. Analiza textos y sugiere mejoras espec√≠ficas. Devuelve solo JSON v√°lido.'\n      });\n\n      console.log('Quick improvements response:', content);\n\n      // Extraer JSON de la respuesta\n      const jsonMatch = (content || '').match(/{[\\s\\S]*}/);\n      if (jsonMatch) {\n        try {\n          const parsed = JSON.parse(jsonMatch[0]);\n          console.log('‚úÖ Quick improvements generated:', parsed.mejoras?.length || 0);\n          return parsed.mejoras || [];\n        } catch (e) {\n          console.warn('Could not parse JSON from improvements response');\n        }\n      }\n      \n      // Fallback: parsear como array simple\n      const lines = (content || '').split('\\n').filter(line => line.trim());\n      const improvements = lines.slice(0, 3);\n      \n      console.log('Using fallback improvements:', improvements.length);\n      return improvements;\n      \n    } catch (error) {\n      console.error('‚ùå Error generating quick improvements:', error);\n      return [];\n    }\n  }\n\n  // Generar contenido completo para una secci√≥n\n  async generarContenidoSeccion(seccion, contexto = '') {\n    if (!this.isAvailable) {\n      console.warn('AI service not available for content generation');\n      return '';\n    }\n\n    console.log(`üìù Generating content for: ${seccion}`);\n\n    const prompts = {\n      'Objetivo o Prop√≥sito': `Genera un objetivo SMART completo para un procedimiento empresarial.\nDebe incluir:\n1. Prop√≥sito claro\n2. Resultados esperados\n3. M√©tricas de √©xito\n4. Plazos\nContexto: ${contexto}`,\n      \n      'Alcance': `Genera una descripci√≥n completa del alcance para un procedimiento empresarial.\nDebe incluir:\n1. √Åreas y departamentos incluidos\n2. Exclusiones espec√≠ficas\n3. L√≠mites geogr√°ficos y funcionales\n4. Condiciones de aplicaci√≥n\nContexto: ${contexto}`,\n      \n      'Responsabilidades': `Genera una lista completa de responsabilidades para un procedimiento empresarial.\nFormato:\n- [Rol]: [Responsabilidad detallada]\nIncluye al menos 5 roles diferentes.\nContexto: ${contexto}`,\n      \n      'Normativa': `Genera una secci√≥n completa de normativa para un procedimiento empresarial.\nIncluye:\n1. Leyes aplicables\n2. Pol√≠ticas internas\n3. Est√°ndares de calidad\n4. Requisitos regulatorios\n5. Referencias documentales\nContexto: ${contexto}`\n    };\n\n    const prompt = prompts[seccion] || `Genera contenido profesional para la secci√≥n \"${seccion}\" de un documento de procedimientos empresariales.\nContexto: ${contexto}`;\n\n    try {\n      const content = await this.sendPrompt(prompt, { \n        temperature: 0.5, \n        max_tokens: 1000 \n      });\n      \n      console.log('‚úÖ Content generated successfully');\n      console.log('Generated content length:', content.length);\n      \n      return content;\n      \n    } catch (error) {\n      console.error(`‚ùå Error generating content for ${seccion}:`, error);\n      return '';\n    }\n  }\n\n  // Traducir texto\n  async traducirTexto(texto, idiomaDestino = 'ingl√©s') {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text for translation');\n      return texto;\n    }\n\n    console.log(`üåç Translating text to ${idiomaDestino}...`);\n    console.log('Text length:', texto.length);\n\n    try {\n      const prompt = `Traduce el siguiente texto al ${idiomaDestino}. Mant√©n el tono formal y profesional del texto original.\n      \nTexto a traducir: \"${texto}\"`;\n\n      const translated = await this.sendPrompt(prompt, { \n        temperature: 0.2, \n        max_tokens: 1500 \n      });\n      \n      console.log('‚úÖ Text translated successfully');\n      console.log('Translated length:', translated.length);\n      \n      return translated;\n      \n    } catch (error) {\n      console.error('‚ùå Error translating text:', error);\n      return texto;\n    }\n  }\n\n  // Resumir texto\n  async resumirTexto(texto, maxPalabras = 200) {\n    if (!this.isAvailable || !texto.trim()) {\n      console.warn('AI service not available or empty text for summary');\n      return texto;\n    }\n\n    console.log(`üìã Summarizing text (max ${maxPalabras} words)...`);\n    console.log('Original text length:', texto.length);\n\n    try {\n      const prompt = `Resume el siguiente texto en aproximadamente ${maxPalabras} palabras. Mant√©n los puntos clave y el tono profesional.\n      \nTexto a resumir: \"${texto}\"`;\n\n      const summary = await this.sendPrompt(prompt, { \n        temperature: 0.3, \n        max_tokens: 500 \n      });\n      \n      console.log('‚úÖ Text summarized successfully');\n      console.log('Summary length:', summary.length);\n      \n      return summary;\n      \n    } catch (error) {\n      console.error('‚ùå Error summarizing text:', error);\n      return texto;\n    }\n  }\n}\n\n// Instancia exportada\nexport const aiService = new AIService();\n\n// Funci√≥n de utilidad para formatear texto HTML\nexport const formatHTMLFromText = (text) => {\n  if (!text) return '';\n  \n  // Reemplazar saltos de l√≠nea con <br> y p√°rrafos\n  const lines = text.split('\\n').filter(line => line.trim());\n  const paragraphs = lines.map(line => `<p>${line.trim()}</p>`);\n  \n  return paragraphs.join('');\n};\n\n// Funci√≥n para extraer texto limpio de HTML\nexport const extractTextFromHTML = (html) => {\n  if (typeof document === 'undefined') {\n    // Fallback para SSR\n    return html.replace(/<[^>]*>/g, '').replace(/\\s+/g, ' ').trim();\n  }\n  \n  const div = document.createElement('div');\n  div.innerHTML = html;\n  return div.textContent || div.innerText || '';\n};\n\n// Exponer el servicio para debugging\nif (typeof window !== 'undefined') {\n  window.__aiService = aiService;\n  console.log('AIService exposed globally as window.__aiService');\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}