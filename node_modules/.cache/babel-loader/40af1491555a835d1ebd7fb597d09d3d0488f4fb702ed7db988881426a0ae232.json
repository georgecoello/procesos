{"ast":null,"code":"// src/mixins/versionMixin.js\n\nimport { getVersionManager } from '@/utils/VersionManager';\nimport { getStorageService } from '@/services/storageServices';\n\n/**\n * Mixin para funcionalidad de control de versiones\n * Puede ser usado en cualquier componente Vue que necesite versionado\n */\nexport const versionMixin = {\n  data() {\n    return {\n      // Instancias de servicios\n      versionManager: null,\n      storageService: null,\n      // Configuraci√≥n\n      versionConfig: {\n        autoSave: true,\n        autoSaveInterval: 30000,\n        // 30 segundos\n        maxVersions: 10,\n        enableNotifications: true,\n        backupToStorage: true\n      },\n      // Estado\n      hasUnsavedChanges: false,\n      lastSavedTime: null,\n      isAutoSaving: false,\n      autoSaveTimer: null,\n      // Datos\n      documentVersions: [],\n      versionHistory: [],\n      currentVersionIndex: 0,\n      // UI\n      showVersionHistory: false,\n      selectedVersion: null\n    };\n  },\n  computed: {\n    /**\n     * Versi√≥n actual\n     */\n    currentVersion() {\n      return this.documentVersions[this.currentVersionIndex];\n    },\n    /**\n     * Estad√≠sticas del documento\n     */\n    documentStats() {\n      if (!this.currentVersion) {\n        return {\n          wordCount: 0,\n          completion: 0,\n          sections: 0,\n          lastSaved: 'Nunca'\n        };\n      }\n      return {\n        wordCount: this.currentVersion.stats?.wordCount || 0,\n        completion: this.currentVersion.stats?.completionPercentage || 0,\n        sections: this.currentVersion.stats?.sectionCount || 0,\n        lastSaved: this.formatDate(this.currentVersion.timestamp)\n      };\n    },\n    /**\n     * ¬øTiene cambios sin guardar?\n     */\n    hasUnsavedChangesMessage() {\n      return this.hasUnsavedChanges ? '‚ö†Ô∏è Tienes cambios sin guardar' : '';\n    }\n  },\n  created() {\n    // Inicializar servicios\n    this.initializeServices();\n\n    // Configurar autoguardado si est√° habilitado\n    if (this.versionConfig.autoSave) {\n      this.setupAutoSave();\n    }\n\n    // Configurar detecci√≥n de cierre de ventana\n    window.addEventListener('beforeunload', this.handleBeforeUnload);\n  },\n  beforeDestroy() {\n    // Limpiar timers y event listeners\n    this.cleanupAutoSave();\n    window.removeEventListener('beforeunload', this.handleBeforeUnload);\n\n    // Guardar estado final si hay cambios\n    if (this.hasUnsavedChanges) {\n      this.autoSaveDocument();\n    }\n  },\n  methods: {\n    // ============ INICIALIZACI√ìN ============\n\n    /**\n     * Inicializa servicios de versionado\n     */\n    initializeServices(documentId = null) {\n      try {\n        // Obtener ID del documento\n        const docId = documentId || this.getDocumentId();\n\n        // Inicializar VersionManager\n        this.versionManager = getVersionManager(docId, {\n          maxVersions: this.versionConfig.maxVersions,\n          autoSaveInterval: this.versionConfig.autoSaveInterval\n        });\n\n        // Inicializar StorageService\n        this.storageService = getStorageService();\n\n        // Cargar versiones existentes\n        this.loadExistingVersions();\n        console.log('‚úÖ Servicios de versionado inicializados');\n        return true;\n      } catch (error) {\n        console.error('‚ùå Error inicializando servicios de versionado:', error);\n        return false;\n      }\n    },\n    /**\n     * Obtiene ID √∫nico del documento\n     * Sobrescribir en componentes que usen este mixin\n     */\n    getDocumentId() {\n      return 'default_document';\n    },\n    /**\n     * Carga versiones existentes\n     */\n    loadExistingVersions() {\n      if (!this.versionManager) return;\n      this.documentVersions = this.versionManager.versions;\n      this.versionHistory = this.versionManager.history;\n      this.currentVersionIndex = this.versionManager.currentVersionIndex;\n      if (this.documentVersions.length > 0) {\n        this.lastSavedTime = this.documentVersions[0].timestamp;\n        console.log(`üìÇ ${this.documentVersions.length} versiones cargadas`);\n      }\n    },\n    // ============ CAPTURA DE VERSIONES ============\n\n    /**\n     * Captura el estado actual como una nueva versi√≥n\n     */\n    captureCurrentVersion(description = 'Cambios autom√°ticos', type = 'auto') {\n      if (!this.versionManager) {\n        console.warn('‚ö†Ô∏è VersionManager no inicializado');\n        return null;\n      }\n      try {\n        // Obtener datos actuales del documento\n        const documentData = this.getCurrentDocumentData();\n\n        // Validar datos\n        if (!documentData || Object.keys(documentData).length === 0) {\n          console.warn('‚ö†Ô∏è No hay datos para versionar');\n          return null;\n        }\n\n        // Capturar versi√≥n\n        const versionId = this.versionManager.captureVersion(documentData, description, type);\n\n        // Actualizar estado local\n        this.documentVersions = this.versionManager.versions;\n        this.currentVersionIndex = 0;\n        this.lastSavedTime = new Date().toISOString();\n        this.hasUnsavedChanges = false;\n\n        // Notificar si est√° habilitado\n        if (this.versionConfig.enableNotifications && type === 'auto') {\n          this.showVersionNotification('üíæ Cambios guardados autom√°ticamente');\n        }\n        return versionId;\n      } catch (error) {\n        console.error('‚ùå Error capturando versi√≥n:', error);\n        this.showVersionError('Error guardando versi√≥n');\n        return null;\n      }\n    },\n    /**\n     * Captura versi√≥n manualmente\n     */\n    manualSaveVersion(customDescription = null) {\n      const description = customDescription || `Guardado manual - ${new Date().toLocaleString()}`;\n      const versionId = this.captureCurrentVersion(description, 'manual');\n      if (versionId) {\n        this.showVersionNotification('‚úÖ Versi√≥n guardada manualmente');\n      }\n      return versionId;\n    },\n    /**\n     * Obtiene datos actuales del documento\n     * Este m√©todo DEBE ser implementado por el componente que use el mixin\n     */\n    getCurrentDocumentData() {\n      throw new Error('getCurrentDocumentData() debe ser implementado por el componente');\n    },\n    // ============ RESTAURACI√ìN ============\n\n    /**\n     * Restaura una versi√≥n espec√≠fica\n     */\n    restoreVersion(versionId) {\n      if (!this.versionManager) {\n        this.showVersionError('VersionManager no inicializado');\n        return false;\n      }\n\n      // Confirmar si hay cambios sin guardar\n      if (this.hasUnsavedChanges) {\n        if (!confirm('Tienes cambios sin guardar. ¬øRestaurar esta versi√≥n de todos modos?')) {\n          return false;\n        }\n      }\n      try {\n        // Restaurar datos de la versi√≥n\n        const versionData = this.versionManager.restoreVersion(versionId);\n\n        // Actualizar estado local\n        this.currentVersionIndex = this.versionManager.currentVersionIndex;\n        this.documentVersions = this.versionManager.versions;\n        this.hasUnsavedChanges = false;\n\n        // Aplicar datos restaurados al documento\n        this.applyVersionData(versionData);\n\n        // Notificar\n        this.showVersionNotification('üîÑ Versi√≥n restaurada exitosamente');\n        return true;\n      } catch (error) {\n        console.error('‚ùå Error restaurando versi√≥n:', error);\n        this.showVersionError('Error restaurando versi√≥n');\n        return false;\n      }\n    },\n    /**\n     * Aplica datos de una versi√≥n al documento\n     * Este m√©todo DEBE ser implementado por el componente que use el mixin\n     * El par√°metro se nombra con _ para evitar la regla de eslint sobre variables no usadas\n     */\n    applyVersionData() {\n      throw new Error('applyVersionData() debe ser implementado por el componente');\n    },\n    // ============ AUTOGUARDADO ============\n\n    /**\n     * Configura autoguardado autom√°tico\n     */\n    setupAutoSave() {\n      if (this.autoSaveTimer) {\n        clearInterval(this.autoSaveTimer);\n      }\n      this.autoSaveTimer = setInterval(() => {\n        if (this.hasUnsavedChanges && !this.isAutoSaving) {\n          this.autoSaveDocument();\n        }\n      }, this.versionConfig.autoSaveInterval);\n      console.log(`üîÑ Autoguardado configurado cada ${this.versionConfig.autoSaveInterval / 1000} segundos`);\n    },\n    /**\n     * Realiza autoguardado\n     */\n    autoSaveDocument() {\n      if (this.isAutoSaving) return;\n      this.isAutoSaving = true;\n      try {\n        this.captureCurrentVersion(`Auto-guardado ${new Date().toLocaleTimeString()}`, 'auto');\n        if (this.versionConfig.backupToStorage && this.storageService) {\n          this.backupToStorage();\n        }\n      } catch (error) {\n        console.error('‚ùå Error en autoguardado:', error);\n      } finally {\n        this.isAutoSaving = false;\n      }\n    },\n    /**\n     * Limpia el timer de autoguardado\n     */\n    cleanupAutoSave() {\n      if (this.autoSaveTimer) {\n        clearInterval(this.autoSaveTimer);\n        this.autoSaveTimer = null;\n      }\n    },\n    /**\n     * Realiza backup en almacenamiento\n     */\n    async backupToStorage() {\n      if (!this.storageService) return;\n      try {\n        const documentData = this.getCurrentDocumentData();\n        const documentId = this.getDocumentId();\n        await this.storageService.saveDocument(documentData, {\n          documentId: documentId,\n          title: this.getDocumentTitle() || 'Documento sin t√≠tulo',\n          type: 'policy_document_backup'\n        });\n        console.log('üíæ Backup realizado en storage');\n      } catch (error) {\n        console.error('‚ùå Error realizando backup:', error);\n      }\n    },\n    // ============ DETECCI√ìN DE CAMBIOS ============\n\n    /**\n     * Marca el documento como modificado\n     */\n    markAsChanged() {\n      if (!this.hasUnsavedChanges) {\n        this.hasUnsavedChanges = true;\n        this.$emit('document-changed', true);\n      }\n    },\n    /**\n     * Maneja el evento beforeunload\n     */\n    handleBeforeUnload(event) {\n      if (this.hasUnsavedChanges) {\n        event.preventDefault();\n        event.returnValue = 'Tienes cambios sin guardar. ¬øSeguro que quieres salir?';\n\n        // Intentar guardar autom√°ticamente antes de salir\n        this.autoSaveDocument();\n        return event.returnValue;\n      }\n    },\n    // ============ COMPARACI√ìN ============\n\n    /**\n     * Compara dos versiones\n     */\n    compareVersions(versionId1, versionId2) {\n      if (!this.versionManager) {\n        return null;\n      }\n      try {\n        return this.versionManager.compareVersions(versionId1, versionId2);\n      } catch (error) {\n        console.error('‚ùå Error comparando versiones:', error);\n        return null;\n      }\n    },\n    // ============ IMPORT/EXPORT ============\n\n    /**\n     * Exporta todas las versiones\n     */\n    exportAllVersions() {\n      if (!this.versionManager) {\n        this.showVersionError('VersionManager no inicializado');\n        return null;\n      }\n      const exportData = this.versionManager.exportToJSON();\n      const filename = `backup_versions_${new Date().toISOString().split('T')[0]}.json`;\n      return {\n        blob: exportData,\n        filename: filename,\n        stats: this.versionManager.getStats()\n      };\n    },\n    /**\n     * Importa versiones desde archivo\n     */\n    async importVersionsFromFile(file) {\n      if (!this.versionManager) {\n        this.showVersionError('VersionManager no inicializado');\n        return false;\n      }\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = event => {\n          try {\n            const imported = this.versionManager.importFromJSON(event.target.result);\n            if (imported) {\n              // Actualizar estado local\n              this.loadExistingVersions();\n              this.showVersionNotification('üì• Versiones importadas exitosamente');\n              resolve(true);\n            } else {\n              reject(new Error('Error importando versiones'));\n            }\n          } catch (error) {\n            reject(error);\n          }\n        };\n        reader.onerror = () => {\n          reject(new Error('Error leyendo el archivo'));\n        };\n        reader.readAsText(file);\n      });\n    },\n    // ============ UI HELPERS ============\n\n    /**\n     * Formatea una fecha para mostrar\n     */\n    formatDate(timestamp, format = 'full') {\n      if (!timestamp) return 'Nunca';\n      try {\n        const date = new Date(timestamp);\n        switch (format) {\n          case 'short':\n            return date.toLocaleDateString('es-ES');\n          case 'time':\n            return date.toLocaleTimeString('es-ES', {\n              hour: '2-digit',\n              minute: '2-digit'\n            });\n          case 'full':\n          default:\n            return date.toLocaleString('es-ES', {\n              day: '2-digit',\n              month: '2-digit',\n              year: 'numeric',\n              hour: '2-digit',\n              minute: '2-digit'\n            });\n        }\n      } catch (error) {\n        return timestamp;\n      }\n    },\n    /**\n     * Muestra notificaci√≥n de versi√≥n\n     */\n    showVersionNotification(message, type = 'success') {\n      this.$emit('version-notification', {\n        message,\n        type\n      });\n\n      // Tambi√©n podr√≠as usar un sistema de notificaciones global\n      if (typeof this.$notify === 'function') {\n        this.$notify({\n          title: 'Control de Versiones',\n          message: message,\n          type: type\n        });\n      }\n    },\n    /**\n     * Muestra error de versi√≥n\n     */\n    showVersionError(message) {\n      this.showVersionNotification(message, 'error');\n    },\n    // ============ M√âTODOS PARA SOBRESCRIBIR ============\n\n    /**\n     * Obtiene t√≠tulo del documento (para backups)\n     * Sobrescribir si es necesario\n     */\n    getDocumentTitle() {\n      return 'Documento';\n    },\n    /**\n     * Muestra historial de versiones\n     */\n    showVersionHistory() {\n      this.showVersionHistory = true;\n    },\n    /**\n     * Oculta historial de versiones\n     */\n    hideVersionHistory() {\n      this.showVersionHistory = false;\n      this.selectedVersion = null;\n    }\n  }\n};\n\n/**\n * Plugin Vue para funcionalidad de versionado\n */\nexport const VersionPlugin = {\n  install(app, options = {}) {\n    // Configuraci√≥n global\n    const defaultConfig = {\n      autoSave: true,\n      autoSaveInterval: 30000,\n      maxVersions: 10,\n      ...options\n    };\n\n    // Proveer configuraci√≥n global\n    app.provide('versionConfig', defaultConfig);\n\n    // Proveer instancia global del VersionManager\n    app.provide('versionManager', getVersionManager('global', defaultConfig));\n\n    // Proveer instancia global del StorageService\n    app.provide('storageService', getStorageService());\n\n    // Directiva para marcar elementos como \"con cambios\"\n    app.directive('unsaved-changes', {\n      mounted(el, binding) {\n        if (binding.value) {\n          el.classList.add('has-unsaved-changes');\n        }\n      },\n      updated(el, binding) {\n        if (binding.value) {\n          el.classList.add('has-unsaved-changes');\n        } else {\n          el.classList.remove('has-unsaved-changes');\n        }\n      }\n    });\n\n    // Componente global para mostrar estado de versionado\n    app.component('VersionStatus', {\n      template: `\n        <div class=\"version-status\" :class=\"{ 'has-changes': hasChanges }\">\n          <span v-if=\"hasChanges\">‚ö†Ô∏è Cambios sin guardar</span>\n          <span v-else>‚úÖ Todo guardado</span>\n          <span class=\"last-saved\" v-if=\"lastSaved\">\n            (√öltimo guardado: {{ lastSaved }})\n          </span>\n        </div>\n      `,\n      props: {\n        hasChanges: Boolean,\n        lastSaved: String\n      }\n    });\n    console.log('‚úÖ Plugin de versionado instalado');\n  }\n};","map":{"version":3,"names":["getVersionManager","getStorageService","versionMixin","data","versionManager","storageService","versionConfig","autoSave","autoSaveInterval","maxVersions","enableNotifications","backupToStorage","hasUnsavedChanges","lastSavedTime","isAutoSaving","autoSaveTimer","documentVersions","versionHistory","currentVersionIndex","showVersionHistory","selectedVersion","computed","currentVersion","documentStats","wordCount","completion","sections","lastSaved","stats","completionPercentage","sectionCount","formatDate","timestamp","hasUnsavedChangesMessage","created","initializeServices","setupAutoSave","window","addEventListener","handleBeforeUnload","beforeDestroy","cleanupAutoSave","removeEventListener","autoSaveDocument","methods","documentId","docId","getDocumentId","loadExistingVersions","console","log","error","versions","history","length","captureCurrentVersion","description","type","warn","documentData","getCurrentDocumentData","Object","keys","versionId","captureVersion","Date","toISOString","showVersionNotification","showVersionError","manualSaveVersion","customDescription","toLocaleString","Error","restoreVersion","confirm","versionData","applyVersionData","clearInterval","setInterval","toLocaleTimeString","saveDocument","title","getDocumentTitle","markAsChanged","$emit","event","preventDefault","returnValue","compareVersions","versionId1","versionId2","exportAllVersions","exportData","exportToJSON","filename","split","blob","getStats","importVersionsFromFile","file","Promise","resolve","reject","reader","FileReader","onload","imported","importFromJSON","target","result","onerror","readAsText","format","date","toLocaleDateString","hour","minute","day","month","year","message","$notify","hideVersionHistory","VersionPlugin","install","app","options","defaultConfig","provide","directive","mounted","el","binding","value","classList","add","updated","remove","component","template","props","hasChanges","Boolean","String"],"sources":["/home/jorge/Escritorio/Jorge-PC/procesos/procesos/src/mixins/versionMixin.js"],"sourcesContent":["// src/mixins/versionMixin.js\n\nimport { getVersionManager } from '@/utils/VersionManager';\nimport { getStorageService } from '@/services/storageServices';\n\n/**\n * Mixin para funcionalidad de control de versiones\n * Puede ser usado en cualquier componente Vue que necesite versionado\n */\nexport const versionMixin = {\n  data() {\n    return {\n      // Instancias de servicios\n      versionManager: null,\n      storageService: null,\n      \n      // Configuraci√≥n\n      versionConfig: {\n        autoSave: true,\n        autoSaveInterval: 30000, // 30 segundos\n        maxVersions: 10,\n        enableNotifications: true,\n        backupToStorage: true\n      },\n      \n      // Estado\n      hasUnsavedChanges: false,\n      lastSavedTime: null,\n      isAutoSaving: false,\n      autoSaveTimer: null,\n      \n      // Datos\n      documentVersions: [],\n      versionHistory: [],\n      currentVersionIndex: 0,\n      \n      // UI\n      showVersionHistory: false,\n      selectedVersion: null\n    };\n  },\n  \n  computed: {\n    /**\n     * Versi√≥n actual\n     */\n    currentVersion() {\n      return this.documentVersions[this.currentVersionIndex];\n    },\n    \n    /**\n     * Estad√≠sticas del documento\n     */\n    documentStats() {\n      if (!this.currentVersion) {\n        return {\n          wordCount: 0,\n          completion: 0,\n          sections: 0,\n          lastSaved: 'Nunca'\n        };\n      }\n      \n      return {\n        wordCount: this.currentVersion.stats?.wordCount || 0,\n        completion: this.currentVersion.stats?.completionPercentage || 0,\n        sections: this.currentVersion.stats?.sectionCount || 0,\n        lastSaved: this.formatDate(this.currentVersion.timestamp)\n      };\n    },\n    \n    /**\n     * ¬øTiene cambios sin guardar?\n     */\n    hasUnsavedChangesMessage() {\n      return this.hasUnsavedChanges ? '‚ö†Ô∏è Tienes cambios sin guardar' : '';\n    }\n  },\n  \n  created() {\n    // Inicializar servicios\n    this.initializeServices();\n    \n    // Configurar autoguardado si est√° habilitado\n    if (this.versionConfig.autoSave) {\n      this.setupAutoSave();\n    }\n    \n    // Configurar detecci√≥n de cierre de ventana\n    window.addEventListener('beforeunload', this.handleBeforeUnload);\n  },\n  \n  beforeDestroy() {\n    // Limpiar timers y event listeners\n    this.cleanupAutoSave();\n    window.removeEventListener('beforeunload', this.handleBeforeUnload);\n    \n    // Guardar estado final si hay cambios\n    if (this.hasUnsavedChanges) {\n      this.autoSaveDocument();\n    }\n  },\n  \n  methods: {\n    // ============ INICIALIZACI√ìN ============\n    \n    /**\n     * Inicializa servicios de versionado\n     */\n    initializeServices(documentId = null) {\n      try {\n        // Obtener ID del documento\n        const docId = documentId || this.getDocumentId();\n        \n        // Inicializar VersionManager\n        this.versionManager = getVersionManager(docId, {\n          maxVersions: this.versionConfig.maxVersions,\n          autoSaveInterval: this.versionConfig.autoSaveInterval\n        });\n        \n        // Inicializar StorageService\n        this.storageService = getStorageService();\n        \n        // Cargar versiones existentes\n        this.loadExistingVersions();\n        \n        console.log('‚úÖ Servicios de versionado inicializados');\n        return true;\n      } catch (error) {\n        console.error('‚ùå Error inicializando servicios de versionado:', error);\n        return false;\n      }\n    },\n    \n    /**\n     * Obtiene ID √∫nico del documento\n     * Sobrescribir en componentes que usen este mixin\n     */\n    getDocumentId() {\n      return 'default_document';\n    },\n    \n    /**\n     * Carga versiones existentes\n     */\n    loadExistingVersions() {\n      if (!this.versionManager) return;\n      \n      this.documentVersions = this.versionManager.versions;\n      this.versionHistory = this.versionManager.history;\n      this.currentVersionIndex = this.versionManager.currentVersionIndex;\n      \n      if (this.documentVersions.length > 0) {\n        this.lastSavedTime = this.documentVersions[0].timestamp;\n        console.log(`üìÇ ${this.documentVersions.length} versiones cargadas`);\n      }\n    },\n    \n    // ============ CAPTURA DE VERSIONES ============\n    \n    /**\n     * Captura el estado actual como una nueva versi√≥n\n     */\n    captureCurrentVersion(description = 'Cambios autom√°ticos', type = 'auto') {\n      if (!this.versionManager) {\n        console.warn('‚ö†Ô∏è VersionManager no inicializado');\n        return null;\n      }\n      \n      try {\n        // Obtener datos actuales del documento\n        const documentData = this.getCurrentDocumentData();\n        \n        // Validar datos\n        if (!documentData || Object.keys(documentData).length === 0) {\n          console.warn('‚ö†Ô∏è No hay datos para versionar');\n          return null;\n        }\n        \n        // Capturar versi√≥n\n        const versionId = this.versionManager.captureVersion(\n          documentData, \n          description, \n          type\n        );\n        \n        // Actualizar estado local\n        this.documentVersions = this.versionManager.versions;\n        this.currentVersionIndex = 0;\n        this.lastSavedTime = new Date().toISOString();\n        this.hasUnsavedChanges = false;\n        \n        // Notificar si est√° habilitado\n        if (this.versionConfig.enableNotifications && type === 'auto') {\n          this.showVersionNotification('üíæ Cambios guardados autom√°ticamente');\n        }\n        \n        return versionId;\n      } catch (error) {\n        console.error('‚ùå Error capturando versi√≥n:', error);\n        this.showVersionError('Error guardando versi√≥n');\n        return null;\n      }\n    },\n    \n    /**\n     * Captura versi√≥n manualmente\n     */\n    manualSaveVersion(customDescription = null) {\n      const description = customDescription || \n        `Guardado manual - ${new Date().toLocaleString()}`;\n      \n      const versionId = this.captureCurrentVersion(description, 'manual');\n      \n      if (versionId) {\n        this.showVersionNotification('‚úÖ Versi√≥n guardada manualmente');\n      }\n      \n      return versionId;\n    },\n    \n    /**\n     * Obtiene datos actuales del documento\n     * Este m√©todo DEBE ser implementado por el componente que use el mixin\n     */\n    getCurrentDocumentData() {\n      throw new Error('getCurrentDocumentData() debe ser implementado por el componente');\n    },\n    \n    // ============ RESTAURACI√ìN ============\n    \n    /**\n     * Restaura una versi√≥n espec√≠fica\n     */\n    restoreVersion(versionId) {\n      if (!this.versionManager) {\n        this.showVersionError('VersionManager no inicializado');\n        return false;\n      }\n      \n      // Confirmar si hay cambios sin guardar\n      if (this.hasUnsavedChanges) {\n        if (!confirm('Tienes cambios sin guardar. ¬øRestaurar esta versi√≥n de todos modos?')) {\n          return false;\n        }\n      }\n      \n      try {\n        // Restaurar datos de la versi√≥n\n        const versionData = this.versionManager.restoreVersion(versionId);\n        \n        // Actualizar estado local\n        this.currentVersionIndex = this.versionManager.currentVersionIndex;\n        this.documentVersions = this.versionManager.versions;\n        this.hasUnsavedChanges = false;\n        \n        // Aplicar datos restaurados al documento\n        this.applyVersionData(versionData);\n        \n        // Notificar\n        this.showVersionNotification('üîÑ Versi√≥n restaurada exitosamente');\n        \n        return true;\n      } catch (error) {\n        console.error('‚ùå Error restaurando versi√≥n:', error);\n        this.showVersionError('Error restaurando versi√≥n');\n        return false;\n      }\n    },\n    \n    /**\n     * Aplica datos de una versi√≥n al documento\n     * Este m√©todo DEBE ser implementado por el componente que use el mixin\n     * El par√°metro se nombra con _ para evitar la regla de eslint sobre variables no usadas\n     */\n    applyVersionData() {\n      throw new Error('applyVersionData() debe ser implementado por el componente');\n    },\n    \n    // ============ AUTOGUARDADO ============\n    \n    /**\n     * Configura autoguardado autom√°tico\n     */\n    setupAutoSave() {\n      if (this.autoSaveTimer) {\n        clearInterval(this.autoSaveTimer);\n      }\n      \n      this.autoSaveTimer = setInterval(() => {\n        if (this.hasUnsavedChanges && !this.isAutoSaving) {\n          this.autoSaveDocument();\n        }\n      }, this.versionConfig.autoSaveInterval);\n      \n      console.log(`üîÑ Autoguardado configurado cada ${this.versionConfig.autoSaveInterval / 1000} segundos`);\n    },\n    \n    /**\n     * Realiza autoguardado\n     */\n    autoSaveDocument() {\n      if (this.isAutoSaving) return;\n      \n      this.isAutoSaving = true;\n      \n      try {\n        this.captureCurrentVersion(\n          `Auto-guardado ${new Date().toLocaleTimeString()}`,\n          'auto'\n        );\n        \n        if (this.versionConfig.backupToStorage && this.storageService) {\n          this.backupToStorage();\n        }\n      } catch (error) {\n        console.error('‚ùå Error en autoguardado:', error);\n      } finally {\n        this.isAutoSaving = false;\n      }\n    },\n    \n    /**\n     * Limpia el timer de autoguardado\n     */\n    cleanupAutoSave() {\n      if (this.autoSaveTimer) {\n        clearInterval(this.autoSaveTimer);\n        this.autoSaveTimer = null;\n      }\n    },\n    \n    /**\n     * Realiza backup en almacenamiento\n     */\n    async backupToStorage() {\n      if (!this.storageService) return;\n      \n      try {\n        const documentData = this.getCurrentDocumentData();\n        const documentId = this.getDocumentId();\n        \n        await this.storageService.saveDocument(documentData, {\n          documentId: documentId,\n          title: this.getDocumentTitle() || 'Documento sin t√≠tulo',\n          type: 'policy_document_backup'\n        });\n        \n        console.log('üíæ Backup realizado en storage');\n      } catch (error) {\n        console.error('‚ùå Error realizando backup:', error);\n      }\n    },\n    \n    // ============ DETECCI√ìN DE CAMBIOS ============\n    \n    /**\n     * Marca el documento como modificado\n     */\n    markAsChanged() {\n      if (!this.hasUnsavedChanges) {\n        this.hasUnsavedChanges = true;\n        this.$emit('document-changed', true);\n      }\n    },\n    \n    /**\n     * Maneja el evento beforeunload\n     */\n    handleBeforeUnload(event) {\n      if (this.hasUnsavedChanges) {\n        event.preventDefault();\n        event.returnValue = 'Tienes cambios sin guardar. ¬øSeguro que quieres salir?';\n        \n        // Intentar guardar autom√°ticamente antes de salir\n        this.autoSaveDocument();\n        \n        return event.returnValue;\n      }\n    },\n    \n    // ============ COMPARACI√ìN ============\n    \n    /**\n     * Compara dos versiones\n     */\n    compareVersions(versionId1, versionId2) {\n      if (!this.versionManager) {\n        return null;\n      }\n      \n      try {\n        return this.versionManager.compareVersions(versionId1, versionId2);\n      } catch (error) {\n        console.error('‚ùå Error comparando versiones:', error);\n        return null;\n      }\n    },\n    \n    // ============ IMPORT/EXPORT ============\n    \n    /**\n     * Exporta todas las versiones\n     */\n    exportAllVersions() {\n      if (!this.versionManager) {\n        this.showVersionError('VersionManager no inicializado');\n        return null;\n      }\n      \n      const exportData = this.versionManager.exportToJSON();\n      const filename = `backup_versions_${new Date().toISOString().split('T')[0]}.json`;\n      \n      return {\n        blob: exportData,\n        filename: filename,\n        stats: this.versionManager.getStats()\n      };\n    },\n    \n    /**\n     * Importa versiones desde archivo\n     */\n    async importVersionsFromFile(file) {\n      if (!this.versionManager) {\n        this.showVersionError('VersionManager no inicializado');\n        return false;\n      }\n      \n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        \n        reader.onload = (event) => {\n          try {\n            const imported = this.versionManager.importFromJSON(event.target.result);\n            \n            if (imported) {\n              // Actualizar estado local\n              this.loadExistingVersions();\n              this.showVersionNotification('üì• Versiones importadas exitosamente');\n              resolve(true);\n            } else {\n              reject(new Error('Error importando versiones'));\n            }\n          } catch (error) {\n            reject(error);\n          }\n        };\n        \n        reader.onerror = () => {\n          reject(new Error('Error leyendo el archivo'));\n        };\n        \n        reader.readAsText(file);\n      });\n    },\n    \n    // ============ UI HELPERS ============\n    \n    /**\n     * Formatea una fecha para mostrar\n     */\n    formatDate(timestamp, format = 'full') {\n      if (!timestamp) return 'Nunca';\n      \n      try {\n        const date = new Date(timestamp);\n        \n        switch (format) {\n          case 'short':\n            return date.toLocaleDateString('es-ES');\n          case 'time':\n            return date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });\n          case 'full':\n          default:\n            return date.toLocaleString('es-ES', {\n              day: '2-digit',\n              month: '2-digit',\n              year: 'numeric',\n              hour: '2-digit',\n              minute: '2-digit'\n            });\n        }\n      } catch (error) {\n        return timestamp;\n      }\n    },\n    \n    /**\n     * Muestra notificaci√≥n de versi√≥n\n     */\n    showVersionNotification(message, type = 'success') {\n      this.$emit('version-notification', { message, type });\n      \n      // Tambi√©n podr√≠as usar un sistema de notificaciones global\n      if (typeof this.$notify === 'function') {\n        this.$notify({\n          title: 'Control de Versiones',\n          message: message,\n          type: type\n        });\n      }\n    },\n    \n    /**\n     * Muestra error de versi√≥n\n     */\n    showVersionError(message) {\n      this.showVersionNotification(message, 'error');\n    },\n    \n    // ============ M√âTODOS PARA SOBRESCRIBIR ============\n    \n    /**\n     * Obtiene t√≠tulo del documento (para backups)\n     * Sobrescribir si es necesario\n     */\n    getDocumentTitle() {\n      return 'Documento';\n    },\n    \n    /**\n     * Muestra historial de versiones\n     */\n    showVersionHistory() {\n      this.showVersionHistory = true;\n    },\n    \n    /**\n     * Oculta historial de versiones\n     */\n    hideVersionHistory() {\n      this.showVersionHistory = false;\n      this.selectedVersion = null;\n    }\n  }\n};\n\n/**\n * Plugin Vue para funcionalidad de versionado\n */\nexport const VersionPlugin = {\n  install(app, options = {}) {\n    // Configuraci√≥n global\n    const defaultConfig = {\n      autoSave: true,\n      autoSaveInterval: 30000,\n      maxVersions: 10,\n      ...options\n    };\n    \n    // Proveer configuraci√≥n global\n    app.provide('versionConfig', defaultConfig);\n    \n    // Proveer instancia global del VersionManager\n    app.provide('versionManager', getVersionManager('global', defaultConfig));\n    \n    // Proveer instancia global del StorageService\n    app.provide('storageService', getStorageService());\n    \n    // Directiva para marcar elementos como \"con cambios\"\n    app.directive('unsaved-changes', {\n      mounted(el, binding) {\n        if (binding.value) {\n          el.classList.add('has-unsaved-changes');\n        }\n      },\n      updated(el, binding) {\n        if (binding.value) {\n          el.classList.add('has-unsaved-changes');\n        } else {\n          el.classList.remove('has-unsaved-changes');\n        }\n      }\n    });\n    \n    // Componente global para mostrar estado de versionado\n    app.component('VersionStatus', {\n      template: `\n        <div class=\"version-status\" :class=\"{ 'has-changes': hasChanges }\">\n          <span v-if=\"hasChanges\">‚ö†Ô∏è Cambios sin guardar</span>\n          <span v-else>‚úÖ Todo guardado</span>\n          <span class=\"last-saved\" v-if=\"lastSaved\">\n            (√öltimo guardado: {{ lastSaved }})\n          </span>\n        </div>\n      `,\n      props: {\n        hasChanges: Boolean,\n        lastSaved: String\n      }\n    });\n    \n    console.log('‚úÖ Plugin de versionado instalado');\n  }\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}