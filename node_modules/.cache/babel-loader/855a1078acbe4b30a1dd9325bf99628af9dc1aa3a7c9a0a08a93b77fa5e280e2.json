{"ast":null,"code":"// src/services/aiService.js\n// Leer la API key de forma segura tanto para Vue CLI como para Vite\n// Detectar proveedor y claves desde envs (soporta Vue CLI y Vite)\nconst getEnv = keyVariants => {\n  try {\n    for (const k of keyVariants) {\n      if (typeof process !== 'undefined' && process.env && process.env[k]) return process.env[k];\n    }\n    try {\n      if (import.meta && import.meta.env) {\n        for (const k of keyVariants) {\n          if (import.meta.env[k]) return import.meta.env[k];\n        }\n      }\n    } catch (e) {\n      // import.meta not available in some environments\n    }\n  } catch (e) {\n    // ignore\n  }\n  return '';\n};\nconst AI_PROVIDER = getEnv(['AI_PROVIDER', 'VITE_AI_PROVIDER']) || 'openai';\nconst OPENAI_KEY = getEnv(['OPENAI_API_KEY', 'VUE_APP_OPENAI_API_KEY', 'VITE_OPENAI_API_KEY']);\nconst OPENAI_URL = getEnv(['OPENAI_API_URL', 'VITE_OPENAI_API_URL']) || 'https://api.openai.com/v1/chat/completions';\nconst GROQ_KEY = getEnv(['GROQ_API_KEY', 'VITE_GROQ_API_KEY']);\nconst GROQ_URL = getEnv(['GROQ_API_URL', 'VITE_GROQ_API_URL']) || '';\nconst GROQ_MODEL = getEnv(['GROQ_MODEL', 'VITE_GROQ_MODEL']) || '';\nexport class AIService {\n  constructor() {\n    this.provider = (AI_PROVIDER || 'openai').toLowerCase();\n    this.openaiKey = OPENAI_KEY;\n    this.openaiUrl = OPENAI_URL;\n    this.groqKey = GROQ_KEY;\n    this.groqUrl = GROQ_URL;\n    this.groqModel = GROQ_MODEL;\n    this.isAvailable = this.provider === 'openai' && !!this.openaiKey || this.provider === 'groq' && !!this.groqKey && !!this.groqUrl;\n  }\n  async analyzeProcedimiento(texto) {\n    if (!this.isAvailable) {\n      throw new Error('API key no configurada. Configura VITE_OPENAI_API_KEY en .env');\n    }\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad específica a realizar\n4. Detecta decisiones (preguntas sí/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo',\n          // Puedes cambiar a gpt-4 si tienes acceso\n          messages: [{\n            role: 'system',\n            content: 'Eres un analista de procesos empresariales. Extrae información estructurada de descripciones de procedimientos.'\n          }, {\n            role: 'user',\n            content: prompt\n          }],\n          temperature: 0.3,\n          max_tokens: 2000\n        })\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(`Error en API: ${response.status} - ${errorData.error?.message || 'Error desconocido'}`);\n      }\n      const data = await response.json();\n      const content = data.choices[0].message.content;\n\n      // Extraer JSON de la respuesta\n      const jsonMatch = content.match(/```json\\n([\\s\\S]*?)\\n```/) || content.match(/{[\\s\\S]*}/);\n      let jsonText;\n      if (jsonMatch) {\n        jsonText = jsonMatch[0].replace(/```json\\n|\\n```/g, '');\n      } else {\n        // Buscar cualquier objeto JSON en el texto\n        const jsonStart = content.indexOf('{');\n        const jsonEnd = content.lastIndexOf('}');\n        if (jsonStart !== -1 && jsonEnd !== -1) {\n          jsonText = content.substring(jsonStart, jsonEnd + 1);\n        } else {\n          throw new Error('No se encontró JSON en la respuesta');\n        }\n      }\n      return JSON.parse(jsonText);\n    } catch (error) {\n      console.error('Error en análisis de IA:', error);\n      throw error;\n    }\n    // Método adaptador que envía el prompt al proveedor configurado y devuelve texto bruto\n    if (!this.isAvailable) {\n      throw new Error(`API key no configurada para proveedor: ${this.provider}`);\n    }\n    if (this.provider === 'groq') {\n      // En Groq esperamos una API REST POST con { model?, input: prompt }\n      const body = {\n        input: prompt,\n        ...(this.groqModel ? {\n          model: this.groqModel\n        } : {}),\n        ...(options || {})\n      };\n      const resp = await fetch(this.groqUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.groqKey}`\n        },\n        body: JSON.stringify(body)\n      });\n      if (!resp.ok) {\n        const err = await resp.text();\n        throw new Error(`Error Groq API: ${resp.status} - ${err}`);\n      }\n      const data = await resp.json();\n      // Intentar extraer texto de varias posibles rutas en la respuesta\n      return data.output?.[0]?.content || data.output_text || data.choices?.[0]?.text || data.choices?.[0]?.message?.content || data.result || JSON.stringify(data);\n    }\n\n    // Por defecto: OpenAI-style chat completion\n    const messages = [{\n      role: 'system',\n      content: 'Eres un analista de procesos empresariales. Extrae información estructurada de descripciones de procedimientos.'\n    }, {\n      role: 'user',\n      content: prompt\n    }];\n    const resp = await fetch(this.openaiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.openaiKey}`\n      },\n      body: JSON.stringify({\n        model: options.model || 'gpt-3.5-turbo',\n        messages,\n        temperature: options.temperature || 0.3,\n        max_tokens: options.max_tokens || 2000\n      })\n    });\n    if (!resp.ok) {\n      const errorData = await resp.json().catch(() => ({}));\n      throw new Error(`Error OpenAI API: ${resp.status} - ${errorData.error?.message || 'Error desconocido'}`);\n    }\n    const data = await resp.json();\n    return data.choices?.[0]?.message?.content || data.choices?.[0]?.text || JSON.stringify(data);\n  }\n  async analyzeProcedimiento(texto) {\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad específica a realizar\n4. Detecta decisiones (preguntas sí/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n    return this.sendPrompt(prompt);\n  }\n  async generarSugerencia(seccion, contenidoActual = '') {\n    if (!this.isAvailable) {\n      return null;\n    }\n    const prompts = {\n      'objetivo': `Genera un objetivo profesional para un procedimiento administrativo. \n      El objetivo debe ser: Específico, Medible, Alcanzable, Relevante y con Tiempo definido (SMART).`,\n      'alcance': `Define el alcance apropiado para un procedimiento empresarial. \n      Incluye: Áreas/departamentos cubiertos, exclusiones claras, límites geográficos o funcionales.`,\n      'responsabilidades': `Lista los roles y responsabilidades típicas para un procedimiento empresarial. \n      Formato: 1. [Rol]: [Responsabilidad específica]`,\n      'normativa': `Menciona las normativas, políticas internas y regulaciones externas relevantes. \n      Incluye: Leyes aplicables, políticas de la empresa, estándares de calidad.`\n    };\n    const promptBase = prompts[seccion] || `Completa esta sección de un documento de procedimientos empresariales.`;\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo',\n          messages: [{\n            role: 'system',\n            content: 'Eres un consultor experto en documentación de procedimientos empresariales. Proporciona sugerencias profesionales y prácticas.'\n          }, {\n            role: 'user',\n            content: `${promptBase}\\n\\nContexto actual (puede estar vacío): ${contenidoActual}`\n          }],\n          temperature: 0.5,\n          max_tokens: 500\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Error en API: ${response.status}`);\n      }\n      const data = await response.json();\n      return data.choices[0].message.content;\n    } catch (error) {\n      console.error('Error en generación de sugerencia:', error);\n      return null;\n    }\n  }\n  async mejorarTextoProcedimiento(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo',\n          messages: [{\n            role: 'system',\n            content: `Eres un editor experto en procedimientos empresariales. Mejora el texto siguiendo estas reglas:\n1. Claridad: Cada oración describe un solo paso\n2. Estructura: Usa lenguaje directo (sujeto + verbo + objeto)\n3. Responsables: Identifica claramente quién hace cada acción\n4. Formato: Incluye decisiones (¿...?) y alternativas (Si/No)\n5. Concisión: Elimina redundancias pero mantén precisión`\n          }, {\n            role: 'user',\n            content: `Mejora este texto de procedimiento para hacerlo más claro y estructurado:\\n\\n${texto}`\n          }],\n          temperature: 0.4,\n          max_tokens: 1500\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Error en API: ${response.status}`);\n      }\n      const data = await response.json();\n      return data.choices[0].message.content;\n    } catch (error) {\n      console.error('Error en mejora de texto:', error);\n      return texto;\n    }\n  }\n\n  // Nuevo método: Sugerir mejoras en tiempo real\n  async sugerirMejorasRapidas(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return [];\n    }\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo',\n          messages: [{\n            role: 'system',\n            content: 'Analiza el texto y sugiere 2-3 mejoras rápidas. Responde en formato JSON: {\"mejoras\": [\"sugerencia 1\", \"sugerencia 2\"]}'\n          }, {\n            role: 'user',\n            content: `Texto a mejorar: ${texto}`\n          }],\n          temperature: 0.3,\n          max_tokens: 300\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Error en API: ${response.status}`);\n      }\n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      const jsonMatch = content.match(/{[\\s\\S]*}/);\n      if (jsonMatch) {\n        return JSON.parse(jsonMatch[0]).mejoras || [];\n      }\n      return [];\n    } catch (error) {\n      console.error('Error en sugerencias rápidas:', error);\n      return [];\n    }\n  }\n}\n\n// Instancia exportada\nexport const aiService = new AIService();","map":{"version":3,"names":["getEnv","keyVariants","k","process","env","import","meta","e","AI_PROVIDER","OPENAI_KEY","OPENAI_URL","GROQ_KEY","GROQ_URL","GROQ_MODEL","AIService","constructor","provider","toLowerCase","openaiKey","openaiUrl","groqKey","groqUrl","groqModel","isAvailable","analyzeProcedimiento","texto","Error","prompt","response","fetch","API_URL","method","headers","apiKey","body","JSON","stringify","model","messages","role","content","temperature","max_tokens","ok","errorData","json","status","error","message","data","choices","jsonMatch","match","jsonText","replace","jsonStart","indexOf","jsonEnd","lastIndexOf","substring","parse","console","input","options","resp","err","text","output","output_text","result","catch","sendPrompt","generarSugerencia","seccion","contenidoActual","prompts","promptBase","mejorarTextoProcedimiento","trim","sugerirMejorasRapidas","mejoras","aiService"],"sources":["/home/jorge/Escritorio/Jorge-PC/procesos/procesos/src/services/aiService.js"],"sourcesContent":["// src/services/aiService.js\n// Leer la API key de forma segura tanto para Vue CLI como para Vite\n// Detectar proveedor y claves desde envs (soporta Vue CLI y Vite)\nconst getEnv = (keyVariants) => {\n  try {\n    for (const k of keyVariants) {\n      if (typeof process !== 'undefined' && process.env && process.env[k]) return process.env[k];\n    }\n    try {\n      if (import.meta && import.meta.env) {\n        for (const k of keyVariants) {\n          if (import.meta.env[k]) return import.meta.env[k];\n        }\n      }\n    } catch (e) {\n      // import.meta not available in some environments\n    }\n  } catch (e) {\n    // ignore\n  }\n  return '';\n};\n\nconst AI_PROVIDER = getEnv(['AI_PROVIDER', 'VITE_AI_PROVIDER']) || 'openai';\nconst OPENAI_KEY = getEnv(['OPENAI_API_KEY', 'VUE_APP_OPENAI_API_KEY', 'VITE_OPENAI_API_KEY']);\nconst OPENAI_URL = getEnv(['OPENAI_API_URL', 'VITE_OPENAI_API_URL']) || 'https://api.openai.com/v1/chat/completions';\n\nconst GROQ_KEY = getEnv(['GROQ_API_KEY', 'VITE_GROQ_API_KEY']);\nconst GROQ_URL = getEnv(['GROQ_API_URL', 'VITE_GROQ_API_URL']) || '';\nconst GROQ_MODEL = getEnv(['GROQ_MODEL', 'VITE_GROQ_MODEL']) || '';\n\nexport class AIService {\n  constructor() {\n    this.provider = (AI_PROVIDER || 'openai').toLowerCase();\n    this.openaiKey = OPENAI_KEY;\n    this.openaiUrl = OPENAI_URL;\n    this.groqKey = GROQ_KEY;\n    this.groqUrl = GROQ_URL;\n    this.groqModel = GROQ_MODEL;\n\n    this.isAvailable = (this.provider === 'openai' && !!this.openaiKey) || (this.provider === 'groq' && !!this.groqKey && !!this.groqUrl);\n  }\n\n  async analyzeProcedimiento(texto) {\n    if (!this.isAvailable) {\n      throw new Error('API key no configurada. Configura VITE_OPENAI_API_KEY en .env');\n    }\n\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad específica a realizar\n4. Detecta decisiones (preguntas sí/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo', // Puedes cambiar a gpt-4 si tienes acceso\n          messages: [\n            {\n              role: 'system',\n              content: 'Eres un analista de procesos empresariales. Extrae información estructurada de descripciones de procedimientos.'\n            },\n            {\n              role: 'user',\n              content: prompt\n            }\n          ],\n          temperature: 0.3,\n          max_tokens: 2000\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(`Error en API: ${response.status} - ${errorData.error?.message || 'Error desconocido'}`);\n      }\n\n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      \n      // Extraer JSON de la respuesta\n      const jsonMatch = content.match(/```json\\n([\\s\\S]*?)\\n```/) || content.match(/{[\\s\\S]*}/);\n      let jsonText;\n      \n      if (jsonMatch) {\n        jsonText = jsonMatch[0].replace(/```json\\n|\\n```/g, '');\n      } else {\n        // Buscar cualquier objeto JSON en el texto\n        const jsonStart = content.indexOf('{');\n        const jsonEnd = content.lastIndexOf('}');\n        if (jsonStart !== -1 && jsonEnd !== -1) {\n          jsonText = content.substring(jsonStart, jsonEnd + 1);\n        } else {\n          throw new Error('No se encontró JSON en la respuesta');\n        }\n      }\n      \n      return JSON.parse(jsonText);\n    } catch (error) {\n      console.error('Error en análisis de IA:', error);\n      throw error;\n    }\n    // Método adaptador que envía el prompt al proveedor configurado y devuelve texto bruto\n    if (!this.isAvailable) {\n      throw new Error(`API key no configurada para proveedor: ${this.provider}`);\n    }\n\n    if (this.provider === 'groq') {\n      // En Groq esperamos una API REST POST con { model?, input: prompt }\n      const body = {\n        input: prompt,\n        ...(this.groqModel ? { model: this.groqModel } : {}),\n        ...(options || {})\n      };\n\n      const resp = await fetch(this.groqUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.groqKey}`\n        },\n        body: JSON.stringify(body)\n      });\n\n      if (!resp.ok) {\n        const err = await resp.text();\n        throw new Error(`Error Groq API: ${resp.status} - ${err}`);\n      }\n\n      const data = await resp.json();\n      // Intentar extraer texto de varias posibles rutas en la respuesta\n      return data.output?.[0]?.content || data.output_text || data.choices?.[0]?.text || data.choices?.[0]?.message?.content || data.result || JSON.stringify(data);\n    }\n\n    // Por defecto: OpenAI-style chat completion\n    const messages = [\n      { role: 'system', content: 'Eres un analista de procesos empresariales. Extrae información estructurada de descripciones de procedimientos.' },\n      { role: 'user', content: prompt }\n    ];\n\n    const resp = await fetch(this.openaiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.openaiKey}`\n      },\n      body: JSON.stringify({ model: options.model || 'gpt-3.5-turbo', messages, temperature: options.temperature || 0.3, max_tokens: options.max_tokens || 2000 })\n    });\n\n    if (!resp.ok) {\n      const errorData = await resp.json().catch(() => ({}));\n      throw new Error(`Error OpenAI API: ${resp.status} - ${errorData.error?.message || 'Error desconocido'}`);\n    }\n\n    const data = await resp.json();\n    return data.choices?.[0]?.message?.content || data.choices?.[0]?.text || JSON.stringify(data);\n  }\n\n  async analyzeProcedimiento(texto) {\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad específica a realizar\n4. Detecta decisiones (preguntas sí/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n    return this.sendPrompt(prompt);\n  }\n\n  async generarSugerencia(seccion, contenidoActual = '') {\n    if (!this.isAvailable) {\n      return null;\n    }\n\n    const prompts = {\n      'objetivo': `Genera un objetivo profesional para un procedimiento administrativo. \n      El objetivo debe ser: Específico, Medible, Alcanzable, Relevante y con Tiempo definido (SMART).`,\n      \n      'alcance': `Define el alcance apropiado para un procedimiento empresarial. \n      Incluye: Áreas/departamentos cubiertos, exclusiones claras, límites geográficos o funcionales.`,\n      \n      'responsabilidades': `Lista los roles y responsabilidades típicas para un procedimiento empresarial. \n      Formato: 1. [Rol]: [Responsabilidad específica]`,\n      \n      'normativa': `Menciona las normativas, políticas internas y regulaciones externas relevantes. \n      Incluye: Leyes aplicables, políticas de la empresa, estándares de calidad.`\n    };\n\n    const promptBase = prompts[seccion] || `Completa esta sección de un documento de procedimientos empresariales.`;\n\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo',\n          messages: [\n            {\n              role: 'system',\n              content: 'Eres un consultor experto en documentación de procedimientos empresariales. Proporciona sugerencias profesionales y prácticas.'\n            },\n            {\n              role: 'user',\n              content: `${promptBase}\\n\\nContexto actual (puede estar vacío): ${contenidoActual}`\n            }\n          ],\n          temperature: 0.5,\n          max_tokens: 500\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Error en API: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data.choices[0].message.content;\n    } catch (error) {\n      console.error('Error en generación de sugerencia:', error);\n      return null;\n    }\n  }\n\n  async mejorarTextoProcedimiento(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo',\n          messages: [\n            {\n              role: 'system',\n              content: `Eres un editor experto en procedimientos empresariales. Mejora el texto siguiendo estas reglas:\n1. Claridad: Cada oración describe un solo paso\n2. Estructura: Usa lenguaje directo (sujeto + verbo + objeto)\n3. Responsables: Identifica claramente quién hace cada acción\n4. Formato: Incluye decisiones (¿...?) y alternativas (Si/No)\n5. Concisión: Elimina redundancias pero mantén precisión`\n            },\n            {\n              role: 'user',\n              content: `Mejora este texto de procedimiento para hacerlo más claro y estructurado:\\n\\n${texto}`\n            }\n          ],\n          temperature: 0.4,\n          max_tokens: 1500\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Error en API: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data.choices[0].message.content;\n    } catch (error) {\n      console.error('Error en mejora de texto:', error);\n      return texto;\n    }\n  }\n\n  // Nuevo método: Sugerir mejoras en tiempo real\n  async sugerirMejorasRapidas(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return [];\n    }\n\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'gpt-3.5-turbo',\n          messages: [\n            {\n              role: 'system',\n              content: 'Analiza el texto y sugiere 2-3 mejoras rápidas. Responde en formato JSON: {\"mejoras\": [\"sugerencia 1\", \"sugerencia 2\"]}'\n            },\n            {\n              role: 'user',\n              content: `Texto a mejorar: ${texto}`\n            }\n          ],\n          temperature: 0.3,\n          max_tokens: 300\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Error en API: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      const jsonMatch = content.match(/{[\\s\\S]*}/);\n      \n      if (jsonMatch) {\n        return JSON.parse(jsonMatch[0]).mejoras || [];\n      }\n      \n      return [];\n    } catch (error) {\n      console.error('Error en sugerencias rápidas:', error);\n      return [];\n    }\n  }\n}\n\n// Instancia exportada\nexport const aiService = new AIService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}