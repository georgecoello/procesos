{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\n// src/services/aiService.js\n// Leer la API key de forma segura tanto para Vue CLI como para Vite\n// Detectar proveedor y claves desde envs (soporte Vue CLI y Vite)\nconst getEnv = keyVariants => {\n  try {\n    // Primero intentar con process.env (Vue CLI)\n    for (const k of keyVariants) {\n      if (typeof process !== 'undefined' && process.env && process.env[k]) {\n        console.log(`Found ${k} in process.env:`, process.env[k]?.substring(0, 5) + '...');\n        return process.env[k];\n      }\n    }\n\n    // Luego intentar con import.meta.env (Vite)\n    try {\n      if (import.meta && import.meta.env) {\n        for (const k of keyVariants) {\n          if (import.meta.env[k]) {\n            console.log(`Found ${k} in import.meta.env:`, import.meta.env[k]?.substring(0, 5) + '...');\n            return import.meta.env[k];\n          }\n        }\n      }\n    } catch (e) {\n      // import.meta not available in some environments\n      console.log('import.meta not available:', e.message);\n    }\n  } catch (e) {\n    console.error('Error reading env:', e);\n  }\n  return '';\n};\n\n// Detectar proveedor y configuraciones\nconst AI_PROVIDER = getEnv(['VITE_AI_PROVIDER', 'AI_PROVIDER'])?.toLowerCase() || 'openai';\nconst OPENAI_KEY = getEnv(['VITE_OPENAI_API_KEY', 'OPENAI_API_KEY', 'VUE_APP_OPENAI_API_KEY']);\nconst OPENAI_URL = getEnv(['VITE_OPENAI_API_URL', 'OPENAI_API_URL']) || 'https://api.openai.com/v1/chat/completions';\nconst OPENAI_MODEL = getEnv(['VITE_OPENAI_MODEL', 'OPENAI_MODEL']) || 'gpt-3.5-turbo';\nconst GROQ_KEY = getEnv(['VITE_GROQ_API_KEY', 'GROQ_API_KEY']);\nconst GROQ_URL = getEnv(['VITE_GROQ_API_URL', 'GROQ_API_URL']) || 'https://api.groq.com/openai/v1/chat/completions';\nconst GROQ_MODEL = getEnv(['VITE_GROQ_MODEL', 'GROQ_MODEL']) || 'mixtral-8x7b-32768';\nconst ANTHROPIC_KEY = getEnv(['VITE_ANTHROPIC_API_KEY', 'ANTHROPIC_API_KEY']);\nconst ANTHROPIC_URL = getEnv(['VITE_ANTHROPIC_API_URL', 'ANTHROPIC_API_URL']) || 'https://api.anthropic.com/v1/messages';\nconst ANTHROPIC_MODEL = getEnv(['VITE_ANTHROPIC_MODEL', 'ANTHROPIC_MODEL']) || 'claude-3-haiku-20240307';\nconsole.log('AI Service Configuration:', {\n  provider: AI_PROVIDER,\n  openai: !!OPENAI_KEY,\n  groq: !!GROQ_KEY,\n  anthropic: !!ANTHROPIC_KEY,\n  groqModel: GROQ_MODEL,\n  openaiModel: OPENAI_MODEL\n});\nexport class AIService {\n  constructor() {\n    this.provider = AI_PROVIDER;\n    this.openaiKey = OPENAI_KEY;\n    this.openaiUrl = OPENAI_URL;\n    this.openaiModel = OPENAI_MODEL;\n    this.groqKey = GROQ_KEY;\n    this.groqUrl = GROQ_URL;\n    this.groqModel = GROQ_MODEL;\n    this.anthropicKey = ANTHROPIC_KEY;\n    this.anthropicUrl = ANTHROPIC_URL;\n    this.anthropicModel = ANTHROPIC_MODEL;\n\n    // Verificar disponibilidad\n    this.isAvailable = false;\n    this.checkAvailability();\n  }\n  checkAvailability() {\n    if (this.provider === 'openai' && this.openaiKey) {\n      this.isAvailable = true;\n      console.log('✅ OpenAI service available');\n    } else if (this.provider === 'groq' && this.groqKey) {\n      this.isAvailable = true;\n      console.log('✅ Groq service available');\n    } else if (this.provider === 'anthropic' && this.anthropicKey) {\n      this.isAvailable = true;\n      console.log('✅ Anthropic service available');\n    } else {\n      console.warn('❌ AI service not available. Check your environment variables.');\n      console.warn('Provider:', this.provider);\n      console.warn('OpenAI Key:', this.openaiKey ? 'Set' : 'Not set');\n      console.warn('Groq Key:', this.groqKey ? 'Set' : 'Not set');\n      console.warn('Anthropic Key:', this.anthropicKey ? 'Set' : 'Not set');\n    }\n  }\n\n  // Método principal para enviar prompts\n  async sendPrompt(prompt, options = {}) {\n    if (!this.isAvailable) {\n      throw new Error('Proveedor de IA no configurado o faltan credenciales. Revisa tus variables de entorno.');\n    }\n    try {\n      switch (this.provider) {\n        case 'groq':\n          return await this.sendGroqPrompt(prompt, options);\n        case 'anthropic':\n          return await this.sendAnthropicPrompt(prompt, options);\n        case 'openai':\n        default:\n          return await this.sendOpenAIPrompt(prompt, options);\n      }\n    } catch (error) {\n      console.error('Error in AI service:', error);\n      throw error;\n    }\n  }\n\n  // Enviar prompt a Groq\n  async sendGroqPrompt(prompt, options = {}) {\n    const messages = [{\n      role: 'system',\n      content: options.systemPrompt || 'Eres un asistente útil especializado en redacción de documentos empresariales.'\n    }, {\n      role: 'user',\n      content: prompt\n    }];\n    const body = {\n      messages: messages,\n      model: options.model || this.groqModel,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000,\n      stream: false\n    };\n    console.log('Sending request to Groq:', {\n      model: body.model,\n      temperature: body.temperature\n    });\n    const response = await fetch(this.groqUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.groqKey}`,\n        'User-Agent': 'ProcedimientosApp/1.0'\n      },\n      body: JSON.stringify(body)\n    });\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error('Groq API error response:', errorText);\n      throw new Error(`Error Groq API (${response.status}): ${errorText}`);\n    }\n    const data = await response.json();\n\n    // Extraer contenido de diferentes formatos de respuesta\n    const content = data.choices?.[0]?.message?.content || data.content || data.result || data.output || JSON.stringify(data);\n    console.log('Groq response received, length:', content.length);\n    return content;\n  }\n\n  // Enviar prompt a OpenAI\n  async sendOpenAIPrompt(prompt, options = {}) {\n    const messages = [{\n      role: 'system',\n      content: options.systemPrompt || 'Eres un asistente útil especializado en redacción de documentos empresariales.'\n    }, {\n      role: 'user',\n      content: prompt\n    }];\n    const body = {\n      model: options.model || this.openaiModel,\n      messages: messages,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000\n    };\n    const response = await fetch(this.openaiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.openaiKey}`\n      },\n      body: JSON.stringify(body)\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(`Error OpenAI API (${response.status}): ${errorData.error?.message || 'Error desconocido'}`);\n    }\n    const data = await response.json();\n    return data.choices?.[0]?.message?.content || data.choices?.[0]?.text || JSON.stringify(data);\n  }\n\n  // Enviar prompt a Anthropic\n  async sendAnthropicPrompt(prompt, options = {}) {\n    const messages = [{\n      role: 'user',\n      content: prompt\n    }];\n    const body = {\n      model: options.model || this.anthropicModel,\n      messages: messages,\n      system: options.systemPrompt || 'Eres un asistente útil especializado en redacción de documentos empresariales.',\n      max_tokens: options.max_tokens || 2000,\n      temperature: options.temperature ?? 0.3\n    };\n    const response = await fetch(this.anthropicUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-api-key': this.anthropicKey,\n        'anthropic-version': '2023-06-01'\n      },\n      body: JSON.stringify(body)\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(`Error Anthropic API (${response.status}): ${errorData.error?.message || 'Error desconocido'}`);\n    }\n    const data = await response.json();\n    return data.content?.[0]?.text || JSON.stringify(data);\n  }\n\n  // Analizar procedimiento específico\n  async analyzeProcedimiento(texto) {\n    if (!this.isAvailable) {\n      throw new Error('API key no configurada. Configura las variables de entorno correspondientes.');\n    }\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad específica a realizar\n4. Detecta decisiones (preguntas sí/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n    const content = await this.sendPrompt(prompt, {\n      temperature: 0.3,\n      max_tokens: 3000,\n      systemPrompt: 'Eres un analista de procesos empresariales. Extrae información estructurada de descripciones de procedimientos y devuelve solo JSON válido.'\n    });\n\n    // Intentar extraer JSON desde una respuesta que puede incluir markdown\n    let jsonText = '';\n\n    // Primero intentar con markdown code blocks\n    const jsonMatch = (content || '').match(/```(?:json)?\\n([\\s\\S]*?)\\n```/) || (content || '').match(/```([\\s\\S]*?)```/);\n    if (jsonMatch && jsonMatch[1]) {\n      jsonText = jsonMatch[1];\n    } else {\n      // Intentar encontrar JSON directamente\n      const jsonStart = (content || '').indexOf('{');\n      const jsonEnd = (content || '').lastIndexOf('}');\n      if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {\n        jsonText = (content || '').substring(jsonStart, jsonEnd + 1);\n      } else {\n        // Si no hay JSON válido, crear estructura básica\n        console.warn('No se encontró JSON válido en la respuesta:', content);\n        return {\n          pasos: []\n        };\n      }\n    }\n    try {\n      return JSON.parse(jsonText);\n    } catch (error) {\n      console.error('Error parsing JSON:', error);\n      console.error('JSON text:', jsonText);\n      throw new Error('No se pudo parsear la respuesta JSON de la IA');\n    }\n  }\n\n  // Generar sugerencia para una sección específica\n  async generarSugerencia(seccion, contenidoActual = '') {\n    if (!this.isAvailable) {\n      return null;\n    }\n    const prompts = {\n      objetivo: `Genera un objetivo profesional para un procedimiento administrativo. \nEl objetivo debe ser: Específico, Medible, Alcanzable, Relevante y con Tiempo definido (SMART).\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      alcance: `Define el alcance apropiado para un procedimiento empresarial. \nIncluye: Áreas/departamentos cubiertos, exclusiones claras, límites geográficos o funcionales.\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      responsabilidades: `Lista los roles y responsabilidades típicas para un procedimiento empresarial. \nFormato: 1. [Rol]: [Responsabilidad específica]\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      normativa: `Menciona las normativas, políticas internas y regulaciones externas relevantes. \nIncluye: Leyes aplicables, políticas de la empresa, estándares de calidad.\nContexto actual: ${contenidoActual || 'Ninguno'}`\n    };\n    const promptBase = prompts[seccion] || `Completa esta sección de un documento de procedimientos empresariales.\nContexto actual: ${contenidoActual || 'Ninguno'}`;\n    try {\n      const content = await this.sendPrompt(promptBase, {\n        temperature: 0.5,\n        max_tokens: 800\n      });\n      return content;\n    } catch (error) {\n      console.error('Error en generación de sugerencia:', error);\n      return null;\n    }\n  }\n\n  // Mejorar texto de procedimiento\n  async mejorarTextoProcedimiento(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n    try {\n      const prompt = `Eres un editor experto en procedimientos empresariales. Mejora el texto siguiendo estas reglas:\n1. Claridad: Cada oración describe un solo paso\n2. Estructura: Usa lenguaje directo (sujeto + verbo + objeto)\n3. Responsables: Identifica claramente quién hace cada acción\n4. Formato: Incluye decisiones (¿...?) y alternativas (Si/No)\n5. Concisión: Elimina redundancias pero mantén precisión\n6. Formalidad: Usa tono profesional apropiado para documentos empresariales\n\nMejora este texto de procedimiento para hacerlo más claro y estructurado:\n\n${texto}`;\n      const content = await this.sendPrompt(prompt, {\n        temperature: 0.4,\n        max_tokens: 2000\n      });\n      return content || texto;\n    } catch (error) {\n      console.error('Error en mejora de texto:', error);\n      return texto;\n    }\n  }\n\n  // Sugerir mejoras en tiempo real\n  async sugerirMejorasRapidas(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return [];\n    }\n    try {\n      const prompt = `Analiza el siguiente texto de un procedimiento empresarial y sugiere 2-3 mejoras rápidas y específicas.\nEnfócate en: claridad, estructura, formalidad y completitud.\n\nTexto a mejorar: \"${texto}\"\n\nResponde en formato JSON estricto:\n{\n  \"mejoras\": [\n    \"Sugerencia 1 específica\",\n    \"Sugerencia 2 específica\",\n    \"Sugerencia 3 específica\"\n  ]\n}`;\n      const content = await this.sendPrompt(prompt, {\n        temperature: 0.3,\n        max_tokens: 500,\n        systemPrompt: 'Eres un editor de documentos empresariales. Analiza textos y sugiere mejoras específicas. Devuelve solo JSON válido.'\n      });\n\n      // Extraer JSON de la respuesta\n      const jsonMatch = (content || '').match(/{[\\s\\S]*}/);\n      if (jsonMatch) {\n        const parsed = JSON.parse(jsonMatch[0]);\n        return parsed.mejoras || [];\n      }\n\n      // Fallback: parsear como array simple\n      const lines = (content || '').split('\\n').filter(line => line.trim());\n      return lines.slice(0, 3);\n    } catch (error) {\n      console.error('Error en sugerencias rápidas:', error);\n      return [];\n    }\n  }\n\n  // Generar contenido completo para una sección\n  async generarContenidoSeccion(seccion, contexto = '') {\n    if (!this.isAvailable) {\n      return '';\n    }\n    const prompts = {\n      'Objetivo o Propósito': `Genera un objetivo SMART completo para un procedimiento empresarial.\nDebe incluir:\n1. Propósito claro\n2. Resultados esperados\n3. Métricas de éxito\n4. Plazos\nContexto: ${contexto}`,\n      'Alcance': `Genera una descripción completa del alcance para un procedimiento empresarial.\nDebe incluir:\n1. Áreas y departamentos incluidos\n2. Exclusiones específicas\n3. Límites geográficos y funcionales\n4. Condiciones de aplicación\nContexto: ${contexto}`,\n      'Responsabilidades': `Genera una lista completa de responsabilidades para un procedimiento empresarial.\nFormato:\n- [Rol]: [Responsabilidad detallada]\nIncluye al menos 5 roles diferentes.\nContexto: ${contexto}`,\n      'Normativa': `Genera una sección completa de normativa para un procedimiento empresarial.\nIncluye:\n1. Leyes aplicables\n2. Políticas internas\n3. Estándares de calidad\n4. Requisitos regulatorios\n5. Referencias documentales\nContexto: ${contexto}`\n    };\n    const prompt = prompts[seccion] || `Genera contenido profesional para la sección \"${seccion}\" de un documento de procedimientos empresariales.\nContexto: ${contexto}`;\n    try {\n      return await this.sendPrompt(prompt, {\n        temperature: 0.5,\n        max_tokens: 1000\n      });\n    } catch (error) {\n      console.error(`Error generando contenido para ${seccion}:`, error);\n      return '';\n    }\n  }\n\n  // Traducir texto\n  async traducirTexto(texto, idiomaDestino = 'inglés') {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n    try {\n      const prompt = `Traduce el siguiente texto al ${idiomaDestino}. Mantén el tono formal y profesional del texto original.\n      \nTexto a traducir: \"${texto}\"`;\n      return await this.sendPrompt(prompt, {\n        temperature: 0.2,\n        max_tokens: 1500\n      });\n    } catch (error) {\n      console.error('Error traduciendo texto:', error);\n      return texto;\n    }\n  }\n\n  // Resumir texto\n  async resumirTexto(texto, maxPalabras = 200) {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n    try {\n      const prompt = `Resume el siguiente texto en aproximadamente ${maxPalabras} palabras. Mantén los puntos clave y el tono profesional.\n      \nTexto a resumir: \"${texto}\"`;\n      return await this.sendPrompt(prompt, {\n        temperature: 0.3,\n        max_tokens: 500\n      });\n    } catch (error) {\n      console.error('Error resumiendo texto:', error);\n      return texto;\n    }\n  }\n}\n\n// Instancia exportada\nexport const aiService = new AIService();\n\n// Función de utilidad para formatear texto HTML\nexport const formatHTMLFromText = text => {\n  if (!text) return '';\n\n  // Reemplazar saltos de línea con <br> y párrafos\n  const lines = text.split('\\n').filter(line => line.trim());\n  const paragraphs = lines.map(line => `<p>${line.trim()}</p>`);\n\n  // Detectar listas\n  const formatted = paragraphs.join('');\n  return formatted;\n};\n\n// Función para extraer texto limpio de HTML\nexport const extractTextFromHTML = html => {\n  if (typeof document === 'undefined') {\n    // Fallback para SSR\n    return html.replace(/<[^>]*>/g, '').replace(/\\s+/g, ' ').trim();\n  }\n  const div = document.createElement('div');\n  div.innerHTML = html;\n  return div.textContent || div.innerText || '';\n};","map":{"version":3,"names":["getEnv","keyVariants","k","process","env","console","log","substring","import","meta","e","message","error","AI_PROVIDER","toLowerCase","OPENAI_KEY","OPENAI_URL","OPENAI_MODEL","GROQ_KEY","GROQ_URL","GROQ_MODEL","ANTHROPIC_KEY","ANTHROPIC_URL","ANTHROPIC_MODEL","provider","openai","groq","anthropic","groqModel","openaiModel","AIService","constructor","openaiKey","openaiUrl","groqKey","groqUrl","anthropicKey","anthropicUrl","anthropicModel","isAvailable","checkAvailability","warn","sendPrompt","prompt","options","Error","sendGroqPrompt","sendAnthropicPrompt","sendOpenAIPrompt","messages","role","content","systemPrompt","body","model","temperature","max_tokens","stream","response","fetch","method","headers","JSON","stringify","ok","errorText","text","status","data","json","choices","result","output","length","errorData","catch","system","analyzeProcedimiento","texto","jsonText","jsonMatch","match","jsonStart","indexOf","jsonEnd","lastIndexOf","pasos","parse","generarSugerencia","seccion","contenidoActual","prompts","objetivo","alcance","responsabilidades","normativa","promptBase","mejorarTextoProcedimiento","trim","sugerirMejorasRapidas","parsed","mejoras","lines","split","filter","line","slice","generarContenidoSeccion","contexto","traducirTexto","idiomaDestino","resumirTexto","maxPalabras","aiService","formatHTMLFromText","paragraphs","map","formatted","join","extractTextFromHTML","html","document","replace","div","createElement","innerHTML","textContent","innerText"],"sources":["/home/jorge/Escritorio/Jorge-PC/procesos/procesos/src/services/aiService.js"],"sourcesContent":["// src/services/aiService.js\n// Leer la API key de forma segura tanto para Vue CLI como para Vite\n// Detectar proveedor y claves desde envs (soporte Vue CLI y Vite)\nconst getEnv = (keyVariants) => {\n  try {\n    // Primero intentar con process.env (Vue CLI)\n    for (const k of keyVariants) {\n      if (typeof process !== 'undefined' && process.env && process.env[k]) {\n        console.log(`Found ${k} in process.env:`, process.env[k]?.substring(0, 5) + '...');\n        return process.env[k];\n      }\n    }\n    \n    // Luego intentar con import.meta.env (Vite)\n    try {\n      if (import.meta && import.meta.env) {\n        for (const k of keyVariants) {\n          if (import.meta.env[k]) {\n            console.log(`Found ${k} in import.meta.env:`, import.meta.env[k]?.substring(0, 5) + '...');\n            return import.meta.env[k];\n          }\n        }\n      }\n    } catch (e) {\n      // import.meta not available in some environments\n      console.log('import.meta not available:', e.message);\n    }\n  } catch (e) {\n    console.error('Error reading env:', e);\n  }\n  return '';\n};\n\n// Detectar proveedor y configuraciones\nconst AI_PROVIDER = getEnv(['VITE_AI_PROVIDER', 'AI_PROVIDER'])?.toLowerCase() || 'openai';\nconst OPENAI_KEY = getEnv(['VITE_OPENAI_API_KEY', 'OPENAI_API_KEY', 'VUE_APP_OPENAI_API_KEY']);\nconst OPENAI_URL = getEnv(['VITE_OPENAI_API_URL', 'OPENAI_API_URL']) || 'https://api.openai.com/v1/chat/completions';\nconst OPENAI_MODEL = getEnv(['VITE_OPENAI_MODEL', 'OPENAI_MODEL']) || 'gpt-3.5-turbo';\n\nconst GROQ_KEY = getEnv(['VITE_GROQ_API_KEY', 'GROQ_API_KEY']);\nconst GROQ_URL = getEnv(['VITE_GROQ_API_URL', 'GROQ_API_URL']) || 'https://api.groq.com/openai/v1/chat/completions';\nconst GROQ_MODEL = getEnv(['VITE_GROQ_MODEL', 'GROQ_MODEL']) || 'mixtral-8x7b-32768';\n\nconst ANTHROPIC_KEY = getEnv(['VITE_ANTHROPIC_API_KEY', 'ANTHROPIC_API_KEY']);\nconst ANTHROPIC_URL = getEnv(['VITE_ANTHROPIC_API_URL', 'ANTHROPIC_API_URL']) || 'https://api.anthropic.com/v1/messages';\nconst ANTHROPIC_MODEL = getEnv(['VITE_ANTHROPIC_MODEL', 'ANTHROPIC_MODEL']) || 'claude-3-haiku-20240307';\n\nconsole.log('AI Service Configuration:', {\n  provider: AI_PROVIDER,\n  openai: !!OPENAI_KEY,\n  groq: !!GROQ_KEY,\n  anthropic: !!ANTHROPIC_KEY,\n  groqModel: GROQ_MODEL,\n  openaiModel: OPENAI_MODEL\n});\n\nexport class AIService {\n  constructor() {\n    this.provider = AI_PROVIDER;\n    this.openaiKey = OPENAI_KEY;\n    this.openaiUrl = OPENAI_URL;\n    this.openaiModel = OPENAI_MODEL;\n    this.groqKey = GROQ_KEY;\n    this.groqUrl = GROQ_URL;\n    this.groqModel = GROQ_MODEL;\n    this.anthropicKey = ANTHROPIC_KEY;\n    this.anthropicUrl = ANTHROPIC_URL;\n    this.anthropicModel = ANTHROPIC_MODEL;\n\n    // Verificar disponibilidad\n    this.isAvailable = false;\n    this.checkAvailability();\n  }\n\n  checkAvailability() {\n    if (this.provider === 'openai' && this.openaiKey) {\n      this.isAvailable = true;\n      console.log('✅ OpenAI service available');\n    } else if (this.provider === 'groq' && this.groqKey) {\n      this.isAvailable = true;\n      console.log('✅ Groq service available');\n    } else if (this.provider === 'anthropic' && this.anthropicKey) {\n      this.isAvailable = true;\n      console.log('✅ Anthropic service available');\n    } else {\n      console.warn('❌ AI service not available. Check your environment variables.');\n      console.warn('Provider:', this.provider);\n      console.warn('OpenAI Key:', this.openaiKey ? 'Set' : 'Not set');\n      console.warn('Groq Key:', this.groqKey ? 'Set' : 'Not set');\n      console.warn('Anthropic Key:', this.anthropicKey ? 'Set' : 'Not set');\n    }\n  }\n\n  // Método principal para enviar prompts\n  async sendPrompt(prompt, options = {}) {\n    if (!this.isAvailable) {\n      throw new Error('Proveedor de IA no configurado o faltan credenciales. Revisa tus variables de entorno.');\n    }\n\n    try {\n      switch (this.provider) {\n        case 'groq':\n          return await this.sendGroqPrompt(prompt, options);\n        case 'anthropic':\n          return await this.sendAnthropicPrompt(prompt, options);\n        case 'openai':\n        default:\n          return await this.sendOpenAIPrompt(prompt, options);\n      }\n    } catch (error) {\n      console.error('Error in AI service:', error);\n      throw error;\n    }\n  }\n\n  // Enviar prompt a Groq\n  async sendGroqPrompt(prompt, options = {}) {\n    const messages = [\n      { \n        role: 'system', \n        content: options.systemPrompt || 'Eres un asistente útil especializado en redacción de documentos empresariales.' \n      },\n      { role: 'user', content: prompt }\n    ];\n\n    const body = {\n      messages: messages,\n      model: options.model || this.groqModel,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000,\n      stream: false\n    };\n\n    console.log('Sending request to Groq:', {\n      model: body.model,\n      temperature: body.temperature\n    });\n\n    const response = await fetch(this.groqUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.groqKey}`,\n        'User-Agent': 'ProcedimientosApp/1.0'\n      },\n      body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error('Groq API error response:', errorText);\n      throw new Error(`Error Groq API (${response.status}): ${errorText}`);\n    }\n\n    const data = await response.json();\n    \n    // Extraer contenido de diferentes formatos de respuesta\n    const content = data.choices?.[0]?.message?.content || \n                   data.content || \n                   data.result || \n                   data.output || \n                   JSON.stringify(data);\n    \n    console.log('Groq response received, length:', content.length);\n    return content;\n  }\n\n  // Enviar prompt a OpenAI\n  async sendOpenAIPrompt(prompt, options = {}) {\n    const messages = [\n      { \n        role: 'system', \n        content: options.systemPrompt || 'Eres un asistente útil especializado en redacción de documentos empresariales.' \n      },\n      { role: 'user', content: prompt }\n    ];\n\n    const body = {\n      model: options.model || this.openaiModel,\n      messages: messages,\n      temperature: options.temperature ?? 0.3,\n      max_tokens: options.max_tokens || 2000\n    };\n\n    const response = await fetch(this.openaiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.openaiKey}`\n      },\n      body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(`Error OpenAI API (${response.status}): ${errorData.error?.message || 'Error desconocido'}`);\n    }\n\n    const data = await response.json();\n    return data.choices?.[0]?.message?.content || data.choices?.[0]?.text || JSON.stringify(data);\n  }\n\n  // Enviar prompt a Anthropic\n  async sendAnthropicPrompt(prompt, options = {}) {\n    const messages = [\n      {\n        role: 'user',\n        content: prompt\n      }\n    ];\n\n    const body = {\n      model: options.model || this.anthropicModel,\n      messages: messages,\n      system: options.systemPrompt || 'Eres un asistente útil especializado en redacción de documentos empresariales.',\n      max_tokens: options.max_tokens || 2000,\n      temperature: options.temperature ?? 0.3\n    };\n\n    const response = await fetch(this.anthropicUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-api-key': this.anthropicKey,\n        'anthropic-version': '2023-06-01'\n      },\n      body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(`Error Anthropic API (${response.status}): ${errorData.error?.message || 'Error desconocido'}`);\n    }\n\n    const data = await response.json();\n    return data.content?.[0]?.text || JSON.stringify(data);\n  }\n\n  // Analizar procedimiento específico\n  async analyzeProcedimiento(texto) {\n    if (!this.isAvailable) {\n      throw new Error('API key no configurada. Configura las variables de entorno correspondientes.');\n    }\n\n    const prompt = `Analiza el siguiente texto que describe un procedimiento empresarial. Extrae:\n1. Cada paso secuencial del procedimiento\n2. El responsable o rol de cada paso\n3. La actividad específica a realizar\n4. Detecta decisiones (preguntas sí/no), alternativas y finalizaciones\n\nFormato de respuesta JSON:\n{\n  \"pasos\": [\n    {\n      \"numero\": \"5.1\",\n      \"responsable\": \"Administrador\",\n      \"actividad\": \"Revisar lista de proveedores a pagar\",\n      \"tipo\": \"normal|decision|alternativa|fin\",\n      \"subpasos\": [\n        {\n          \"numero\": \"a\",\n          \"responsable\": \"Administrador\",\n          \"actividad\": \"Verificar documentos de respaldo\"\n        }\n      ]\n    }\n  ]\n}\n\nTexto del procedimiento:\n${texto}`;\n\n    const content = await this.sendPrompt(prompt, { \n      temperature: 0.3, \n      max_tokens: 3000,\n      systemPrompt: 'Eres un analista de procesos empresariales. Extrae información estructurada de descripciones de procedimientos y devuelve solo JSON válido.'\n    });\n\n    // Intentar extraer JSON desde una respuesta que puede incluir markdown\n    let jsonText = '';\n    \n    // Primero intentar con markdown code blocks\n    const jsonMatch = (content || '').match(/```(?:json)?\\n([\\s\\S]*?)\\n```/) || \n                     (content || '').match(/```([\\s\\S]*?)```/);\n    \n    if (jsonMatch && jsonMatch[1]) {\n      jsonText = jsonMatch[1];\n    } else {\n      // Intentar encontrar JSON directamente\n      const jsonStart = (content || '').indexOf('{');\n      const jsonEnd = (content || '').lastIndexOf('}');\n      if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {\n        jsonText = (content || '').substring(jsonStart, jsonEnd + 1);\n      } else {\n        // Si no hay JSON válido, crear estructura básica\n        console.warn('No se encontró JSON válido en la respuesta:', content);\n        return { pasos: [] };\n      }\n    }\n\n    try {\n      return JSON.parse(jsonText);\n    } catch (error) {\n      console.error('Error parsing JSON:', error);\n      console.error('JSON text:', jsonText);\n      throw new Error('No se pudo parsear la respuesta JSON de la IA');\n    }\n  }\n\n  // Generar sugerencia para una sección específica\n  async generarSugerencia(seccion, contenidoActual = '') {\n    if (!this.isAvailable) {\n      return null;\n    }\n\n    const prompts = {\n      objetivo: `Genera un objetivo profesional para un procedimiento administrativo. \nEl objetivo debe ser: Específico, Medible, Alcanzable, Relevante y con Tiempo definido (SMART).\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      \n      alcance: `Define el alcance apropiado para un procedimiento empresarial. \nIncluye: Áreas/departamentos cubiertos, exclusiones claras, límites geográficos o funcionales.\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      \n      responsabilidades: `Lista los roles y responsabilidades típicas para un procedimiento empresarial. \nFormato: 1. [Rol]: [Responsabilidad específica]\nContexto actual: ${contenidoActual || 'Ninguno'}`,\n      \n      normativa: `Menciona las normativas, políticas internas y regulaciones externas relevantes. \nIncluye: Leyes aplicables, políticas de la empresa, estándares de calidad.\nContexto actual: ${contenidoActual || 'Ninguno'}`\n    };\n\n    const promptBase = prompts[seccion] || `Completa esta sección de un documento de procedimientos empresariales.\nContexto actual: ${contenidoActual || 'Ninguno'}`;\n\n    try {\n      const content = await this.sendPrompt(promptBase, { \n        temperature: 0.5, \n        max_tokens: 800 \n      });\n      return content;\n    } catch (error) {\n      console.error('Error en generación de sugerencia:', error);\n      return null;\n    }\n  }\n\n  // Mejorar texto de procedimiento\n  async mejorarTextoProcedimiento(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n\n    try {\n      const prompt = `Eres un editor experto en procedimientos empresariales. Mejora el texto siguiendo estas reglas:\n1. Claridad: Cada oración describe un solo paso\n2. Estructura: Usa lenguaje directo (sujeto + verbo + objeto)\n3. Responsables: Identifica claramente quién hace cada acción\n4. Formato: Incluye decisiones (¿...?) y alternativas (Si/No)\n5. Concisión: Elimina redundancias pero mantén precisión\n6. Formalidad: Usa tono profesional apropiado para documentos empresariales\n\nMejora este texto de procedimiento para hacerlo más claro y estructurado:\n\n${texto}`;\n\n      const content = await this.sendPrompt(prompt, { \n        temperature: 0.4, \n        max_tokens: 2000 \n      });\n      return content || texto;\n    } catch (error) {\n      console.error('Error en mejora de texto:', error);\n      return texto;\n    }\n  }\n\n  // Sugerir mejoras en tiempo real\n  async sugerirMejorasRapidas(texto) {\n    if (!this.isAvailable || !texto.trim()) {\n      return [];\n    }\n\n    try {\n      const prompt = `Analiza el siguiente texto de un procedimiento empresarial y sugiere 2-3 mejoras rápidas y específicas.\nEnfócate en: claridad, estructura, formalidad y completitud.\n\nTexto a mejorar: \"${texto}\"\n\nResponde en formato JSON estricto:\n{\n  \"mejoras\": [\n    \"Sugerencia 1 específica\",\n    \"Sugerencia 2 específica\",\n    \"Sugerencia 3 específica\"\n  ]\n}`;\n\n      const content = await this.sendPrompt(prompt, { \n        temperature: 0.3, \n        max_tokens: 500,\n        systemPrompt: 'Eres un editor de documentos empresariales. Analiza textos y sugiere mejoras específicas. Devuelve solo JSON válido.'\n      });\n\n      // Extraer JSON de la respuesta\n      const jsonMatch = (content || '').match(/{[\\s\\S]*}/);\n      if (jsonMatch) {\n        const parsed = JSON.parse(jsonMatch[0]);\n        return parsed.mejoras || [];\n      }\n      \n      // Fallback: parsear como array simple\n      const lines = (content || '').split('\\n').filter(line => line.trim());\n      return lines.slice(0, 3);\n      \n    } catch (error) {\n      console.error('Error en sugerencias rápidas:', error);\n      return [];\n    }\n  }\n\n  // Generar contenido completo para una sección\n  async generarContenidoSeccion(seccion, contexto = '') {\n    if (!this.isAvailable) {\n      return '';\n    }\n\n    const prompts = {\n      'Objetivo o Propósito': `Genera un objetivo SMART completo para un procedimiento empresarial.\nDebe incluir:\n1. Propósito claro\n2. Resultados esperados\n3. Métricas de éxito\n4. Plazos\nContexto: ${contexto}`,\n      \n      'Alcance': `Genera una descripción completa del alcance para un procedimiento empresarial.\nDebe incluir:\n1. Áreas y departamentos incluidos\n2. Exclusiones específicas\n3. Límites geográficos y funcionales\n4. Condiciones de aplicación\nContexto: ${contexto}`,\n      \n      'Responsabilidades': `Genera una lista completa de responsabilidades para un procedimiento empresarial.\nFormato:\n- [Rol]: [Responsabilidad detallada]\nIncluye al menos 5 roles diferentes.\nContexto: ${contexto}`,\n      \n      'Normativa': `Genera una sección completa de normativa para un procedimiento empresarial.\nIncluye:\n1. Leyes aplicables\n2. Políticas internas\n3. Estándares de calidad\n4. Requisitos regulatorios\n5. Referencias documentales\nContexto: ${contexto}`\n    };\n\n    const prompt = prompts[seccion] || `Genera contenido profesional para la sección \"${seccion}\" de un documento de procedimientos empresariales.\nContexto: ${contexto}`;\n\n    try {\n      return await this.sendPrompt(prompt, { \n        temperature: 0.5, \n        max_tokens: 1000 \n      });\n    } catch (error) {\n      console.error(`Error generando contenido para ${seccion}:`, error);\n      return '';\n    }\n  }\n\n  // Traducir texto\n  async traducirTexto(texto, idiomaDestino = 'inglés') {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n\n    try {\n      const prompt = `Traduce el siguiente texto al ${idiomaDestino}. Mantén el tono formal y profesional del texto original.\n      \nTexto a traducir: \"${texto}\"`;\n\n      return await this.sendPrompt(prompt, { \n        temperature: 0.2, \n        max_tokens: 1500 \n      });\n    } catch (error) {\n      console.error('Error traduciendo texto:', error);\n      return texto;\n    }\n  }\n\n  // Resumir texto\n  async resumirTexto(texto, maxPalabras = 200) {\n    if (!this.isAvailable || !texto.trim()) {\n      return texto;\n    }\n\n    try {\n      const prompt = `Resume el siguiente texto en aproximadamente ${maxPalabras} palabras. Mantén los puntos clave y el tono profesional.\n      \nTexto a resumir: \"${texto}\"`;\n\n      return await this.sendPrompt(prompt, { \n        temperature: 0.3, \n        max_tokens: 500 \n      });\n    } catch (error) {\n      console.error('Error resumiendo texto:', error);\n      return texto;\n    }\n  }\n}\n\n// Instancia exportada\nexport const aiService = new AIService();\n\n// Función de utilidad para formatear texto HTML\nexport const formatHTMLFromText = (text) => {\n  if (!text) return '';\n  \n  // Reemplazar saltos de línea con <br> y párrafos\n  const lines = text.split('\\n').filter(line => line.trim());\n  const paragraphs = lines.map(line => `<p>${line.trim()}</p>`);\n  \n  // Detectar listas\n  const formatted = paragraphs.join('');\n  \n  return formatted;\n};\n\n// Función para extraer texto limpio de HTML\nexport const extractTextFromHTML = (html) => {\n  if (typeof document === 'undefined') {\n    // Fallback para SSR\n    return html.replace(/<[^>]*>/g, '').replace(/\\s+/g, ' ').trim();\n  }\n  \n  const div = document.createElement('div');\n  div.innerHTML = html;\n  return div.textContent || div.innerText || '';\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}