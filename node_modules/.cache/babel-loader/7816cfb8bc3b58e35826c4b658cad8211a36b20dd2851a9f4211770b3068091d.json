{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { generateWordDocument } from '@/utils/docGenerator';\nimport { aiService } from '@/services/aiService';\nimport { Editor, EditorContent } from '@tiptap/vue-3';\nimport StarterKit from '@tiptap/starter-kit';\nimport Underline from '@tiptap/extension-underline';\nimport Placeholder from '@tiptap/extension-placeholder';\n// BulletList removed (using StarterKit's implementation)\nimport TextAlign from '@tiptap/extension-text-align';\n\n// (Se removi√≥ la extensi√≥n personalizada para listas con letras para evitar duplicados con StarterKit)\n\nexport default {\n  name: 'DocumentView',\n  components: {\n    EditorContent\n  },\n  data() {\n    return {\n      showResetModal: false,\n      headerConfig: {\n        manualName: '',\n        policyName: '',\n        codigo: '',\n        area: '',\n        unidad: '',\n        revision: '',\n        fecha: this.getFormattedDate()\n      },\n      sections: [{\n        title: '1. Objetivo o Prop√≥sito',\n        description: 'Establecer el prop√≥sito general del procedimiento.',\n        placeholder: 'Definir el objetivo principal del procedimiento y los resultados esperados...',\n        content: '',\n        editor: null\n      }, {\n        title: '2. Alcance',\n        description: 'Definir los l√≠mites y cobertura del procedimiento.',\n        placeholder: 'Especificar los l√≠mites, √°reas de aplicaci√≥n y exclusiones del procedimiento...',\n        content: '',\n        editor: null\n      }, {\n        title: '3. Responsabilidades',\n        description: 'Listar los roles y responsabilidades de cada participante.',\n        placeholder: '1. Responsable Principal\\n2. Coordinador\\n3. Ejecutor...',\n        content: '',\n        editor: null\n      }, {\n        title: '4. Normativa',\n        description: 'Establecer las normas, pol√≠ticas y criterios aplicables.',\n        placeholder: 'I. [MARCO NORMATIVO]\\nEstablecer las normas y pol√≠ticas que rigen el procedimiento...',\n        content: '',\n        editor: null\n      }],\n      // Controles por p√°rrafo para integrar IA por seccion\n      paragraphControls: {},\n      // { [sectionIdx]: [{ html, text, tag, suggestion, isLoading, applied }] }\n      paragraphModeVisible: {},\n      // { [sectionIdx]: boolean }\n      remainingSections: [{\n        title: '6. Anexos',\n        description: 'Listar los formatos, documentos y anexos relacionados.',\n        placeholder: 'Formato de registro\\nDocumentos de referencia...',\n        content: '',\n        editor: null\n      }, {\n        title: '7. T√©rminos y Referencias',\n        description: 'Definir t√©rminos t√©cnicos y referencias documentales.',\n        placeholder: 'T√©rmino 1: Definici√≥n\\nT√©rmino 2: Explicaci√≥n...',\n        content: '',\n        editor: null\n      }],\n      generatedTable: [],\n      statusMessage: '',\n      statusType: '',\n      isGenerating: false,\n      isAnalyzing: false,\n      procedimientoEditor: null\n    };\n  },\n  computed: {\n    procedureTable() {\n      return this.generatedTable;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      this.initializeEditors();\n    });\n  },\n  beforeUnmount() {\n    this.destroyEditors();\n  },\n  methods: {\n    initializeEditors() {\n      // Configuraci√≥n base para todos los editores\n      const commonExtensionsBase = [\n      // Base principal ‚Äî StarterKit ya incluye heading, lists, blockquote, codeBlock, strike, hardBreak, etc.\n      StarterKit.configure({\n        hardBreak: {\n          keepMarks: true\n        },\n        bulletList: {\n          HTMLAttributes: {\n            class: 'bullet-list'\n          }\n        },\n        codeBlock: {\n          HTMLAttributes: {\n            class: 'code-block'\n          }\n        }\n      }),\n      // Extensiones adicionales no incluidas en StarterKit\n      Underline, TextAlign.configure({\n        types: ['heading', 'paragraph'],\n        alignments: ['left', 'center', 'right', 'justify'],\n        defaultAlignment: 'left'\n      })];\n\n      // Funci√≥n auxiliar para crear editores (acepta `placeholder` por secci√≥n)\n      const createEditor = placeholder => {\n        // A√±adir `Placeholder` din√°mico seg√∫n el par√°metro recibido\n        const extensions = [...commonExtensionsBase, Placeholder.configure({\n          placeholder: ({\n            node\n          }) => {\n            // Placeholder din√°mico basado en el contexto\n            if (node.type.name === 'heading') {\n              return 'T√≠tulo...';\n            }\n            if (node.type.name === 'codeBlock') {\n              return 'Escribe tu c√≥digo aqu√≠...';\n            }\n            if (node.type.name === 'blockquote') {\n              return 'Escribe una cita...';\n            }\n            return placeholder || 'Escribe tu contenido aqu√≠...';\n          }\n        })];\n        return new Editor({\n          content: '',\n          extensions: extensions,\n          onUpdate: () => {\n            // Manejar actualizaciones si es necesario\n          },\n          onCreate: () => {\n            console.log('Editor inicializado con opciones completas de Word');\n          },\n          editorProps: {\n            attributes: {\n              class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none',\n              style: 'min-height: 120px; white-space: pre-line;'\n            },\n            handleKeyDown: (view, event) => {\n              // Atajos de teclado comunes\n\n              // Ctrl+B - Negrita\n              if (event.ctrlKey && event.key === 'b') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.bold));\n                return true;\n              }\n\n              // Ctrl+I - Cursiva\n              if (event.ctrlKey && event.key === 'i') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.italic));\n                return true;\n              }\n\n              // Ctrl+U - Subrayado\n              if (event.ctrlKey && event.key === 'u') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.underline));\n                return true;\n              }\n\n              // Ctrl+Shift+S - Tachado\n              if (event.ctrlKey && event.shiftKey && event.key === 's') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.strike));\n                return true;\n              }\n\n              // Ctrl+Z - Deshacer\n              if (event.ctrlKey && event.key === 'z') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.undo());\n                return true;\n              }\n\n              // Ctrl+Y - Rehacer\n              if (event.ctrlKey && event.key === 'y') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.redo());\n                return true;\n              }\n\n              // Atajo Ctrl+Alt+1 para t√≠tulo 1\n              if (event.ctrlKey && event.altKey && event.key === '1') {\n                event.preventDefault();\n                const currentLevel = view.state.selection.$from.parent.type.name === 'heading' ? view.state.selection.$from.parent.attrs.level : null;\n                if (currentLevel === 1) {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.paragraph));\n                } else {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.heading, {\n                    level: 1\n                  }));\n                }\n                return true;\n              }\n\n              // Atajo Ctrl+Alt+2 para t√≠tulo 2\n              if (event.ctrlKey && event.altKey && event.key === '2') {\n                event.preventDefault();\n                const currentLevel = view.state.selection.$from.parent.type.name === 'heading' ? view.state.selection.$from.parent.attrs.level : null;\n                if (currentLevel === 2) {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.paragraph));\n                } else {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.heading, {\n                    level: 2\n                  }));\n                }\n                return true;\n              }\n\n              // Atajo Ctrl+Alt+3 para t√≠tulo 3\n              if (event.ctrlKey && event.altKey && event.key === '3') {\n                event.preventDefault();\n                const currentLevel = view.state.selection.$from.parent.type.name === 'heading' ? view.state.selection.$from.parent.attrs.level : null;\n                if (currentLevel === 3) {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.paragraph));\n                } else {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.heading, {\n                    level: 3\n                  }));\n                }\n                return true;\n              }\n\n              // Ctrl+Enter para salto de l√≠nea suave\n              if (event.ctrlKey && event.key === 'Enter') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.replaceSelectionWith(view.state.schema.nodes.hardBreak.create()).scrollIntoView());\n                return true;\n              }\n              return false;\n            }\n          }\n        });\n      };\n\n      // Inicializar secciones principales\n      this.sections.forEach((section, index) => {\n        const editor = createEditor(section.placeholder);\n        editor.on('update', () => {\n          this.sections[index].content = editor.getHTML();\n        });\n        section.editor = editor;\n      });\n\n      // Inicializar secciones restantes\n      this.remainingSections.forEach((section, index) => {\n        const editor = createEditor(section.placeholder);\n        editor.on('update', () => {\n          this.remainingSections[index].content = editor.getHTML();\n        });\n        section.editor = editor;\n      });\n\n      // Inicializar editor de procedimiento\n      this.procedimientoEditor = createEditor('Describe el procedimiento completo aqu√≠ en lenguaje natural...');\n      this.procedimientoEditor.on('update', () => {\n        // Actualizar contenido del procedimiento si es necesario\n      });\n    },\n    // M√©todo para aplicar estilos desde el select\n    applyStyle(editor, style) {\n      if (!editor) return;\n      switch (style) {\n        case 'paragraph':\n          editor.chain().focus().setParagraph().run();\n          break;\n        case 'h1':\n          editor.chain().focus().toggleHeading({\n            level: 1\n          }).run();\n          break;\n        case 'h2':\n          editor.chain().focus().toggleHeading({\n            level: 2\n          }).run();\n          break;\n        case 'h3':\n          editor.chain().focus().toggleHeading({\n            level: 3\n          }).run();\n          break;\n        case 'blockquote':\n          editor.chain().focus().toggleBlockquote().run();\n          break;\n        case 'code':\n          editor.chain().focus().toggleCodeBlock().run();\n          break;\n      }\n    },\n    // M√©todo para obtener el estilo actual del cursor\n    getCurrentStyle(editor) {\n      if (!editor) return 'paragraph';\n      if (editor.isActive('heading', {\n        level: 1\n      })) return 'h1';\n      if (editor.isActive('heading', {\n        level: 2\n      })) return 'h2';\n      if (editor.isActive('heading', {\n        level: 3\n      })) return 'h3';\n      if (editor.isActive('blockquote')) return 'blockquote';\n      if (editor.isActive('codeBlock')) return 'code';\n      return 'paragraph';\n    },\n    // M√©todo para alternar lista con letras\n    toggleLetterList(editor) {\n      if (!editor) return;\n\n      // Si ya est√° activa la lista de letras -> quitar atributo 'data-type' (vuelve a vi√±eta normal)\n      if (editor.isActive('bulletList', {\n        'data-type': 'letter'\n      })) {\n        editor.chain().focus().updateAttributes('bulletList', {\n          'data-type': null\n        }).run();\n        return;\n      }\n\n      // Si hay una lista normal activa -> convertirla a lista de letras\n      if (editor.isActive('bulletList')) {\n        editor.chain().focus().updateAttributes('bulletList', {\n          'data-type': 'letter'\n        }).run();\n        return;\n      }\n\n      // Si no hay lista activa -> crear lista y luego marcar como 'letter' en una sola cadena\n      editor.chain().focus().toggleBulletList().updateAttributes('bulletList', {\n        'data-type': 'letter'\n      }).run();\n    },\n    // M√©todo central para togglear vi√±etas normales y limpiar el atributo 'letter' si existe\n    toggleBulletList(editor) {\n      if (!editor) return;\n\n      // Si estamos en una lista de letras y se quiere vi√±eta normal -> quitar atributo 'letter'\n      if (editor.isActive('bulletList', {\n        'data-type': 'letter'\n      })) {\n        editor.chain().focus().updateAttributes('bulletList', {\n          'data-type': null\n        }).run();\n        return;\n      }\n\n      // En el resto de casos, hacer toggle normal (activar/desactivar)\n      editor.chain().focus().toggleBulletList().run();\n    },\n    destroyEditors() {\n      // Destruir todos los editores para evitar memory leaks\n      this.sections.forEach(section => {\n        if (section.editor) {\n          section.editor.destroy();\n        }\n      });\n      this.remainingSections.forEach(section => {\n        if (section.editor) {\n          section.editor.destroy();\n        }\n      });\n      if (this.procedimientoEditor) {\n        this.procedimientoEditor.destroy();\n      }\n    },\n    clearSection(section) {\n      if (section.editor) {\n        section.editor.commands.clearContent();\n        this.showStatus('Secci√≥n limpiada', 'info');\n      }\n    },\n    clearProcedimiento() {\n      if (this.procedimientoEditor) {\n        this.procedimientoEditor.commands.clearContent();\n        this.generatedTable = [];\n        this.showStatus('Procedimiento limpiado', 'info');\n      }\n    },\n    getFormattedDate() {\n      const today = new Date();\n      const year = today.getFullYear();\n      const month = String(today.getMonth() + 1).padStart(2, '0');\n      const day = String(today.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    },\n    loadExampleProcedimiento() {\n      if (!this.procedimientoEditor) return;\n      const exampleText = `El administrador revisa la lista de proveedores a pagar\nEl administrador env√≠a la lista al gerente general para revisi√≥n\nEl gerente general revisa la lista de proveedores\n¬øLa lista est√° correcta?\nSi est√° correcta, el gerente general realiza el pago a los proveedores\na) Verifica disponibilidad de fondos\nb) Prepara √≥rdenes de pago\nc) Registra en el sistema contable\nSi no est√° correcta, el gerente general devuelve la lista al administrador\nEl administrador verifica y corrige la informaci√≥n de los proveedores\n5.1.1 Consulta base de datos de proveedores\n5.1.2 Actualiza informaci√≥n faltante\n5.1.3 Valida documentos de respaldo\nEl administrador actualiza la lista con la informaci√≥n corregida\nEl proceso se repite desde el env√≠o al gerente general\nFin del proceso`;\n\n      // Convertir el texto plano a formato que Tiptap entienda con saltos de l√≠nea\n      const formattedContent = exampleText.split('\\n').map(line => {\n        if (line.trim() === '') return '<p></p>';\n\n        // Detectar si es una lista con letras (a), b), c), etc.)\n        if (/^[a-z]\\)/.test(line.trim())) {\n          return `<ul data-type=\"letter\"><li>${line.replace(/^[a-z]\\)\\s*/, '')}</li></ul>`;\n        }\n\n        // Detectar si es una lista numerada (5.1.1, 5.1.2, etc.)\n        if (/^\\d+\\.\\d+\\.\\d+/.test(line.trim())) {\n          return `<ul><li>${line}</li></ul>`;\n        }\n        return `<p>${line}</p>`;\n      }).join('');\n      this.procedimientoEditor.commands.setContent(formattedContent);\n      this.showStatus('üìù Ejemplo con subsecciones cargado. Haz clic en \"Generar Tabla Autom√°ticamente\" para ver el resultado.', 'info');\n    },\n    parseProcedimiento() {\n      if (!this.procedimientoEditor) return;\n      const textContent = this.procedimientoEditor.getText();\n      if (!textContent.trim()) {\n        this.showStatus('‚ùå Por favor ingresa la descripci√≥n del procedimiento', 'error');\n        return;\n      }\n      try {\n        const lines = textContent.split('\\n').filter(line => line.trim() !== '');\n        const table = [];\n        let stepNumber = 1;\n        let subStepNumber = 0;\n        let currentMainStep = null;\n        for (let i = 0; i < lines.length; i++) {\n          const line = lines[i].trim();\n          if (line === '') continue;\n          if (this.isSubsectionStarter(line)) {\n            if (currentMainStep) {\n              subStepNumber++;\n              const fullNumber = `${currentMainStep}.${subStepNumber}`;\n              const responsible = this.extractResponsible(line);\n              const activity = this.extractActivity(line, responsible);\n              table.push({\n                number: fullNumber,\n                who: responsible,\n                activity: activity,\n                level: 'sub'\n              });\n            } else {\n              const responsible = this.extractResponsible(line);\n              const activity = this.extractActivity(line, responsible);\n              table.push({\n                number: `${stepNumber}`,\n                who: responsible,\n                activity: activity\n              });\n              stepNumber++;\n              subStepNumber = 0;\n            }\n          } else if (this.isMainProcessLine(line)) {\n            table.push({\n              number: '',\n              who: '',\n              activity: line,\n              level: 'section'\n            });\n            currentMainStep = null;\n            subStepNumber = 0;\n          } else if (line.startsWith('¬ø')) {\n            table.push({\n              number: '',\n              who: '',\n              activity: line,\n              level: 'question'\n            });\n            currentMainStep = null;\n            subStepNumber = 0;\n          } else if (line.toLowerCase().startsWith('si ') || line.toLowerCase().startsWith('no ') || line.toLowerCase().startsWith('si,') || line.toLowerCase().startsWith('no,')) {\n            table.push({\n              number: '',\n              who: '',\n              activity: line,\n              level: 'alternative'\n            });\n            currentMainStep = null;\n            subStepNumber = 0;\n          } else if (line.toLowerCase().includes('fin del proceso')) {\n            table.push({\n              number: '',\n              who: '',\n              activity: 'Fin del Proceso',\n              level: 'end'\n            });\n            currentMainStep = null;\n            subStepNumber = 0;\n          } else {\n            const responsible = this.extractResponsible(line);\n            const activity = this.extractActivity(line, responsible);\n            if (responsible || activity) {\n              table.push({\n                number: `${stepNumber}`,\n                who: responsible,\n                activity: activity\n              });\n              currentMainStep = stepNumber;\n              stepNumber++;\n              subStepNumber = 0;\n            }\n          }\n        }\n        this.generatedTable = table;\n        this.showStatus('‚úÖ Tabla generada autom√°ticamente desde la descripci√≥n', 'success');\n      } catch (error) {\n        this.showStatus('‚ùå Error al procesar la descripci√≥n: ' + error.message, 'error');\n      }\n    },\n    // Analiza el texto del procedimiento usando el servicio de IA\n    async analyzeWithAI() {\n      if (!this.procedimientoEditor) return;\n      const textContent = this.procedimientoEditor.getText();\n      if (!textContent.trim()) {\n        this.showStatus('‚ùå Por favor ingresa la descripci√≥n del procedimiento', 'error');\n        return;\n      }\n      this.isAnalyzing = true;\n      try {\n        const result = await aiService.analyzeProcedimiento(textContent);\n        const pasos = result.pasos || [];\n        const table = [];\n        let counter = 1;\n        for (const paso of pasos) {\n          const tipo = (paso.tipo || 'normal').toLowerCase();\n          const who = paso.responsable ? this.capitalizeFirstLetter(paso.responsable) : '';\n          const activity = paso.actividad || '';\n          if (tipo === 'normal') {\n            table.push({\n              number: `${counter}`,\n              who,\n              activity,\n              level: 'normal'\n            });\n            counter++;\n          } else if (tipo === 'decision') {\n            table.push({\n              number: '',\n              who,\n              activity: activity,\n              level: 'question'\n            });\n          } else if (tipo === 'alternative') {\n            table.push({\n              number: '',\n              who,\n              activity: activity,\n              level: 'alternative'\n            });\n          } else if (tipo === 'fin') {\n            table.push({\n              number: '',\n              who,\n              activity: activity || 'Fin del Proceso',\n              level: 'end'\n            });\n          } else {\n            table.push({\n              number: `${counter}`,\n              who,\n              activity,\n              level: 'normal'\n            });\n            counter++;\n          }\n          if (Array.isArray(paso.subpasos) && paso.subpasos.length) {\n            for (const sub of paso.subpasos) {\n              table.push({\n                number: '',\n                who: sub.responsable ? this.capitalizeFirstLetter(sub.responsable) : who,\n                activity: sub.actividad || '',\n                level: 'sub'\n              });\n            }\n          }\n        }\n        this.generatedTable = table;\n        this.showStatus('‚úÖ Tabla generada desde el an√°lisis de IA', 'success');\n      } catch (error) {\n        console.error('Error analizando con IA:', error);\n        this.showStatus('‚ùå Error al analizar con IA: ' + (error.message || error), 'error');\n      } finally {\n        this.isAnalyzing = false;\n      }\n    },\n    // Mejora el texto del procedimiento usando el servicio de IA\n    async improveWithAI() {\n      if (!this.procedimientoEditor) return;\n      const textContent = this.procedimientoEditor.getText();\n      if (!textContent.trim()) {\n        this.showStatus('‚ùå Por favor ingresa la descripci√≥n del procedimiento', 'error');\n        return;\n      }\n      this.isAnalyzing = true;\n      try {\n        const improved = await aiService.mejorarTextoProcedimiento(textContent);\n        if (improved && typeof improved === 'string') {\n          const formatted = improved.split('\\n').map(line => `<p>${line}</p>`).join('');\n          this.procedimientoEditor.commands.setContent(formatted);\n          this.showStatus('‚úÖ Texto mejorado por IA aplicado al editor', 'success');\n        } else {\n          this.showStatus('‚ö†Ô∏è La IA no devolvi√≥ una mejora v√°lida', 'info');\n        }\n      } catch (error) {\n        console.error('Error mejorando con IA:', error);\n        this.showStatus('‚ùå Error al mejorar con IA: ' + (error.message || error), 'error');\n      } finally {\n        this.isAnalyzing = false;\n      }\n    },\n    /* ----------------- Controles por p√°rrafo (IA) ----------------- */\n    getParagraphsFromEditor(editor) {\n      const html = editor?.getHTML ? editor.getHTML() : '';\n      const wrapper = typeof document !== 'undefined' ? document.createElement('div') : null;\n      if (!wrapper) return [];\n      wrapper.innerHTML = html || '';\n      const nodes = Array.from(wrapper.childNodes).filter(n => {\n        return n.nodeType === Node.ELEMENT_NODE && n.textContent && n.textContent.trim() || n.nodeType === Node.TEXT_NODE && n.textContent && n.textContent.trim();\n      });\n      return nodes.map(node => ({\n        html: node.nodeType === Node.ELEMENT_NODE ? node.outerHTML : `<p>${(node.textContent || '').trim()}</p>`,\n        text: node.textContent ? node.textContent.trim() : '',\n        tag: node.nodeType === Node.ELEMENT_NODE ? (node.tagName || 'div').toLowerCase() : 'p'\n      }));\n    },\n    initParagraphControls(sectionIdx, editor) {\n      if (!editor) return;\n      const paras = this.getParagraphsFromEditor(editor);\n      const list = paras.map(p => ({\n        ...p,\n        suggestion: null,\n        isLoading: false,\n        applied: false\n      }));\n      // Vue 3: asignaci√≥n directa para mantener reactividad\n      this.paragraphControls[sectionIdx] = list;\n      if (this.paragraphModeVisible[sectionIdx] === undefined) {\n        this.paragraphModeVisible[sectionIdx] = true;\n      }\n    },\n    async suggestForParagraph(sectionIdx, paraIdx) {\n      const list = this.paragraphControls[sectionIdx];\n      if (!list || !list[paraIdx]) return;\n      list[paraIdx].isLoading = true;\n      try {\n        const text = list[paraIdx].text || '';\n        const suggestions = await aiService.sugerirMejorasRapidas(text);\n        const joined = Array.isArray(suggestions) ? suggestions.join('\\n') : suggestions || '';\n        list[paraIdx].suggestion = joined.replace(/\\n/g, '<br/>');\n      } catch (e) {\n        list[paraIdx].suggestion = 'Error: ' + (e.message || e);\n      } finally {\n        list[paraIdx].isLoading = false;\n      }\n    },\n    async improveParagraph(sectionIdx, paraIdx) {\n      const list = this.paragraphControls[sectionIdx];\n      if (!list || !list[paraIdx]) return;\n      list[paraIdx].isLoading = true;\n      try {\n        const original = list[paraIdx].text || '';\n        const improved = await aiService.mejorarTextoProcedimiento(original);\n        const content = improved && typeof improved === 'string' ? improved : original;\n        // Convertir a HTML simple\n        const html = content.split('\\n').map(line => `<p>${line}</p>`).join('');\n        list[paraIdx].suggestion = html;\n      } catch (e) {\n        list[paraIdx].suggestion = 'Error: ' + (e.message || e);\n      } finally {\n        list[paraIdx].isLoading = false;\n      }\n    },\n    applyParagraphChange(sectionIdx, paraIdx, editor) {\n      const list = this.paragraphControls[sectionIdx];\n      if (!list || !list[paraIdx] || !editor) return;\n      const replacement = list[paraIdx].suggestion || list[paraIdx].text;\n      const newHtml = this._applyParagraphHtml(editor.getHTML(), paraIdx, replacement);\n      try {\n        editor.commands.setContent(newHtml);\n        list[paraIdx].applied = true;\n      } catch (e) {\n        console.error('Error aplicando cambio de p√°rrafo:', e);\n      }\n    },\n    _applyParagraphHtml(originalHtml, paraIdx, replacementText) {\n      const wrapper = typeof document !== 'undefined' ? document.createElement('div') : null;\n      if (!wrapper) return originalHtml;\n      wrapper.innerHTML = originalHtml || '';\n      const nodes = Array.from(wrapper.childNodes).filter(n => n.nodeType === Node.ELEMENT_NODE || n.nodeType === Node.TEXT_NODE && n.textContent && n.textContent.trim());\n      const target = nodes[paraIdx];\n      if (!target) return originalHtml;\n      const replacementFragment = typeof document !== 'undefined' ? document.createElement('div') : null;\n      replacementFragment.innerHTML = replacementText || '';\n      // Replace target with replacement nodes\n      const newNodes = Array.from(replacementFragment.childNodes);\n      if (newNodes.length === 0) {\n        // fallback: replace text content\n        target.textContent = replacementText;\n      } else {\n        target.replaceWith(...newNodes);\n      }\n      return wrapper.innerHTML;\n    },\n    isSubsectionStarter(line) {\n      const subsectionPatterns = [/^\\d+\\.\\d+\\.\\d+/, /^[a-z]\\)/, /^[ivx]+\\)/, /^‚Ä¢\\s/, /^-\\s/, /^‚Üí\\s/, /^subpaso\\s\\d+/i, /^detalle\\s\\d+/i];\n      return subsectionPatterns.some(pattern => pattern.test(line.toLowerCase()));\n    },\n    isMainProcessLine(line) {\n      return !line.startsWith('¬ø') && !line.toLowerCase().startsWith('si ') && !line.toLowerCase().startsWith('no ') && !line.toLowerCase().startsWith('si,') && !line.toLowerCase().startsWith('no,') && !line.toLowerCase().includes('fin del proceso') && !this.extractResponsible(line) && !this.isSubsectionStarter(line) && line.length > 10;\n    },\n    extractResponsible(line) {\n      const patterns = [/^el (\\w+)/i, /^la (\\w+)/i, /^los (\\w+)/i, /^las (\\w+)/i, /^un (\\w+)/i, /^una (\\w+)/i, /^(\\w+) (revisa|env√≠a|realiza|verifica|corrige|aprueba|autoriza)/i];\n      for (const pattern of patterns) {\n        const match = line.match(pattern);\n        if (match) {\n          return this.capitalizeFirstLetter(match[1] || match[2]);\n        }\n      }\n      return '';\n    },\n    extractActivity(line, responsible) {\n      if (!responsible) return line;\n\n      // Asegurar que 'responsible' se use correctamente y escapar caracteres para la regex\n      const respRaw = String(responsible).trim();\n      const respEscaped = respRaw.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n      // Quitar prefijos t√≠picos que repiten el responsable (ej. \"El administrador ...\")\n      const removePattern = new RegExp(`^(el\\\\s+${respEscaped}|la\\\\s+${respEscaped}|los\\\\s+${respEscaped}|las\\\\s+${respEscaped}|${respEscaped})\\\\s+`, 'i');\n      let activity = line.replace(removePattern, '').trim();\n\n      // Capitalizar primera letra\n      if (!activity) return '';\n      return activity.charAt(0).toUpperCase() + activity.slice(1);\n    },\n    capitalizeFirstLetter(string) {\n      return string.charAt(0).toUpperCase() + string.slice(1);\n    },\n    getRowClass(row) {\n      if (row.level === 'section') {\n        return 'section-row';\n      }\n      if (row.level === 'sub') {\n        return 'subsection-row';\n      }\n      if (row.level === 'question') {\n        return 'question-row';\n      }\n      if (row.level === 'alternative') {\n        return 'alternative-row';\n      }\n      if (row.level === 'end') {\n        return 'end-row';\n      }\n      if (!row.number && !row.who && !row.activity) {\n        return 'empty-row';\n      }\n      return 'normal-row';\n    },\n    async generateWordDocument() {\n      this.isGenerating = true;\n      const procedimientoText = this.procedimientoEditor ? this.procedimientoEditor.getText() : '';\n\n      // Si hay texto en el procedimiento pero no se ha generado la tabla, generarla\n      if (procedimientoText && this.generatedTable.length === 0) {\n        this.parseProcedimiento();\n      }\n      const documentData = {\n        headerConfig: this.headerConfig,\n        objetivo: this.sections[0].editor.getHTML(),\n        alcance: this.sections[1].editor.getHTML(),\n        responsabilidades: this.sections[2].editor.getHTML(),\n        normativa: this.sections[3].editor.getHTML(),\n        anexos: this.remainingSections[0].editor.getHTML(),\n        terminos: this.remainingSections[1].editor.getHTML()\n      };\n      try {\n        await generateWordDocument(documentData, this.generatedTable);\n        this.showStatus('‚úÖ Documento Word generado exitosamente!', 'success');\n      } catch (error) {\n        console.error('Error generating document:', error);\n        this.showStatus('‚ùå Error al generar el documento: ' + error.message, 'error');\n      } finally {\n        this.isGenerating = false;\n      }\n    },\n    resetDocument() {\n      // Mostrar modal personalizado en lugar de confirm() nativo\n      this.showResetModal = true;\n    },\n    closeResetModal() {\n      this.showResetModal = false;\n    },\n    confirmReset() {\n      this.showResetModal = false;\n      this.executeReset();\n      this.showStatus('üóëÔ∏è Todo el contenido ha sido resetado', 'info');\n    },\n    executeReset() {\n      // Limpiar secciones de contenido\n      this.sections.forEach(section => {\n        if (section.editor) {\n          section.editor.commands.clearContent();\n        }\n      });\n      this.remainingSections.forEach(section => {\n        if (section.editor) {\n          section.editor.commands.clearContent();\n        }\n      });\n      if (this.procedimientoEditor) {\n        this.procedimientoEditor.commands.clearContent();\n      }\n      this.generatedTable = [];\n\n      // Limpiar configuraci√≥n del encabezado\n      this.headerConfig = {\n        manualName: '',\n        policyName: '',\n        codigo: '',\n        area: '',\n        unidad: '',\n        revision: '',\n        fecha: this.getFormattedDate()\n      };\n    },\n    showStatus(message, type) {\n      this.statusMessage = message;\n      this.statusType = type;\n      setTimeout(() => {\n        this.statusMessage = '';\n        this.statusType = '';\n      }, 5000);\n    }\n  }\n};","map":{"version":3,"names":["generateWordDocument","aiService","Editor","EditorContent","StarterKit","Underline","Placeholder","TextAlign","name","components","data","showResetModal","headerConfig","manualName","policyName","codigo","area","unidad","revision","fecha","getFormattedDate","sections","title","description","placeholder","content","editor","paragraphControls","paragraphModeVisible","remainingSections","generatedTable","statusMessage","statusType","isGenerating","isAnalyzing","procedimientoEditor","computed","procedureTable","mounted","$nextTick","initializeEditors","beforeUnmount","destroyEditors","methods","commonExtensionsBase","configure","hardBreak","keepMarks","bulletList","HTMLAttributes","class","codeBlock","types","alignments","defaultAlignment","createEditor","extensions","node","type","onUpdate","onCreate","console","log","editorProps","attributes","style","handleKeyDown","view","event","ctrlKey","key","preventDefault","dispatch","state","tr","setMark","selection","from","to","schema","marks","bold","italic","underline","shiftKey","strike","undo","redo","altKey","currentLevel","$from","parent","attrs","level","setBlockType","nodes","paragraph","heading","replaceSelectionWith","create","scrollIntoView","forEach","section","index","on","getHTML","applyStyle","chain","focus","setParagraph","run","toggleHeading","toggleBlockquote","toggleCodeBlock","getCurrentStyle","isActive","toggleLetterList","updateAttributes","toggleBulletList","destroy","clearSection","commands","clearContent","showStatus","clearProcedimiento","today","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","loadExampleProcedimiento","exampleText","formattedContent","split","map","line","trim","test","replace","join","setContent","parseProcedimiento","textContent","getText","lines","filter","table","stepNumber","subStepNumber","currentMainStep","i","length","isSubsectionStarter","fullNumber","responsible","extractResponsible","activity","extractActivity","push","number","who","isMainProcessLine","startsWith","toLowerCase","includes","error","message","analyzeWithAI","result","analyzeProcedimiento","pasos","counter","paso","tipo","responsable","capitalizeFirstLetter","actividad","Array","isArray","subpasos","sub","improveWithAI","improved","mejorarTextoProcedimiento","formatted","getParagraphsFromEditor","html","wrapper","document","createElement","innerHTML","childNodes","n","nodeType","Node","ELEMENT_NODE","TEXT_NODE","outerHTML","text","tag","tagName","initParagraphControls","sectionIdx","paras","list","p","suggestion","isLoading","applied","undefined","suggestForParagraph","paraIdx","suggestions","sugerirMejorasRapidas","joined","e","improveParagraph","original","applyParagraphChange","replacement","newHtml","_applyParagraphHtml","originalHtml","replacementText","target","replacementFragment","newNodes","replaceWith","subsectionPatterns","some","pattern","patterns","match","respRaw","respEscaped","removePattern","RegExp","charAt","toUpperCase","slice","string","getRowClass","row","procedimientoText","documentData","objetivo","alcance","responsabilidades","normativa","anexos","terminos","resetDocument","closeResetModal","confirmReset","executeReset","setTimeout"],"sources":["/home/jorge/Escritorio/Jorge-PC/procesos/procesos/src/views/DocumentView.vue"],"sourcesContent":["<template>\n  <div class=\"document-view\">\n    <!-- Modal de confirmaci√≥n mejorado -->\n    <div v-if=\"showResetModal\" class=\"modal-overlay\" @click.self=\"closeResetModal\">\n      <div class=\"modal-container\">\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">Confirmar Limpieza</h3>\n          <button class=\"modal-close-btn\" @click=\"closeResetModal\">\n            <span>√ó</span>\n          </button>\n        </div>\n        \n        <div class=\"modal-content\">\n          <p class=\"modal-message\">¬øEst√°s seguro de que quieres limpiar todo el documento?</p>\n          <p class=\"modal-warning\">Se perder√°n todos los cambios no guardados.</p>\n        </div>\n        \n        <div class=\"modal-actions\">\n          <button class=\"modal-btn modal-btn-cancel\" @click=\"closeResetModal\">\n            Cancelar\n          </button>\n          <button class=\"modal-btn modal-btn-confirm\" @click=\"confirmReset\">\n            Limpiar Todo\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"status-message\" v-if=\"statusMessage\" :class=\"statusType\">\n      {{ statusMessage }}\n    </div>\n\n    <div class=\"document-editor\">\n      <!-- Configuraci√≥n del Encabezado -->\n      <div class=\"section header-config\">\n        <h3> Configuraci√≥n del Encabezado del Documento</h3>\n        <div class=\"header-fields\">\n          <div class=\"field-group\">\n            <label>Manual de Pol√≠ticas y Procedimientos:</label>\n            <input v-model=\"headerConfig.manualName\" placeholder=\"Ingrese el nombre del manual\" class=\"header-input\">\n          </div>\n          <div class=\"field-group\">\n            <label>POL√çTICA O PROCEDIMIENTO DE:</label>\n            <input v-model=\"headerConfig.policyName\" placeholder=\"Ingrese el nombre del procedimiento\" class=\"header-input\">\n          </div>\n          <div class=\"field-group\">\n            <label>C√ìDIGO:</label>\n            <input v-model=\"headerConfig.codigo\" placeholder=\"Ej: XX-P-XXX-#\" class=\"header-input\">\n          </div>\n          <div class=\"field-group\">\n            <label>√Årea:</label>\n            <input v-model=\"headerConfig.area\" placeholder=\"Ej: Administraci√≥n\" class=\"header-input\">\n          </div>\n          <div class=\"field-group\">\n            <label>Unidad:</label>\n            <input v-model=\"headerConfig.unidad\" placeholder=\"Ej: Finanzas\" class=\"header-input\">\n          </div>\n          <div class=\"field-group\">\n            <label>Revisi√≥n:</label>\n            <input v-model=\"headerConfig.revision\" placeholder=\"Ej: 01\" class=\"header-input\">\n          </div>\n          <div class=\"field-group\">\n            <label>Fecha:</label>\n            <input v-model=\"headerConfig.fecha\" type=\"date\" class=\"header-input\">\n          </div>\n        </div>\n      </div>\n\n      <!-- Secciones editables del contenido -->\n      <div class=\"section\" v-for=\"(section, index) in sections\" :key=\"index\">\n        <h3>{{ section.title }}</h3>\n        <div class=\"section-description\">\n          <p>{{ section.description }}</p>\n        </div>\n        \n        <div class=\"rich-text-editor\">\n          <div class=\"toolbar\">\n            <!-- Grupo de formato de texto -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('bold') }\"\n                @click=\"section.editor?.chain().focus().toggleBold().run()\"\n                title=\"Negrita (Ctrl+B)\"\n              >\n                <strong>B</strong>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('italic') }\"\n                @click=\"section.editor?.chain().focus().toggleItalic().run()\"\n                title=\"Cursiva (Ctrl+I)\"\n              >\n                <em>I</em>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('underline') }\"\n                @click=\"section.editor?.chain().focus().toggleUnderline().run()\"\n                title=\"Subrayado (Ctrl+U)\"\n              >\n                <u>U</u>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('strike') }\"\n                @click=\"section.editor?.chain().focus().toggleStrike().run()\"\n                title=\"Tachado (Ctrl+Shift+S)\"\n              >\n                <s>S</s>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de estilos de p√°rrafo -->\n            <div class=\"toolbar-group\">\n              <select \n                class=\"style-select\"\n                @change=\"applyStyle(section.editor, $event.target.value)\"\n                :value=\"getCurrentStyle(section.editor)\"\n                title=\"Estilo de p√°rrafo\"\n              >\n                <option value=\"paragraph\">P√°rrafo normal</option>\n                <option value=\"h1\">T√≠tulo 1</option>\n                <option value=\"h2\">T√≠tulo 2</option>\n                <option value=\"h3\">T√≠tulo 3</option>\n                <option value=\"blockquote\">Cita</option>\n                <option value=\"code\">C√≥digo</option>\n              </select>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('paragraph') && !section.editor?.isActive('heading') && !section.editor?.isActive('blockquote') && !section.editor?.isActive('codeBlock') }\"\n                @click=\"section.editor?.chain().focus().setParagraph().run()\"\n                title=\"P√°rrafo normal\"\n              >\n                <span class=\"icon-text\">¬∂</span>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de alineaci√≥n -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'left' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('left').run()\"\n                title=\"Alinear a la izquierda\"\n              >\n                <font-awesome-icon icon=\"align-left\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'center' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('center').run()\"\n                title=\"Centrar\"\n              >\n                <font-awesome-icon icon=\"align-center\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'right' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('right').run()\"\n                title=\"Alinear a la derecha\"\n              >\n                <font-awesome-icon icon=\"align-right\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'justify' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('justify').run()\"\n                title=\"Justificar\"\n              >\n                <font-awesome-icon icon=\"align-justify\" />\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de listas -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('bulletList') && !section.editor?.isActive('bulletList', { 'data-type': 'letter' }) }\"\n                @click=\"toggleBulletList(section.editor)\"\n                title=\"Lista con vi√±etas\"\n              >\n                <span>‚Ä¢</span>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('orderedList') }\"\n                @click=\"section.editor?.chain().focus().toggleOrderedList().run()\"\n                title=\"Lista numerada\"\n              >\n                <span>1.</span>\n              </button>\n\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('bulletList', { 'data-type': 'letter' }) }\"\n                @click=\"toggleLetterList(section.editor)\"\n                title=\"Lista con letras\"\n              >\n                <span>a)</span>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de herramientas -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                @click=\"section.editor?.chain().focus().undo().run()\"\n                title=\"Deshacer (Ctrl+Z)\"\n              >\n                ‚Ü∂\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                @click=\"section.editor?.chain().focus().redo().run()\"\n                title=\"Rehacer (Ctrl+Y)\"\n              >\n                ‚Ü∑\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                @click=\"clearSection(section)\"\n                title=\"Limpiar secci√≥n\"\n              >\n                √ó\n              </button>\n            </div>\n          </div>\n          \n          <editor-content \n            :editor=\"section.editor\" \n            class=\"editor-content\"\n          />\n\n        <!-- Controles IA por p√°rrafo para secciones restantes -->\n        <div class=\"paragraph-controls\">\n          <button class=\"ia-toggle-btn\" @click=\"initParagraphControls('remaining-' + index, section.editor); paragraphModeVisible['remaining-' + index] = !paragraphModeVisible['remaining-' + index]\">\n            {{ paragraphModeVisible['remaining-' + index] ? 'Cerrar IA por p√°rrafo' : 'IA por p√°rrafo' }}\n          </button>\n\n          <div v-if=\"paragraphModeVisible['remaining-' + index]\" class=\"paragraph-panel\">\n            <div v-for=\"(p, pi) in paragraphControls['remaining-' + index]\" :key=\"pi\" class=\"paragraph-control\">\n              <div class=\"para-text\" v-html=\"p.html\"></div>\n              <div class=\"para-actions\">\n                <button @click=\"suggestForParagraph('remaining-' + index, pi)\" :disabled=\"p.isLoading\">Sugerir</button>\n                <button @click=\"improveParagraph('remaining-' + index, pi)\" :disabled=\"p.isLoading\">Mejorar</button>\n                <button @click=\"applyParagraphChange('remaining-' + index, pi, section.editor)\" :disabled=\"!p.suggestion || p.applied\">Aplicar</button>\n                <span v-if=\"p.isLoading\">‚è≥</span>\n                <div v-if=\"p.suggestion\" class=\"suggestion-preview\"><strong>Sugerencia:</strong><div v-html=\"p.suggestion\"></div></div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Controles IA por p√°rrafo para esta secci√≥n -->\n        <div class=\"paragraph-controls\">\n          <button class=\"ia-toggle-btn\" @click=\"initParagraphControls('section-' + index, section.editor); paragraphModeVisible['section-' + index] = !paragraphModeVisible['section-' + index]\">\n            {{ paragraphModeVisible['section-' + index] ? 'Cerrar IA por p√°rrafo' : 'IA por p√°rrafo' }}\n          </button>\n\n          <div v-if=\"paragraphModeVisible['section-' + index]\" class=\"paragraph-panel\">\n            <div v-for=\"(p, pi) in paragraphControls['section-' + index]\" :key=\"pi\" class=\"paragraph-control\">\n              <div class=\"para-text\" v-html=\"p.html\"></div>\n              <div class=\"para-actions\">\n                <button @click=\"suggestForParagraph('section-' + index, pi)\" :disabled=\"p.isLoading\">Sugerir</button>\n                <button @click=\"improveParagraph('section-' + index, pi)\" :disabled=\"p.isLoading\">Mejorar</button>\n                <button @click=\"applyParagraphChange('section-' + index, pi, section.editor)\" :disabled=\"!p.suggestion || p.applied\">Aplicar</button>\n                <span v-if=\"p.isLoading\">‚è≥</span>\n                <div v-if=\"p.suggestion\" class=\"suggestion-preview\"><strong>Sugerencia:</strong><div v-html=\"p.suggestion\"></div></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        </div>\n      </div>\n\n      <!-- Secci√≥n de Procedimiento Mejorada -->\n      <div class=\"section\">\n        <h3>5. Procedimiento</h3>\n        <div class=\"section-description\">\n          <p><strong>Instrucciones para describir el procedimiento:</strong></p>\n          <ul>\n            <li><strong>Escribe en lenguaje natural</strong> c√≥mo se realiza el proceso</li>\n            <li><strong>Menciona los responsables</strong> y sus actividades</li>\n            <li><strong>Incluye decisiones</strong> (si algo est√° correcto o no)</li>\n            <li><strong>Describe alternativas</strong> (qu√© pasa si algo sale bien o mal)</li>\n            <li><strong>El sistema generar√° autom√°ticamente</strong> la numeraci√≥n continua (5.1, 5.2, 5.3...)</li>\n            <li><strong>Para subsecciones usa:</strong> 5.1.1, a), b), ‚Ä¢, -, ‚Üí, subpaso 1, etc.</li>\n            <li><strong>El encabezado aparecer√° en todas las p√°ginas</strong> del documento generado</li>\n          </ul>\n          <p><strong>Ejemplo de c√≥mo escribir con subsecciones:</strong></p>\n          <pre class=\"format-example\">\nEl administrador revisa la lista de proveedores a pagar\nEl administrador env√≠a la lista al gerente general para revisi√≥n\nEl gerente general revisa la lista de proveedores\n¬øLa lista est√° correcta?\nSi est√° correcta, el gerente general realiza el pago a los proveedores\na) Verifica disponibilidad de fondos\nb) Prepara √≥rdenes de pago\nc) Registra en el sistema contable\nSi no est√° correcta, el gerente general devuelve la lista al administrador\nEl administrador verifica y corrige la informaci√≥n de los proveedores\n5.1.1 Consulta base de datos de proveedores\n5.1.2 Actualiza informaci√≥n faltante\n5.1.3 Valida documentos de respaldo\nEl administrador actualiza la lista con la informaci√≥n corregida\nEl proceso se repite desde el env√≠o al gerente general\nFin del proceso\n          </pre>\n        </div>\n        \n        <div class=\"rich-text-editor\">\n          <div class=\"toolbar\">\n            <!-- Grupo de formato de texto -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('bold') }\"\n                @click=\"procedimientoEditor?.chain().focus().toggleBold().run()\"\n                title=\"Negrita (Ctrl+B)\"\n              >\n                <strong>B</strong>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('italic') }\"\n                @click=\"procedimientoEditor?.chain().focus().toggleItalic().run()\"\n                title=\"Cursiva (Ctrl+I)\"\n              >\n                <em>I</em>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('underline') }\"\n                @click=\"procedimientoEditor?.chain().focus().toggleUnderline().run()\"\n                title=\"Subrayado (Ctrl+U)\"\n              >\n                <u>U</u>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('strike') }\"\n                @click=\"procedimientoEditor?.chain().focus().toggleStrike().run()\"\n                title=\"Tachado (Ctrl+Shift+S)\"\n              >\n                <s>S</s>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de estilos de p√°rrafo -->\n            <div class=\"toolbar-group\">\n              <select \n                class=\"style-select\"\n                @change=\"applyStyle(procedimientoEditor, $event.target.value)\"\n                :value=\"getCurrentStyle(procedimientoEditor)\"\n                title=\"Estilo de p√°rrafo\"\n              >\n                <option value=\"paragraph\">P√°rrafo normal</option>\n                <option value=\"h1\">T√≠tulo 1</option>\n                <option value=\"h2\">T√≠tulo 2</option>\n                <option value=\"h3\">T√≠tulo 3</option>\n                <option value=\"blockquote\">Cita</option>\n                <option value=\"code\">C√≥digo</option>\n              </select>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('paragraph') && !procedimientoEditor?.isActive('heading') && !procedimientoEditor?.isActive('blockquote') && !procedimientoEditor?.isActive('codeBlock') }\"\n                @click=\"procedimientoEditor?.chain().focus().setParagraph().run()\"\n                title=\"P√°rrafo normal\"\n              >\n                <span class=\"icon-text\">¬∂</span>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de alineaci√≥n -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive({ textAlign: 'left' }) }\"\n                @click=\"procedimientoEditor?.chain().focus().setTextAlign('left').run()\"\n                title=\"Alinear a la izquierda\"\n              >\n                <font-awesome-icon icon=\"align-left\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive({ textAlign: 'center' }) }\"\n                @click=\"procedimientoEditor?.chain().focus().setTextAlign('center').run()\"\n                title=\"Centrar\"\n              >\n                <font-awesome-icon icon=\"align-center\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive({ textAlign: 'right' }) }\"\n                @click=\"procedimientoEditor?.chain().focus().setTextAlign('right').run()\"\n                title=\"Alinear a la derecha\"\n              >\n                <font-awesome-icon icon=\"align-right\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive({ textAlign: 'justify' }) }\"\n                @click=\"procedimientoEditor?.chain().focus().setTextAlign('justify').run()\"\n                title=\"Justificar\"\n              >\n                <font-awesome-icon icon=\"align-justify\" />\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de listas -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('bulletList') && !procedimientoEditor?.isActive('bulletList', { 'data-type': 'letter' }) }\"\n                @click=\"toggleBulletList(procedimientoEditor)\"\n                title=\"Lista con vi√±etas\"\n              >\n                <span>‚Ä¢</span>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('orderedList') }\"\n                @click=\"procedimientoEditor?.chain().focus().toggleOrderedList().run()\"\n                title=\"Lista numerada\"\n              >\n                <span>1.</span>\n              </button>\n\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': procedimientoEditor?.isActive('bulletList', { 'data-type': 'letter' }) }\"\n                @click=\"toggleLetterList(procedimientoEditor)\"\n                title=\"Lista con letras\"\n              >\n                <span>a)</span>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de herramientas -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                @click=\"procedimientoEditor?.chain().focus().undo().run()\"\n                title=\"Deshacer (Ctrl+Z)\"\n              >\n                ‚Ü∂\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                @click=\"procedimientoEditor?.chain().focus().redo().run()\"\n                title=\"Rehacer (Ctrl+Y)\"\n              >\n                ‚Ü∑\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                @click=\"clearProcedimiento\"\n                title=\"Limpiar procedimiento\"\n              >\n                √ó\n              </button>\n            </div>\n          </div>\n          \n          <editor-content \n            :editor=\"procedimientoEditor\" \n            class=\"editor-content\"\n          />\n\n        <!-- Controles IA por p√°rrafo para Procedimiento -->\n        <div class=\"paragraph-controls\">\n          <button class=\"ia-toggle-btn\" @click=\"initParagraphControls('procedimiento', procedimientoEditor); paragraphModeVisible['procedimiento'] = !paragraphModeVisible['procedimiento']\">\n            {{ paragraphModeVisible['procedimiento'] ? 'Cerrar IA por p√°rrafo' : 'IA por p√°rrafo' }}\n          </button>\n\n          <div v-if=\"paragraphModeVisible['procedimiento']\" class=\"paragraph-panel\">\n            <div v-for=\"(p, pi) in paragraphControls['procedimiento']\" :key=\"pi\" class=\"paragraph-control\">\n              <div class=\"para-text\" v-html=\"p.html\"></div>\n              <div class=\"para-actions\">\n                <button @click=\"suggestForParagraph('procedimiento', pi)\" :disabled=\"p.isLoading\">Sugerir</button>\n                <button @click=\"improveParagraph('procedimiento', pi)\" :disabled=\"p.isLoading\">Mejorar</button>\n                <button @click=\"applyParagraphChange('procedimiento', pi, procedimientoEditor)\" :disabled=\"!p.suggestion || p.applied\">Aplicar</button>\n                <span v-if=\"p.isLoading\">‚è≥</span>\n                <div v-if=\"p.suggestion\" class=\"suggestion-preview\"><strong>Sugerencia:</strong><div v-html=\"p.suggestion\"></div></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        </div>\n        \n        <!-- Vista previa de la tabla generada autom√°ticamente -->\n        <div class=\"table-preview\">\n          <h4>Vista Previa de la Tabla Generada Autom√°ticamente:</h4>\n          <div class=\"preview-container\">\n            <table class=\"preview-table\">\n              <thead>\n                <tr>\n                  <th width=\"15%\">(#)</th>\n                  <th width=\"25%\">(Quien)</th>\n                  <th width=\"60%\">(Actividad)</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for=\"(row, index) in generatedTable\" :key=\"index\" \n                    :class=\"getRowClass(row)\">\n                  <td>{{ row.number || '&nbsp;' }}</td>\n                  <td>{{ row.who || '&nbsp;' }}</td>\n                  <td>{{ row.activity || '&nbsp;' }}</td>\n                </tr>\n                <tr v-if=\"generatedTable.length === 0\">\n                  <td colspan=\"3\" style=\"text-align: center; color: #6c757d;\">\n                    La tabla se generar√° autom√°ticamente al hacer clic en \"Generar Tabla Autom√°ticamente\"\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <div class=\"action-buttons\">\n          <button @click=\"parseProcedimiento\" class=\"parse-btn\"> \n            Generar Tabla Autom√°ticamente\n          </button>\n          <button @click=\"loadExampleProcedimiento\" class=\"sample-btn\">\n            Cargar Ejemplo con Subsecciones\n          </button>\n          <button @click=\"analyzeWithAI\" :disabled=\"isAnalyzing\" class=\"parse-btn\">\n            Analizar con IA\n          </button>\n          <button @click=\"improveWithAI\" :disabled=\"isAnalyzing\" class=\"sample-btn\">\n            Mejorar con IA\n          </button>\n        </div>\n      </div>\n\n      <!-- Secciones restantes -->\n      <div class=\"section\" v-for=\"(section, index) in remainingSections\" :key=\"index + 10\">\n        <h3>{{ section.title }}</h3>\n        <div class=\"section-description\">\n          <p>{{ section.description }}</p>\n        </div>\n        \n        <div class=\"rich-text-editor\">\n          <div class=\"toolbar\">\n            <!-- Grupo de formato de texto -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('bold') }\"\n                @click=\"section.editor?.chain().focus().toggleBold().run()\"\n                title=\"Negrita (Ctrl+B)\"\n              >\n                <strong>B</strong>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('italic') }\"\n                @click=\"section.editor?.chain().focus().toggleItalic().run()\"\n                title=\"Cursiva (Ctrl+I)\"\n              >\n                <em>I</em>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('underline') }\"\n                @click=\"section.editor?.chain().focus().toggleUnderline().run()\"\n                title=\"Subrayado (Ctrl+U)\"\n              >\n                <u>U</u>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('strike') }\"\n                @click=\"section.editor?.chain().focus().toggleStrike().run()\"\n                title=\"Tachado (Ctrl+Shift+S)\"\n              >\n                <s>S</s>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de estilos de p√°rrafo -->\n            <div class=\"toolbar-group\">\n              <select \n                class=\"style-select\"\n                @change=\"applyStyle(section.editor, $event.target.value)\"\n                :value=\"getCurrentStyle(section.editor)\"\n                title=\"Estilo de p√°rrafo\"\n              >\n                <option value=\"paragraph\">P√°rrafo normal</option>\n                <option value=\"h1\">T√≠tulo 1</option>\n                <option value=\"h2\">T√≠tulo 2</option>\n                <option value=\"h3\">T√≠tulo 3</option>\n                <option value=\"blockquote\">Cita</option>\n                <option value=\"code\">C√≥digo</option>\n              </select>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('paragraph') && !section.editor?.isActive('heading') && !section.editor?.isActive('blockquote') && !section.editor?.isActive('codeBlock') }\"\n                @click=\"section.editor?.chain().focus().setParagraph().run()\"\n                title=\"P√°rrafo normal\"\n              >\n                <span class=\"icon-text\">¬∂</span>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de alineaci√≥n -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'left' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('left').run()\"\n                title=\"Alinear a la izquierda\"\n              >\n                <font-awesome-icon icon=\"align-left\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'center' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('center').run()\"\n                title=\"Centrar\"\n              >\n                <font-awesome-icon icon=\"align-center\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'right' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('right').run()\"\n                title=\"Alinear a la derecha\"\n              >\n                <font-awesome-icon icon=\"align-right\" />\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive({ textAlign: 'justify' }) }\"\n                @click=\"section.editor?.chain().focus().setTextAlign('justify').run()\"\n                title=\"Justificar\"\n              >\n                <font-awesome-icon icon=\"align-justify\" />\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de listas -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('bulletList') && !section.editor?.isActive('bulletList', { 'data-type': 'letter' }) }\"\n                @click=\"toggleBulletList(section.editor)\"\n                title=\"Lista con vi√±etas\"\n              >\n                <span>‚Ä¢</span>\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('orderedList') }\"\n                @click=\"section.editor?.chain().focus().toggleOrderedList().run()\"\n                title=\"Lista numerada\"\n              >\n                <span>1.</span>\n              </button>\n\n              <button\n                class=\"toolbar-btn\"\n                :class=\"{ 'active': section.editor?.isActive('bulletList', { 'data-type': 'letter' }) }\"\n                @click=\"toggleLetterList(section.editor)\"\n                title=\"Lista con letras\"\n              >\n                <span>a)</span>\n              </button>\n            </div>\n            \n            <div class=\"toolbar-separator\"></div>\n            \n            <!-- Grupo de herramientas -->\n            <div class=\"toolbar-group\">\n              <button\n                class=\"toolbar-btn\"\n                @click=\"section.editor?.chain().focus().undo().run()\"\n                title=\"Deshacer (Ctrl+Z)\"\n              >\n                ‚Ü∂\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                @click=\"section.editor?.chain().focus().redo().run()\"\n                title=\"Rehacer (Ctrl+Y)\"\n              >\n                ‚Ü∑\n              </button>\n              \n              <button\n                class=\"toolbar-btn\"\n                @click=\"clearSection(section)\"\n                title=\"Limpiar secci√≥n\"\n              >\n                √ó\n              </button>\n            </div>\n          </div>\n          \n          <editor-content \n            :editor=\"section.editor\" \n            class=\"editor-content\"\n          />\n        </div>\n      </div>\n      \n      <div class=\"document-controls\">\n        <button @click=\"generateWordDocument\" class=\"generate-btn\" :disabled=\"isGenerating\">\n          <font-awesome-icon icon=\"file-word\" class=\"feature-icon\" />\n          Generar Documento Word\n        </button>\n        <button @click=\"resetDocument\" class=\"reset-btn\">\n          <font-awesome-icon icon=\"trash\" class=\"feature-icon\" />\n          Limpiar Todo\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { generateWordDocument } from '@/utils/docGenerator'\nimport { aiService } from '@/services/aiService'\nimport { Editor, EditorContent } from '@tiptap/vue-3'\nimport StarterKit from '@tiptap/starter-kit'\nimport Underline from '@tiptap/extension-underline'\nimport Placeholder from '@tiptap/extension-placeholder'\n// BulletList removed (using StarterKit's implementation)\nimport TextAlign from '@tiptap/extension-text-align'\n\n// (Se removi√≥ la extensi√≥n personalizada para listas con letras para evitar duplicados con StarterKit)\n\nexport default {\n  name: 'DocumentView',\n  components: {\n    EditorContent\n  },\n  data() {\n    return {\n      showResetModal: false,\n      headerConfig: {\n        manualName: '',\n        policyName: '',\n        codigo: '',\n        area: '',\n        unidad: '',\n        revision: '',\n        fecha: this.getFormattedDate()\n      },\n      sections: [\n        { \n          title: '1. Objetivo o Prop√≥sito', \n          description: 'Establecer el prop√≥sito general del procedimiento.',\n          placeholder: 'Definir el objetivo principal del procedimiento y los resultados esperados...',\n          content: '',\n          editor: null\n        },\n        { \n          title: '2. Alcance', \n          description: 'Definir los l√≠mites y cobertura del procedimiento.',\n          placeholder: 'Especificar los l√≠mites, √°reas de aplicaci√≥n y exclusiones del procedimiento...',\n          content: '',\n          editor: null\n        },\n        { \n          title: '3. Responsabilidades', \n          description: 'Listar los roles y responsabilidades de cada participante.',\n          placeholder: '1. Responsable Principal\\n2. Coordinador\\n3. Ejecutor...',\n          content: '',\n          editor: null\n        },\n        { \n          title: '4. Normativa', \n          description: 'Establecer las normas, pol√≠ticas y criterios aplicables.',\n          placeholder: 'I. [MARCO NORMATIVO]\\nEstablecer las normas y pol√≠ticas que rigen el procedimiento...',\n          content: '',\n          editor: null\n        }\n      ],\n      // Controles por p√°rrafo para integrar IA por seccion\n      paragraphControls: {}, // { [sectionIdx]: [{ html, text, tag, suggestion, isLoading, applied }] }\n      paragraphModeVisible: {}, // { [sectionIdx]: boolean }\n      remainingSections: [\n        { \n          title: '6. Anexos', \n          description: 'Listar los formatos, documentos y anexos relacionados.',\n          placeholder: 'Formato de registro\\nDocumentos de referencia...',\n          content: '',\n          editor: null\n        },\n        { \n          title: '7. T√©rminos y Referencias', \n          description: 'Definir t√©rminos t√©cnicos y referencias documentales.',\n          placeholder: 'T√©rmino 1: Definici√≥n\\nT√©rmino 2: Explicaci√≥n...',\n          content: '',\n          editor: null\n        }\n      ],\n      generatedTable: [],\n      statusMessage: '',\n      statusType: '',\n      isGenerating: false,\n      isAnalyzing: false,\n      procedimientoEditor: null\n    }\n  },\n  computed: {\n    procedureTable() {\n      return this.generatedTable;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      this.initializeEditors();\n    });\n  },\n  beforeUnmount() {\n    this.destroyEditors();\n  },\n  methods: {\n    initializeEditors() {\n      // Configuraci√≥n base para todos los editores\n      const commonExtensionsBase = [\n        // Base principal ‚Äî StarterKit ya incluye heading, lists, blockquote, codeBlock, strike, hardBreak, etc.\n        StarterKit.configure({\n          hardBreak: {\n            keepMarks: true,\n          },\n          bulletList: {\n            HTMLAttributes: {\n              class: 'bullet-list',\n            },\n          },\n          codeBlock: {\n            HTMLAttributes: {\n              class: 'code-block',\n            },\n          },\n        }),\n        // Extensiones adicionales no incluidas en StarterKit\n        Underline,\n        TextAlign.configure({\n          types: ['heading', 'paragraph'],\n          alignments: ['left', 'center', 'right', 'justify'],\n          defaultAlignment: 'left',\n        })\n      ];\n\n      // Funci√≥n auxiliar para crear editores (acepta `placeholder` por secci√≥n)\n      const createEditor = (placeholder) => {\n        // A√±adir `Placeholder` din√°mico seg√∫n el par√°metro recibido\n        const extensions = [\n          ...commonExtensionsBase,\n          Placeholder.configure({\n            placeholder: ({ node }) => {\n              // Placeholder din√°mico basado en el contexto\n              if (node.type.name === 'heading') {\n                return 'T√≠tulo...';\n              }\n              if (node.type.name === 'codeBlock') {\n                return 'Escribe tu c√≥digo aqu√≠...';\n              }\n              if (node.type.name === 'blockquote') {\n                return 'Escribe una cita...';\n              }\n              return placeholder || 'Escribe tu contenido aqu√≠...';\n            }\n          })\n        ];\n\n        return new Editor({\n          content: '',\n          extensions: extensions,\n          onUpdate: () => {\n            // Manejar actualizaciones si es necesario\n          },\n          onCreate: () => {\n            console.log('Editor inicializado con opciones completas de Word');\n          },\n          editorProps: {\n            attributes: {\n              class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none',\n              style: 'min-height: 120px; white-space: pre-line;'\n            },\n            handleKeyDown: (view, event) => {\n              // Atajos de teclado comunes\n              \n              // Ctrl+B - Negrita\n              if (event.ctrlKey && event.key === 'b') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.bold));\n                return true;\n              }\n              \n              // Ctrl+I - Cursiva\n              if (event.ctrlKey && event.key === 'i') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.italic));\n                return true;\n              }\n              \n              // Ctrl+U - Subrayado\n              if (event.ctrlKey && event.key === 'u') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.underline));\n                return true;\n              }\n              \n              // Ctrl+Shift+S - Tachado\n              if (event.ctrlKey && event.shiftKey && event.key === 's') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.setMark(view.state.selection.from, view.state.selection.to, view.state.schema.marks.strike));\n                return true;\n              }\n              \n              // Ctrl+Z - Deshacer\n              if (event.ctrlKey && event.key === 'z') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.undo());\n                return true;\n              }\n              \n              // Ctrl+Y - Rehacer\n              if (event.ctrlKey && event.key === 'y') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.redo());\n                return true;\n              }\n              \n              // Atajo Ctrl+Alt+1 para t√≠tulo 1\n              if (event.ctrlKey && event.altKey && event.key === '1') {\n                event.preventDefault();\n                const currentLevel = view.state.selection.$from.parent.type.name === 'heading' \n                  ? view.state.selection.$from.parent.attrs.level \n                  : null;\n                \n                if (currentLevel === 1) {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.paragraph));\n                } else {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.heading, { level: 1 }));\n                }\n                return true;\n              }\n              \n              // Atajo Ctrl+Alt+2 para t√≠tulo 2\n              if (event.ctrlKey && event.altKey && event.key === '2') {\n                event.preventDefault();\n                const currentLevel = view.state.selection.$from.parent.type.name === 'heading' \n                  ? view.state.selection.$from.parent.attrs.level \n                  : null;\n                \n                if (currentLevel === 2) {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.paragraph));\n                } else {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.heading, { level: 2 }));\n                }\n                return true;\n              }\n              \n              // Atajo Ctrl+Alt+3 para t√≠tulo 3\n              if (event.ctrlKey && event.altKey && event.key === '3') {\n                event.preventDefault();\n                const currentLevel = view.state.selection.$from.parent.type.name === 'heading' \n                  ? view.state.selection.$from.parent.attrs.level \n                  : null;\n                \n                if (currentLevel === 3) {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.paragraph));\n                } else {\n                  view.dispatch(view.state.tr.setBlockType(view.state.selection.from, view.state.selection.to, view.state.schema.nodes.heading, { level: 3 }));\n                }\n                return true;\n              }\n              \n              // Ctrl+Enter para salto de l√≠nea suave\n              if (event.ctrlKey && event.key === 'Enter') {\n                event.preventDefault();\n                view.dispatch(view.state.tr.replaceSelectionWith(view.state.schema.nodes.hardBreak.create()).scrollIntoView());\n                return true;\n              }\n              \n              return false;\n            }\n          }\n        });\n      };\n\n      // Inicializar secciones principales\n      this.sections.forEach((section, index) => {\n        const editor = createEditor(section.placeholder);\n        editor.on('update', () => {\n          this.sections[index].content = editor.getHTML();\n        });\n        section.editor = editor;\n      });\n\n      // Inicializar secciones restantes\n      this.remainingSections.forEach((section, index) => {\n        const editor = createEditor(section.placeholder);\n        editor.on('update', () => {\n          this.remainingSections[index].content = editor.getHTML();\n        });\n        section.editor = editor;\n      });\n\n      // Inicializar editor de procedimiento\n      this.procedimientoEditor = createEditor('Describe el procedimiento completo aqu√≠ en lenguaje natural...');\n      this.procedimientoEditor.on('update', () => {\n        // Actualizar contenido del procedimiento si es necesario\n      });\n    },\n\n    // M√©todo para aplicar estilos desde el select\n    applyStyle(editor, style) {\n      if (!editor) return;\n      \n      switch(style) {\n        case 'paragraph':\n          editor.chain().focus().setParagraph().run();\n          break;\n        case 'h1':\n          editor.chain().focus().toggleHeading({ level: 1 }).run();\n          break;\n        case 'h2':\n          editor.chain().focus().toggleHeading({ level: 2 }).run();\n          break;\n        case 'h3':\n          editor.chain().focus().toggleHeading({ level: 3 }).run();\n          break;\n        case 'blockquote':\n          editor.chain().focus().toggleBlockquote().run();\n          break;\n        case 'code':\n          editor.chain().focus().toggleCodeBlock().run();\n          break;\n      }\n    },\n\n    // M√©todo para obtener el estilo actual del cursor\n    getCurrentStyle(editor) {\n      if (!editor) return 'paragraph';\n      \n      if (editor.isActive('heading', { level: 1 })) return 'h1';\n      if (editor.isActive('heading', { level: 2 })) return 'h2';\n      if (editor.isActive('heading', { level: 3 })) return 'h3';\n      if (editor.isActive('blockquote')) return 'blockquote';\n      if (editor.isActive('codeBlock')) return 'code';\n      \n      return 'paragraph';\n    },\n\n    // M√©todo para alternar lista con letras\n    toggleLetterList(editor) {\n      if (!editor) return;\n\n      // Si ya est√° activa la lista de letras -> quitar atributo 'data-type' (vuelve a vi√±eta normal)\n      if (editor.isActive('bulletList', { 'data-type': 'letter' })) {\n        editor.chain().focus().updateAttributes('bulletList', { 'data-type': null }).run();\n        return;\n      }\n\n      // Si hay una lista normal activa -> convertirla a lista de letras\n      if (editor.isActive('bulletList')) {\n        editor.chain().focus().updateAttributes('bulletList', { 'data-type': 'letter' }).run();\n        return;\n      }\n\n      // Si no hay lista activa -> crear lista y luego marcar como 'letter' en una sola cadena\n      editor.chain().focus().toggleBulletList().updateAttributes('bulletList', { 'data-type': 'letter' }).run();\n    },\n\n    // M√©todo central para togglear vi√±etas normales y limpiar el atributo 'letter' si existe\n    toggleBulletList(editor) {\n      if (!editor) return;\n\n      // Si estamos en una lista de letras y se quiere vi√±eta normal -> quitar atributo 'letter'\n      if (editor.isActive('bulletList', { 'data-type': 'letter' })) {\n        editor.chain().focus().updateAttributes('bulletList', { 'data-type': null }).run();\n        return;\n      }\n\n      // En el resto de casos, hacer toggle normal (activar/desactivar)\n      editor.chain().focus().toggleBulletList().run();\n    },\n\n    destroyEditors() {\n      // Destruir todos los editores para evitar memory leaks\n      this.sections.forEach(section => {\n        if (section.editor) {\n          section.editor.destroy();\n        }\n      });\n      this.remainingSections.forEach(section => {\n        if (section.editor) {\n          section.editor.destroy();\n        }\n      });\n      if (this.procedimientoEditor) {\n        this.procedimientoEditor.destroy();\n      }\n    },\n\n    clearSection(section) {\n      if (section.editor) {\n        section.editor.commands.clearContent();\n        this.showStatus('Secci√≥n limpiada', 'info');\n      }\n    },\n\n    clearProcedimiento() {\n      if (this.procedimientoEditor) {\n        this.procedimientoEditor.commands.clearContent();\n        this.generatedTable = [];\n        this.showStatus('Procedimiento limpiado', 'info');\n      }\n    },\n\n    getFormattedDate() {\n      const today = new Date();\n      const year = today.getFullYear();\n      const month = String(today.getMonth() + 1).padStart(2, '0');\n      const day = String(today.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    },\n\n    loadExampleProcedimiento() {\n      if (!this.procedimientoEditor) return;\n      \n      const exampleText = `El administrador revisa la lista de proveedores a pagar\nEl administrador env√≠a la lista al gerente general para revisi√≥n\nEl gerente general revisa la lista de proveedores\n¬øLa lista est√° correcta?\nSi est√° correcta, el gerente general realiza el pago a los proveedores\na) Verifica disponibilidad de fondos\nb) Prepara √≥rdenes de pago\nc) Registra en el sistema contable\nSi no est√° correcta, el gerente general devuelve la lista al administrador\nEl administrador verifica y corrige la informaci√≥n de los proveedores\n5.1.1 Consulta base de datos de proveedores\n5.1.2 Actualiza informaci√≥n faltante\n5.1.3 Valida documentos de respaldo\nEl administrador actualiza la lista con la informaci√≥n corregida\nEl proceso se repite desde el env√≠o al gerente general\nFin del proceso`;\n\n      // Convertir el texto plano a formato que Tiptap entienda con saltos de l√≠nea\n      const formattedContent = exampleText.split('\\n').map(line => {\n        if (line.trim() === '') return '<p></p>';\n        \n        // Detectar si es una lista con letras (a), b), c), etc.)\n        if (/^[a-z]\\)/.test(line.trim())) {\n          return `<ul data-type=\"letter\"><li>${line.replace(/^[a-z]\\)\\s*/, '')}</li></ul>`;\n        }\n        \n        // Detectar si es una lista numerada (5.1.1, 5.1.2, etc.)\n        if (/^\\d+\\.\\d+\\.\\d+/.test(line.trim())) {\n          return `<ul><li>${line}</li></ul>`;\n        }\n        \n        return `<p>${line}</p>`;\n      }).join('');\n\n      this.procedimientoEditor.commands.setContent(formattedContent);\n      this.showStatus('üìù Ejemplo con subsecciones cargado. Haz clic en \"Generar Tabla Autom√°ticamente\" para ver el resultado.', 'info');\n    },\n\n    parseProcedimiento() {\n      if (!this.procedimientoEditor) return;\n      \n      const textContent = this.procedimientoEditor.getText();\n      \n      if (!textContent.trim()) {\n        this.showStatus('‚ùå Por favor ingresa la descripci√≥n del procedimiento', 'error');\n        return;\n      }\n\n      try {\n        const lines = textContent.split('\\n').filter(line => line.trim() !== '');\n        const table = [];\n        let stepNumber = 1;\n        let subStepNumber = 0;\n        let currentMainStep = null;\n\n        for (let i = 0; i < lines.length; i++) {\n          const line = lines[i].trim();\n          \n          if (line === '') continue;\n\n          if (this.isSubsectionStarter(line)) {\n            if (currentMainStep) {\n              subStepNumber++;\n              const fullNumber = `${currentMainStep}.${subStepNumber}`;\n              const responsible = this.extractResponsible(line);\n              const activity = this.extractActivity(line, responsible);\n              \n              table.push({ \n                number: fullNumber, \n                who: responsible, \n                activity: activity,\n                level: 'sub'\n              });\n            } else {\n              const responsible = this.extractResponsible(line);\n              const activity = this.extractActivity(line, responsible);\n              \n              table.push({ \n                number: `${stepNumber}`, \n                who: responsible, \n                activity: activity \n              });\n              stepNumber++;\n              subStepNumber = 0;\n            }\n          }\n          else if (this.isMainProcessLine(line)) {\n            table.push({ number: '', who: '', activity: line, level: 'section' });\n            currentMainStep = null;\n            subStepNumber = 0;\n          }\n          else if (line.startsWith('¬ø')) {\n            table.push({ number: '', who: '', activity: line, level: 'question' });\n            currentMainStep = null;\n            subStepNumber = 0;\n          }\n          else if (line.toLowerCase().startsWith('si ') || line.toLowerCase().startsWith('no ') || \n                   line.toLowerCase().startsWith('si,') || line.toLowerCase().startsWith('no,')) {\n            table.push({ number: '', who: '', activity: line, level: 'alternative' });\n            currentMainStep = null;\n            subStepNumber = 0;\n          }\n          else if (line.toLowerCase().includes('fin del proceso')) {\n            table.push({ number: '', who: '', activity: 'Fin del Proceso', level: 'end' });\n            currentMainStep = null;\n            subStepNumber = 0;\n          }\n          else {\n            const responsible = this.extractResponsible(line);\n            const activity = this.extractActivity(line, responsible);\n            \n            if (responsible || activity) {\n              table.push({ \n                number: `${stepNumber}`, \n                who: responsible, \n                activity: activity \n              });\n              currentMainStep = stepNumber;\n              stepNumber++;\n              subStepNumber = 0;\n            }\n          }\n        }\n\n        this.generatedTable = table;\n        this.showStatus('‚úÖ Tabla generada autom√°ticamente desde la descripci√≥n', 'success');\n      } catch (error) {\n        this.showStatus('‚ùå Error al procesar la descripci√≥n: ' + error.message, 'error');\n      }\n    },\n\n    // Analiza el texto del procedimiento usando el servicio de IA\n    async analyzeWithAI() {\n      if (!this.procedimientoEditor) return;\n      const textContent = this.procedimientoEditor.getText();\n      if (!textContent.trim()) {\n        this.showStatus('‚ùå Por favor ingresa la descripci√≥n del procedimiento', 'error');\n        return;\n      }\n\n      this.isAnalyzing = true;\n      try {\n        const result = await aiService.analyzeProcedimiento(textContent);\n        const pasos = result.pasos || [];\n        const table = [];\n        let counter = 1;\n\n        for (const paso of pasos) {\n          const tipo = (paso.tipo || 'normal').toLowerCase();\n          const who = paso.responsable ? this.capitalizeFirstLetter(paso.responsable) : '';\n          const activity = paso.actividad || '';\n\n          if (tipo === 'normal') {\n            table.push({ number: `${counter}`, who, activity, level: 'normal' });\n            counter++;\n          } else if (tipo === 'decision') {\n            table.push({ number: '', who, activity: activity, level: 'question' });\n          } else if (tipo === 'alternative') {\n            table.push({ number: '', who, activity: activity, level: 'alternative' });\n          } else if (tipo === 'fin') {\n            table.push({ number: '', who, activity: activity || 'Fin del Proceso', level: 'end' });\n          } else {\n            table.push({ number: `${counter}`, who, activity, level: 'normal' });\n            counter++;\n          }\n\n          if (Array.isArray(paso.subpasos) && paso.subpasos.length) {\n            for (const sub of paso.subpasos) {\n              table.push({ number: '', who: sub.responsable ? this.capitalizeFirstLetter(sub.responsable) : who, activity: sub.actividad || '', level: 'sub' });\n            }\n          }\n        }\n\n        this.generatedTable = table;\n        this.showStatus('‚úÖ Tabla generada desde el an√°lisis de IA', 'success');\n      } catch (error) {\n        console.error('Error analizando con IA:', error);\n        this.showStatus('‚ùå Error al analizar con IA: ' + (error.message || error), 'error');\n      } finally {\n        this.isAnalyzing = false;\n      }\n    },\n\n    // Mejora el texto del procedimiento usando el servicio de IA\n    async improveWithAI() {\n      if (!this.procedimientoEditor) return;\n      const textContent = this.procedimientoEditor.getText();\n      if (!textContent.trim()) {\n        this.showStatus('‚ùå Por favor ingresa la descripci√≥n del procedimiento', 'error');\n        return;\n      }\n\n      this.isAnalyzing = true;\n      try {\n        const improved = await aiService.mejorarTextoProcedimiento(textContent);\n        if (improved && typeof improved === 'string') {\n          const formatted = improved.split('\\n').map(line => `<p>${line}</p>`).join('');\n          this.procedimientoEditor.commands.setContent(formatted);\n          this.showStatus('‚úÖ Texto mejorado por IA aplicado al editor', 'success');\n        } else {\n          this.showStatus('‚ö†Ô∏è La IA no devolvi√≥ una mejora v√°lida', 'info');\n        }\n      } catch (error) {\n        console.error('Error mejorando con IA:', error);\n        this.showStatus('‚ùå Error al mejorar con IA: ' + (error.message || error), 'error');\n      } finally {\n        this.isAnalyzing = false;\n      }\n    },\n\n    /* ----------------- Controles por p√°rrafo (IA) ----------------- */\n    getParagraphsFromEditor(editor) {\n      const html = editor?.getHTML ? editor.getHTML() : '';\n      const wrapper = (typeof document !== 'undefined') ? document.createElement('div') : null;\n      if (!wrapper) return [];\n      wrapper.innerHTML = html || '';\n      const nodes = Array.from(wrapper.childNodes).filter(n => {\n        return (n.nodeType === Node.ELEMENT_NODE && n.textContent && n.textContent.trim()) || (n.nodeType === Node.TEXT_NODE && n.textContent && n.textContent.trim());\n      });\n\n      return nodes.map(node => ({\n        html: node.nodeType === Node.ELEMENT_NODE ? node.outerHTML : `<p>${(node.textContent || '').trim()}</p>`,\n        text: node.textContent ? node.textContent.trim() : '',\n        tag: node.nodeType === Node.ELEMENT_NODE ? (node.tagName || 'div').toLowerCase() : 'p'\n      }));\n    },\n\n    initParagraphControls(sectionIdx, editor) {\n      if (!editor) return;\n      const paras = this.getParagraphsFromEditor(editor);\n      const list = paras.map(p => ({ ...p, suggestion: null, isLoading: false, applied: false }));\n      // Vue 3: asignaci√≥n directa para mantener reactividad\n      this.paragraphControls[sectionIdx] = list;\n      if (this.paragraphModeVisible[sectionIdx] === undefined) {\n        this.paragraphModeVisible[sectionIdx] = true;\n      }\n    },\n\n    async suggestForParagraph(sectionIdx, paraIdx) {\n      const list = this.paragraphControls[sectionIdx];\n      if (!list || !list[paraIdx]) return;\n      list[paraIdx].isLoading = true;\n      try {\n        const text = list[paraIdx].text || '';\n        const suggestions = await aiService.sugerirMejorasRapidas(text);\n        const joined = Array.isArray(suggestions) ? suggestions.join('\\n') : (suggestions || '');\n        list[paraIdx].suggestion = joined.replace(/\\n/g, '<br/>');\n      } catch (e) {\n        list[paraIdx].suggestion = 'Error: ' + (e.message || e);\n      } finally {\n        list[paraIdx].isLoading = false;\n      }\n    },\n\n    async improveParagraph(sectionIdx, paraIdx) {\n      const list = this.paragraphControls[sectionIdx];\n      if (!list || !list[paraIdx]) return;\n      list[paraIdx].isLoading = true;\n      try {\n        const original = list[paraIdx].text || '';\n        const improved = await aiService.mejorarTextoProcedimiento(original);\n        const content = (improved && typeof improved === 'string') ? improved : original;\n        // Convertir a HTML simple\n        const html = content.split('\\n').map(line => `<p>${line}</p>`).join('');\n        list[paraIdx].suggestion = html;\n      } catch (e) {\n        list[paraIdx].suggestion = 'Error: ' + (e.message || e);\n      } finally {\n        list[paraIdx].isLoading = false;\n      }\n    },\n\n    applyParagraphChange(sectionIdx, paraIdx, editor) {\n      const list = this.paragraphControls[sectionIdx];\n      if (!list || !list[paraIdx] || !editor) return;\n      const replacement = list[paraIdx].suggestion || list[paraIdx].text;\n      const newHtml = this._applyParagraphHtml(editor.getHTML(), paraIdx, replacement);\n      try {\n        editor.commands.setContent(newHtml);\n        list[paraIdx].applied = true;\n      } catch (e) {\n        console.error('Error aplicando cambio de p√°rrafo:', e);\n      }\n    },\n\n    _applyParagraphHtml(originalHtml, paraIdx, replacementText) {\n      const wrapper = (typeof document !== 'undefined') ? document.createElement('div') : null;\n      if (!wrapper) return originalHtml;\n      wrapper.innerHTML = originalHtml || '';\n      const nodes = Array.from(wrapper.childNodes).filter(n => (n.nodeType === Node.ELEMENT_NODE) || (n.nodeType === Node.TEXT_NODE && n.textContent && n.textContent.trim()));\n      const target = nodes[paraIdx];\n      if (!target) return originalHtml;\n      const replacementFragment = (typeof document !== 'undefined') ? document.createElement('div') : null;\n      replacementFragment.innerHTML = replacementText || '';\n      // Replace target with replacement nodes\n      const newNodes = Array.from(replacementFragment.childNodes);\n      if (newNodes.length === 0) {\n        // fallback: replace text content\n        target.textContent = replacementText;\n      } else {\n        target.replaceWith(...newNodes);\n      }\n      return wrapper.innerHTML;\n    },\n\n    isSubsectionStarter(line) {\n      const subsectionPatterns = [\n        /^\\d+\\.\\d+\\.\\d+/,\n        /^[a-z]\\)/,\n        /^[ivx]+\\)/,\n        /^‚Ä¢\\s/,\n        /^-\\s/,\n        /^‚Üí\\s/,\n        /^subpaso\\s\\d+/i,\n        /^detalle\\s\\d+/i\n      ];\n\n      return subsectionPatterns.some(pattern => pattern.test(line.toLowerCase()));\n    },\n\n    isMainProcessLine(line) {\n      return !line.startsWith('¬ø') && \n             !line.toLowerCase().startsWith('si ') && \n             !line.toLowerCase().startsWith('no ') &&\n             !line.toLowerCase().startsWith('si,') && \n             !line.toLowerCase().startsWith('no,') &&\n             !line.toLowerCase().includes('fin del proceso') &&\n             !this.extractResponsible(line) &&\n             !this.isSubsectionStarter(line) &&\n             line.length > 10;\n    },\n\n    extractResponsible(line) {\n      const patterns = [\n        /^el (\\w+)/i,\n        /^la (\\w+)/i,\n        /^los (\\w+)/i,\n        /^las (\\w+)/i,\n        /^un (\\w+)/i,\n        /^una (\\w+)/i,\n        /^(\\w+) (revisa|env√≠a|realiza|verifica|corrige|aprueba|autoriza)/i\n      ];\n\n      for (const pattern of patterns) {\n        const match = line.match(pattern);\n        if (match) {\n          return this.capitalizeFirstLetter(match[1] || match[2]);\n        }\n      }\n\n      return '';\n    },\n\n    extractActivity(line, responsible) {\n      if (!responsible) return line;\n\n      // Asegurar que 'responsible' se use correctamente y escapar caracteres para la regex\n      const respRaw = String(responsible).trim();\n      const respEscaped = respRaw.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n      // Quitar prefijos t√≠picos que repiten el responsable (ej. \"El administrador ...\")\n      const removePattern = new RegExp(`^(el\\\\s+${respEscaped}|la\\\\s+${respEscaped}|los\\\\s+${respEscaped}|las\\\\s+${respEscaped}|${respEscaped})\\\\s+`, 'i');\n      let activity = line.replace(removePattern, '').trim();\n\n      // Capitalizar primera letra\n      if (!activity) return '';\n      return activity.charAt(0).toUpperCase() + activity.slice(1);\n    },\n\n    capitalizeFirstLetter(string) {\n      return string.charAt(0).toUpperCase() + string.slice(1);\n    },\n\n    getRowClass(row) {\n      if (row.level === 'section') {\n        return 'section-row';\n      }\n      if (row.level === 'sub') {\n        return 'subsection-row';\n      }\n      if (row.level === 'question') {\n        return 'question-row';\n      }\n      if (row.level === 'alternative') {\n        return 'alternative-row';\n      }\n      if (row.level === 'end') {\n        return 'end-row';\n      }\n      if (!row.number && !row.who && !row.activity) {\n        return 'empty-row';\n      }\n      return 'normal-row';\n    },\n\n    async generateWordDocument() {\n      this.isGenerating = true;\n      \n      const procedimientoText = this.procedimientoEditor ? this.procedimientoEditor.getText() : '';\n      \n      // Si hay texto en el procedimiento pero no se ha generado la tabla, generarla\n      if (procedimientoText && this.generatedTable.length === 0) {\n        this.parseProcedimiento();\n      }\n\n      const documentData = {\n        headerConfig: this.headerConfig,\n        objetivo: this.sections[0].editor.getHTML(),\n        alcance: this.sections[1].editor.getHTML(),\n        responsabilidades: this.sections[2].editor.getHTML(),\n        normativa: this.sections[3].editor.getHTML(),\n        anexos: this.remainingSections[0].editor.getHTML(),\n        terminos: this.remainingSections[1].editor.getHTML()\n      };\n\n      try {\n        await generateWordDocument(documentData, this.generatedTable);\n        this.showStatus('‚úÖ Documento Word generado exitosamente!', 'success');\n      } catch (error) {\n        console.error('Error generating document:', error);\n        this.showStatus('‚ùå Error al generar el documento: ' + error.message, 'error');\n      } finally {\n        this.isGenerating = false;\n      }\n    },\n\n    resetDocument() {\n      // Mostrar modal personalizado en lugar de confirm() nativo\n      this.showResetModal = true;\n    },\n\n    closeResetModal() {\n      this.showResetModal = false;\n    },\n\n    confirmReset() {\n      this.showResetModal = false;\n      this.executeReset();\n      this.showStatus('üóëÔ∏è Todo el contenido ha sido resetado', 'info');\n    },\n\n    executeReset() {\n      // Limpiar secciones de contenido\n      this.sections.forEach(section => {\n        if (section.editor) {\n          section.editor.commands.clearContent();\n        }\n      });\n      this.remainingSections.forEach(section => {\n        if (section.editor) {\n          section.editor.commands.clearContent();\n        }\n      });\n      if (this.procedimientoEditor) {\n        this.procedimientoEditor.commands.clearContent();\n      }\n      this.generatedTable = [];\n      \n      // Limpiar configuraci√≥n del encabezado\n      this.headerConfig = {\n        manualName: '',\n        policyName: '',\n        codigo: '',\n        area: '',\n        unidad: '',\n        revision: '',\n        fecha: this.getFormattedDate()\n      };\n    },\n\n    showStatus(message, type) {\n      this.statusMessage = message;\n      this.statusType = type;\n      \n      setTimeout(() => {\n        this.statusMessage = '';\n        this.statusType = '';\n      }, 5000);\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* Estilos para el modal mejorado */\n.modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  animation: fadeIn 0.2s ease-out;\n}\n\n.modal-container {\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 450px;\n  overflow: hidden;\n  animation: slideUp 0.3s ease-out;\n  border: 1px solid #e1e8ed;\n}\n\n.modal-header {\n  display: flex;\n  align-items: center;\n  padding: 20px 24px 0;\n  background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);\n  border-bottom: 1px solid #fdcb6e;\n}\n\n.modal-icon {\n  width: 40px;\n  height: 40px;\n  background: #f39c12;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n  font-size: 18px;\n}\n\n.modal-title {\n  flex: 1;\n  margin: 0;\n  color: #e67e22;\n  font-size: 1.3rem;\n  font-weight: 700;\n}\n\n.modal-close-btn {\n  background: none;\n  border: none;\n  font-size: 24px;\n  cursor: pointer;\n  color: #95a5a6;\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n\n.modal-close-btn:hover {\n  background: #f8f9fa;\n  color: #e74c3c;\n}\n\n.modal-content {\n  padding: 24px;\n  text-align: center;\n}\n\n.modal-message {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: #2c3e50;\n  margin: 0 0 8px 0;\n  line-height: 1.4;\n}\n\n.modal-warning {\n  font-size: 0.95rem;\n  color: #e74c3c;\n  margin: 0;\n  font-weight: 500;\n}\n\n.modal-actions {\n  display: flex;\n  gap: 12px;\n  padding: 0 24px 24px;\n  justify-content: center;\n}\n\n.modal-btn {\n  flex: 1;\n  border: none;\n  padding: 12px 20px;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 600;\n  transition: all 0.3s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  min-height: 44px;\n}\n\n.modal-btn-cancel {\n  background-color: #ecf0f1;\n  color: #2c3e50;\n  border: 2px solid #bdc3c7;\n}\n\n.modal-btn-cancel:hover {\n  background-color: #d5dbdb;\n  border-color: #95a5a6;\n  transform: translateY(-1px);\n}\n\n.modal-btn-confirm {\n  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\n  color: white;\n  border: 2px solid #c0392b;\n}\n\n.modal-btn-confirm:hover {\n  background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);\n}\n\n.btn-icon {\n  font-size: 16px;\n}\n\n/* Animaciones */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes slideUp {\n  from {\n    opacity: 0;\n    transform: translateY(30px) scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Estilos existentes del documento */\n.document-view {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.document-controls {\n  display: flex;\n  gap: 15px;\n  margin-bottom: 30px;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.generate-btn, .reset-btn {\n  border: none;\n  padding: 12px 24px;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 600;\n  transition: all 0.3s ease;\n  min-width: 160px;\n}\n\n.generate-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n.generate-btn:disabled:hover {\n  transform: none;\n}\n\n.generate-btn {\n  background-color: #2c5aa0; \n  color: white;\n}\n\n.generate-btn:hover:not(:disabled) {\n  background-color: #15386c; \n  transform: translateY(-2px);\n}\n\n.reset-btn {\n  background-color: red;\n  color: white;\n}\n\n.reset-btn:hover {\n  background-color: rgb(181, 20, 20);\n  transform: translateY(-2px);\n}\n\n.document-editor {\n  background: white;\n  padding: 30px;\n  border-radius: 10px;\n  box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);\n}\n\n.section {\n  margin-bottom: 30px;\n  padding: 25px;\n  border: 1px solid #e1e8ed;\n  border-radius: 8px;\n  background: #ffffff;\n  transition: box-shadow 0.3s ease;\n}\n\n.section:hover {\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n}\n\n.section h3 {\n  color: #2c3e50;\n  margin-bottom: 15px;\n  font-size: 1.4rem;\n  border-bottom: 3px solid #3498db;\n  padding-bottom: 10px;\n  font-weight: 700;\n}\n\n.header-config {\n  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\n  border-left: 4px solid #3498db;\n}\n\n.header-fields {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 15px;\n  margin-top: 15px;\n}\n\n.field-group {\n  display: flex;\n  flex-direction: column;\n}\n\n.field-group label {\n  font-weight: 600;\n  margin-bottom: 5px;\n  color: #2c3e50;\n  font-size: 0.9rem;\n}\n\n.header-input {\n  padding: 10px 12px;\n  border: 2px solid #e9ecef;\n  border-radius: 6px;\n  font-size: 14px;\n  transition: border-color 0.3s ease;\n}\n\n.header-input::placeholder {\n  color: #6c757d;\n  opacity: 0.7;\n  font-style: italic;\n}\n\n.header-input:focus::placeholder {\n  opacity: 0.5;\n}\n\n.header-input:focus {\n  outline: none;\n  border-color: #3498db;\n  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);\n}\n\n.section-description {\n  background: #f8f9fa;\n  padding: 15px;\n  border-radius: 6px;\n  margin-bottom: 15px;\n  font-size: 0.95rem;\n  color: #495057;\n  border-left: 4px solid #3498db;\n}\n\n.section-description p {\n  margin: 0;\n}\n\n.section-description ul {\n  margin: 10px 0;\n  padding-left: 20px;\n}\n\n.section-description li {\n  margin-bottom: 5px;\n  line-height: 1.4;\n}\n\n.format-example {\n  background: #f8f9fa;\n  border: 1px solid #dee2e6;\n  border-radius: 4px;\n  padding: 15px;\n  font-family: 'Consolas', 'Monaco', monospace;\n  font-size: 12px;\n  line-height: 1.4;\n  margin: 10px 0;\n  white-space: pre-wrap;\n  color: #495057;\n}\n\n/* Estilos para el editor de texto enriquecido */\n.rich-text-editor {\n  border: 2px solid #e9ecef;\n  border-radius: 6px;\n  background: white;\n  transition: border-color 0.3s ease;\n  overflow: hidden;\n}\n\n.rich-text-editor:focus-within {\n  border-color: #3498db;\n  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);\n}\n\n.toolbar {\n  display: flex;\n  align-items: center;\n  padding: 8px 12px;\n  background: #f8f9fa;\n  border-bottom: 1px solid #e9ecef;\n  gap: 4px;\n  flex-wrap: wrap;\n}\n\n.toolbar-group {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n.toolbar-btn {\n  background: white;\n  border: 1px solid #dee2e6;\n  border-radius: 4px;\n  padding: 6px 8px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: #495057;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 28px;\n  height: 28px;\n}\n\n.toolbar-btn:hover {\n  background: #e9ecef;\n  border-color: #adb5bd;\n}\n\n.toolbar-btn.active {\n  background: #3498db;\n  color: white;\n  border-color: #3498db;\n}\n\n/* Select de estilos */\n.style-select {\n  padding: 4px 8px;\n  border: 1px solid #dee2e6;\n  border-radius: 4px;\n  font-size: 11px;\n  background: white;\n  color: #495057;\n  min-width: 120px;\n  height: 28px;\n  cursor: pointer;\n  outline: none;\n}\n\n.style-select:focus {\n  border-color: #3498db;\n  box-shadow: 0 0 0 1px rgba(52, 152, 219, 0.2);\n}\n\n.style-select option {\n  padding: 4px;\n}\n\n/* Iconos especiales */\n.icon-text {\n  font-size: 14px;\n  font-weight: bold;\n}\n\n.icon-align {\n  font-size: 14px;\n  font-weight: bold;\n}\n\n.toolbar-separator {\n  width: 1px;\n  height: 20px;\n  background: #dee2e6;\n  margin: 0 4px;\n}\n\n.editor-content {\n  padding: 15px;\n  min-height: 120px;\n  max-height: 400px;\n  overflow-y: auto;\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  font-size: 14px;\n  line-height: 1.6;\n  color: #2c3e50;\n  background: white;\n  outline: none;\n}\n\n/* Estilos para el contenido del editor Tiptap */\n:deep(.ProseMirror) {\n  outline: none;\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  font-size: 14px;\n  line-height: 1.6;\n  color: #2c3e50;\n  min-height: 100px;\n  padding: 0 !important;\n}\n\n:deep(.ProseMirror p) {\n  margin: 0 0 12px 0;\n}\n\n:deep(.ProseMirror:focus) {\n  outline: none;\n}\n\n/* Estilos para t√≠tulos en el editor */\n:deep(.ProseMirror h1) {\n  font-size: 1.5rem !important;\n  font-weight: 700 !important;\n  color: #1F4E79 !important;\n  margin: 1.5rem 0 1rem 0 !important;\n  line-height: 1.2 !important;\n  border-bottom: 2px solid #1F4E79 !important;\n  padding-bottom: 0.5rem !important;\n  font-family: 'Times New Roman', serif !important;\n}\n\n:deep(.ProseMirror h2) {\n  font-size: 1.3rem !important;\n  font-weight: 600 !important;\n  color: #2C3E50 !important;\n  margin: 1.3rem 0 0.8rem 0 !important;\n  line-height: 1.3 !important;\n  border-bottom: 1px solid #D4D4D4 !important;\n  padding-bottom: 0.4rem !important;\n  font-family: 'Times New Roman', serif !important;\n}\n\n:deep(.ProseMirror h3) {\n  font-size: 1.1rem !important;\n  font-weight: 600 !important;\n  color: #34495E !important;\n  margin: 1rem 0 0.5rem 0 !important;\n  line-height: 1.4 !important;\n  font-family: 'Times New Roman', serif !important;\n}\n\n/* Estilos para citas */\n:deep(.ProseMirror blockquote) {\n  border-left: 4px solid #3498db !important;\n  padding-left: 1rem !important;\n  margin: 1rem 0 !important;\n  font-style: italic !important;\n  color: #495057 !important;\n  background: #f8f9fa !important;\n  padding: 0.75rem 1rem !important;\n  border-radius: 4px !important;\n}\n\n/* Estilos para c√≥digo */\n:deep(.ProseMirror pre) {\n  background: #2c3e50 !important;\n  color: #ecf0f1 !important;\n  padding: 0.75rem 1rem !important;\n  border-radius: 4px !important;\n  font-family: 'Consolas', 'Monaco', monospace !important;\n  font-size: 0.9rem !important;\n  margin: 1rem 0 !important;\n  overflow-x: auto !important;\n}\n\n:deep(.ProseMirror code) {\n  background: #f8f9fa !important;\n  color: #e74c3c !important;\n  padding: 0.2rem 0.4rem !important;\n  border-radius: 3px !important;\n  font-family: 'Consolas', 'Monaco', monospace !important;\n  font-size: 0.9rem !important;\n}\n\n/* Estilos para alineaci√≥n de texto */\n:deep(.ProseMirror .text-align-left) {\n  text-align: left !important;\n}\n\n:deep(.ProseMirror .text-align-center) {\n  text-align: center !important;\n}\n\n:deep(.ProseMirror .text-align-right) {\n  text-align: right !important;\n}\n\n:deep(.ProseMirror .text-align-justify) {\n  text-align: justify !important;\n  text-justify: inter-word !important;\n}\n\n/* Estilos para texto tachado */\n:deep(.ProseMirror s) {\n  text-decoration: line-through !important;\n  color: #95a5a6 !important;\n}\n\n:deep(.ProseMirror h1:first-child),\n:deep(.ProseMirror h2:first-child),\n:deep(.ProseMirror h3:first-child) {\n  margin-top: 0;\n}\n\n:deep(.ProseMirror ul),\n:deep(.ProseMirror ol) {\n  padding-left: 24px;\n  margin: 12px 0;\n}\n\n:deep(.ProseMirror li) {\n  margin-bottom: 6px;\n  line-height: 1.5;\n}\n\n:deep(.ProseMirror ul li) {\n  list-style-type: disc;\n}\n\n:deep(.ProseMirror ol li) {\n  list-style-type: decimal;\n}\n\n:deep(.ProseMirror strong) {\n  font-weight: 600;\n  color: #2c3e50;\n}\n\n:deep(.ProseMirror em) {\n  font-style: italic;\n}\n\n:deep(.ProseMirror u) {\n  text-decoration: underline;\n}\n\n:deep(.ProseMirror .is-empty:first-child::before) {\n  content: attr(data-placeholder);\n  color: #adb5bd;\n  float: left;\n  height: 0;\n  pointer-events: none;\n}\n\n/* Estilos para listas con letras en el editor */\n:deep(ul[data-type=\"letter\"]) {\n  list-style-type: lower-alpha !important;\n  padding-left: 24px !important;\n  margin: 8px 0 !important;\n}\n\n:deep(ul[data-type=\"letter\"] li) {\n  list-style-type: lower-alpha !important;\n  margin-bottom: 4px !important;\n}\n\n:deep(ul:not([data-type=\"letter\"])) {\n  list-style-type: disc !important;\n  padding-left: 24px !important;\n  margin: 8px 0 !important;\n}\n\n:deep(ul:not([data-type=\"letter\"]) li) {\n  list-style-type: disc !important;\n  margin-bottom: 4px !important;\n}\n\n.action-buttons {\n  display: flex;\n  gap: 10px;\n  margin: 20px 0;\n  flex-wrap: wrap;\n}\n\n.parse-btn, .sample-btn {\n  border: none;\n  padding: 10px 16px;\n  border-radius: 5px;\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: 600;\n  transition: all 0.3s ease;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.parse-btn {\n  background-color: #27ae60;\n  color: white;\n}\n\n.sample-btn {\n  background-color: #3498db;\n  color: white;\n}\n\n.parse-btn:hover, .sample-btn:hover {\n  transform: translateY(-1px);\n  opacity: 0.9;\n}\n\n.table-preview {\n  margin: 25px 0;\n  padding: 20px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  border: 1px solid #dee2e6;\n}\n\n.table-preview h4 {\n  margin-bottom: 15px;\n  color: #2c3e50;\n  font-size: 1.1rem;\n  font-weight: 600;\n}\n\n.preview-container {\n  overflow-x: auto;\n  background: white;\n  border: 1px solid #ced4da;\n  border-radius: 6px;\n  padding: 10px;\n}\n\n.preview-table {\n  width: 100%;\n  border-collapse: collapse;\n  border: 1px solid #000;\n  font-size: 11px;\n}\n\n.preview-table th {\n  border: 1px solid #000;\n  padding: 6px 8px;\n  background-color: #f0f0f0;\n  font-weight: bold;\n  text-align: center;\n}\n\n.preview-table td {\n  border: 1px solid #000;\n  padding: 4px 6px;\n  text-align: left;\n  vertical-align: top;\n}\n\n/* Estilos para subsecciones y diferentes tipos de filas */\n.section-row td {\n  background-color: #e3f2fd;\n  font-weight: bold;\n  border-left: 4px solid #2196f3 !important;\n}\n\n.subsection-row td:first-child {\n  font-weight: bold;\n  background-color: #e8f5e8;\n  padding-left: 30px !important;\n}\n\n.subsection-row td:not(:first-child) {\n  background-color: #e8f5e8;\n  padding-left: 10px;\n}\n\n.question-row td {\n  background-color: #fff3cd !important;\n  font-style: italic;\n  border-left: 4px solid #ffc107 !important;\n}\n\n.alternative-row td {\n  background-color: #d1ecf1 !important;\n  border-left: 4px solid #17a2b8 !important;\n}\n\n.end-row td {\n  background-color: #d4edda !important;\n  font-weight: bold;\n  border-left: 4px solid #28a745 !important;\n}\n\n.empty-row td {\n  background-color: #ffffff;\n  color: #6c757d;\n}\n\n.normal-row td {\n  background-color: #ffffff;\n}\n\n.status-message {\n  padding: 15px 20px;\n  margin: 20px auto;\n  border-radius: 8px;\n  font-weight: 600;\n  text-align: center;\n  max-width: 600px;\n  box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n}\n\n.status-message.success {\n  background-color: #d4edda;\n  color: #155724;\n  border: 1px solid #c3e6cb;\n}\n\n.status-message.error {\n  background-color: #f8d7da;\n  color: #721c24;\n  border: 1px solid #f5c6cb;\n}\n\n.status-message.info {\n  background-color: #d1ecf1;\n  color: #0c5460;\n  border: 1px solid #bee5eb;\n}\n\n/* Responsive breakpoints */\n@media (max-width: 1024px) {\n  .document-editor {\n    padding: 22px;\n  }\n\n  .header-fields {\n    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n    gap: 12px;\n  }\n\n  .section h3 {\n    font-size: 1.25rem;\n  }\n\n  .editor-content {\n    min-height: 100px;\n    max-height: 300px;\n    padding: 12px;\n  }\n\n  .preview-table {\n    font-size: 10px;\n  }\n\n  .action-buttons {\n    gap: 8px;\n  }\n  \n  .style-select {\n    min-width: 100px;\n    font-size: 10px;\n  }\n}\n\n@media (max-width: 768px) {\n  .document-view {\n    padding: 8px;\n  }\n\n  .document-controls {\n    flex-direction: column;\n    align-items: stretch;\n    width: 100%;\n    gap: 10px;\n  }\n  \n  .generate-btn, .reset-btn {\n    width: 100%;\n    max-width: none;\n  }\n  \n  .action-buttons {\n    justify-content: center;\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .parse-btn, .sample-btn {\n    width: 100%;\n  }\n  \n  .section {\n    padding: 12px;\n  }\n  \n  .header-fields {\n    grid-template-columns: 1fr;\n  }\n\n  .format-example {\n    font-size: 11px;\n    padding: 12px;\n  }\n\n  .toolbar {\n    padding: 6px 8px;\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 8px;\n  }\n\n  .toolbar-group {\n    flex-wrap: wrap;\n  }\n\n  .toolbar-btn {\n    padding: 4px 6px;\n    font-size: 11px;\n    min-width: 24px;\n    height: 24px;\n  }\n  \n  .style-select {\n    min-width: 80px;\n    font-size: 9px;\n    height: 24px;\n    padding: 2px 4px;\n  }\n\n  /* Modal responsive */\n  .modal-container {\n    width: 95%;\n    margin: 20px;\n  }\n  \n  .modal-header {\n    padding: 16px 20px 0;\n  }\n  \n  .modal-content {\n    padding: 20px;\n  }\n  \n  .modal-actions {\n    flex-direction: column;\n    padding: 0 20px 20px;\n  }\n  \n  .modal-btn {\n    width: 100%;\n  }\n  \n  .modal-title {\n    font-size: 1.2rem;\n  }\n  \n  .modal-message {\n    font-size: 1rem;\n  }\n}\n\n@media (max-width: 480px) {\n  .document-view {\n    padding: 6px;\n  }\n\n  .document-editor {\n    padding: 12px;\n  }\n\n  .section h3 {\n    font-size: 1.05rem;\n    padding-bottom: 8px;\n  }\n\n  .header-input {\n    padding: 9px 10px;\n    font-size: 13px;\n  }\n\n  .editor-content {\n    min-height: 80px;\n    max-height: 250px;\n    padding: 10px;\n  }\n\n  .preview-container {\n    padding: 6px;\n  }\n\n  .preview-table th, .preview-table td {\n    padding: 6px 6px;\n  }\n\n  .button-icon {\n    display: none;\n  }\n  \n  .style-select {\n    min-width: 70px;\n    font-size: 8px;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}